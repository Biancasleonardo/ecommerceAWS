"use strict";var xa=Object.create;var ot=Object.defineProperty;var La=Object.getOwnPropertyDescriptor;var Oa=Object.getOwnPropertyNames;var $a=Object.getPrototypeOf,Da=Object.prototype.hasOwnProperty;var p=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),ka=(t,e)=>{for(var r in e)ot(t,r,{get:e[r],enumerable:!0})},Wr=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Oa(e))!Da.call(t,s)&&s!==r&&ot(t,s,{get:()=>e[s],enumerable:!(n=La(e,s))||n.enumerable});return t};var Ma=(t,e,r)=>(r=t!=null?xa($a(t)):{},Wr(e||!t||!t.__esModule?ot(r,"default",{value:t,enumerable:!0}):r,t)),Pa=t=>Wr(ot({},"__esModule",{value:!0}),t);var jr=p((yd,Hr)=>{"use strict";function Gt(t){return typeof t=="function"}var D=console.error.bind(console);function Oe(t,e,r){var n=!!t[e]&&t.propertyIsEnumerable(e);Object.defineProperty(t,e,{configurable:!0,enumerable:n,writable:!0,value:r})}function $e(t){t&&t.logger&&(Gt(t.logger)?D=t.logger:D("new logger isn't a function, not replacing"))}function Gr(t,e,r){if(!t||!t[e]){D("no original function "+e+" to wrap");return}if(!r){D("no wrapper function"),D(new Error().stack);return}if(!Gt(t[e])||!Gt(r)){D("original object and wrapper must be functions");return}var n=t[e],s=r(n,e);return Oe(s,"__original",n),Oe(s,"__unwrap",function(){t[e]===s&&Oe(t,e,n)}),Oe(s,"__wrapped",!0),Oe(t,e,s),s}function Fa(t,e,r){if(t)Array.isArray(t)||(t=[t]);else{D("must provide one or more modules to patch"),D(new Error().stack);return}if(!(e&&Array.isArray(e))){D("must provide one or more functions to wrap on modules");return}t.forEach(function(n){e.forEach(function(s){Gr(n,s,r)})})}function Xr(t,e){if(!t||!t[e]){D("no function to unwrap."),D(new Error().stack);return}if(!t[e].__unwrap)D("no original to unwrap to -- has "+e+" already been unwrapped?");else return t[e].__unwrap()}function Ba(t,e){if(t)Array.isArray(t)||(t=[t]);else{D("must provide one or more modules to patch"),D(new Error().stack);return}if(!(e&&Array.isArray(e))){D("must provide one or more functions to unwrap on modules");return}t.forEach(function(r){e.forEach(function(n){Xr(r,n)})})}$e.wrap=Gr;$e.massWrap=Fa;$e.unwrap=Xr;$e.massUnwrap=Ba;Hr.exports=$e});var zr=p((Td,Yr)=>{"use strict";var Kr=jr(),ve=Kr.wrap,at=Kr.unwrap,Y="wrap@before";function ut(t,e,r){var n=!!t[e]&&t.propertyIsEnumerable(e);Object.defineProperty(t,e,{configurable:!0,enumerable:n,writable:!0,value:r})}function Ua(t,e){for(var r=e.length,n=0;n<r;n++){var s=e[n],i=t[Y];if(typeof i=="function")i(s);else if(Array.isArray(i))for(var o=i.length,a=0;a<o;a++)i[a](s)}}function Qr(t,e){var r;return r=t._events&&t._events[e],Array.isArray(r)||(r?r=[r]:r=[]),r}function Wa(t,e,r){var n=Qr(t,e),s=n.filter(function(i){return r.indexOf(i)===-1});s.length>0&&Ua(t,s)}function Vr(t,e){if(t){var r=t;if(typeof t=="function")r=e(t);else if(Array.isArray(t)){r=[];for(var n=0;n<t.length;n++)r[n]=e(t[n])}return r}}Yr.exports=function(e,r,n){if(!e||!e.on||!e.addListener||!e.removeListener||!e.emit)throw new Error("can only wrap real EEs");if(!r)throw new Error("must have function to run on listener addition");if(!n)throw new Error("must have function to wrap listeners when emitting");function s(o){return function(u,c){var l=Qr(this,u).slice();try{var f=o.call(this,u,c);return Wa(this,u,l),f}finally{this.on.__wrapped||ve(this,"on",s),this.addListener.__wrapped||ve(this,"addListener",s)}}}function i(o){return function(u){if(!this._events||!this._events[u])return o.apply(this,arguments);var c=this._events[u];function l(f){return function(){this._events[u]=c;try{return f.apply(this,arguments)}finally{c=this._events[u],this._events[u]=Vr(c,n)}}}ve(this,"removeListener",l);try{return this._events[u]=Vr(c,n),o.apply(this,arguments)}finally{at(this,"removeListener"),this._events[u]=c}}}e[Y]?typeof e[Y]=="function"?ut(e,Y,[e[Y],r]):Array.isArray(e[Y])&&e[Y].push(r):ut(e,Y,r),e.__wrapped||(ve(e,"addListener",s),ve(e,"on",s),ve(e,"emit",i),ut(e,"__unwrap",function(){at(e,"addListener"),at(e,"on"),at(e,"emit"),delete e[Y],delete e.__wrapped}),ut(e,"__wrapped",!0))}});var tn=p((bd,en)=>{"use strict";var S=require("util"),z=require("assert"),Ga=zr(),b=require("async_hooks"),De="cls@contexts",ke="error@context",q=process.env.DEBUG_CLS_HOOKED,E=-1;en.exports={getNamespace:Jr,createNamespace:Xa,destroyNamespace:Zr,reset:Ha,ERROR_SYMBOL:ke};function W(t){this.name=t,this.active=null,this._set=[],this.id=null,this._contexts=new Map,this._indent=0}W.prototype.set=function(e,r){if(!this.active)throw new Error("No context available. ns.run() or ns.bind() must be called first.");if(this.active[e]=r,q){let n=" ".repeat(this._indent<0?0:this._indent);R(n+"CONTEXT-SET KEY:"+e+"="+r+" in ns:"+this.name+" currentUid:"+E+" active:"+S.inspect(this.active,{showHidden:!0,depth:2,colors:!0}))}return r};W.prototype.get=function(e){if(!this.active){if(q){let r=b.currentId(),n=b.triggerAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);R(`${s}CONTEXT-GETTING KEY NO ACTIVE NS: (${this.name}) ${e}=undefined currentUid:${E} asyncHooksCurrentId:${r} triggerId:${n} len:${this._set.length}`)}return}if(q){let r=b.executionAsyncId(),n=b.triggerAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);R(s+"CONTEXT-GETTING KEY:"+e+"="+this.active[e]+" ("+this.name+") currentUid:"+E+" active:"+S.inspect(this.active,{showHidden:!0,depth:2,colors:!0})),R(`${s}CONTEXT-GETTING KEY: (${this.name}) ${e}=${this.active[e]} currentUid:${E} asyncHooksCurrentId:${r} triggerId:${n} len:${this._set.length} active:${S.inspect(this.active)}`)}return this.active[e]};W.prototype.createContext=function(){let e=Object.create(this.active?this.active:Object.prototype);if(e._ns_name=this.name,e.id=E,q){let r=b.executionAsyncId(),n=b.triggerAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);R(`${s}CONTEXT-CREATED Context: (${this.name}) currentUid:${E} asyncHooksCurrentId:${r} triggerId:${n} len:${this._set.length} context:${S.inspect(e,{showHidden:!0,depth:2,colors:!0})}`)}return e};W.prototype.run=function(e){let r=this.createContext();this.enter(r);try{if(q){let n=b.triggerAsyncId(),s=b.executionAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);R(`${i}CONTEXT-RUN BEGIN: (${this.name}) currentUid:${E} triggerId:${n} asyncHooksCurrentId:${s} len:${this._set.length} context:${S.inspect(r)}`)}return e(r),r}catch(n){throw n&&(n[ke]=r),n}finally{if(q){let n=b.triggerAsyncId(),s=b.executionAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);R(`${i}CONTEXT-RUN END: (${this.name}) currentUid:${E} triggerId:${n} asyncHooksCurrentId:${s} len:${this._set.length} ${S.inspect(r)}`)}this.exit(r)}};W.prototype.runAndReturn=function(e){let r;return this.run(function(n){r=e(n)}),r};W.prototype.runPromise=function(e){let r=this.createContext();this.enter(r);let n=e(r);if(!n||!n.then||!n.catch)throw new Error("fn must return a promise.");return q&&R("CONTEXT-runPromise BEFORE: ("+this.name+") currentUid:"+E+" len:"+this._set.length+" "+S.inspect(r)),n.then(s=>(q&&R("CONTEXT-runPromise AFTER then: ("+this.name+") currentUid:"+E+" len:"+this._set.length+" "+S.inspect(r)),this.exit(r),s)).catch(s=>{throw s[ke]=r,q&&R("CONTEXT-runPromise AFTER catch: ("+this.name+") currentUid:"+E+" len:"+this._set.length+" "+S.inspect(r)),this.exit(r),s})};W.prototype.bind=function(e,r){r||(this.active?r=this.active:r=this.createContext());let n=this;return function(){n.enter(r);try{return e.apply(this,arguments)}catch(i){throw i&&(i[ke]=r),i}finally{n.exit(r)}}};W.prototype.enter=function(e){if(z.ok(e,"context must be provided for entering"),q){let r=b.executionAsyncId(),n=b.triggerAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);R(`${s}CONTEXT-ENTER: (${this.name}) currentUid:${E} triggerId:${n} asyncHooksCurrentId:${r} len:${this._set.length} ${S.inspect(e)}`)}this._set.push(this.active),this.active=e};W.prototype.exit=function(e){if(z.ok(e,"context must be provided for exiting"),q){let n=b.executionAsyncId(),s=b.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);R(`${i}CONTEXT-EXIT: (${this.name}) currentUid:${E} triggerId:${s} asyncHooksCurrentId:${n} len:${this._set.length} ${S.inspect(e)}`)}if(this.active===e){z.ok(this._set.length,"can't remove top context"),this.active=this._set.pop();return}let r=this._set.lastIndexOf(e);r<0?(q&&R("??ERROR?? context exiting but not entered - ignoring: "+S.inspect(e)),z.ok(r>=0,`context not currently entered; can't exit. 
`+S.inspect(this)+`
`+S.inspect(e))):(z.ok(r,"can't remove top context"),this._set.splice(r,1))};W.prototype.bindEmitter=function(e){z.ok(e.on&&e.addListener&&e.emit,"can only bind real EEs");let r=this,n="context@"+this.name;function s(o){o&&(o[De]||(o[De]=Object.create(null)),o[De][n]={namespace:r,context:r.active})}function i(o){if(!(o&&o[De]))return o;let a=o,u=o[De];return Object.keys(u).forEach(function(c){let l=u[c];a=l.namespace.bind(a,l.context)}),a}Ga(e,s,i)};W.prototype.fromException=function(e){return e[ke]};function Jr(t){return process.namespaces[t]}function Xa(t){z.ok(t,"namespace must be given a name."),q&&R(`NS-CREATING NAMESPACE (${t})`);let e=new W(t);return e.id=E,b.createHook({init(n,s,i,o){if(E=b.executionAsyncId(),e.active){if(e._contexts.set(n,e.active),q){let a=" ".repeat(e._indent<0?0:e._indent);R(`${a}INIT [${s}] (${t}) asyncId:${n} currentUid:${E} triggerId:${i} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${o}`)}}else if(E===0){let a=b.triggerAsyncId(),u=e._contexts.get(a);if(u){if(e._contexts.set(n,u),q){let c=" ".repeat(e._indent<0?0:e._indent);R(`${c}INIT USING CONTEXT FROM TRIGGERID [${s}] (${t}) asyncId:${n} currentUid:${E} triggerId:${a} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${o}`)}}else if(q){let c=" ".repeat(e._indent<0?0:e._indent);R(`${c}INIT MISSING CONTEXT [${s}] (${t}) asyncId:${n} currentUid:${E} triggerId:${a} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${o}`)}}if(q&&s==="PROMISE"){R(S.inspect(o,{showHidden:!0}));let a=o.parentId,u=" ".repeat(e._indent<0?0:e._indent);R(`${u}INIT RESOURCE-PROMISE [${s}] (${t}) parentId:${a} asyncId:${n} currentUid:${E} triggerId:${i} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${o}`)}},before(n){E=b.executionAsyncId();let s;if(s=e._contexts.get(n)||e._contexts.get(E),s){if(q){let i=b.triggerAsyncId(),o=" ".repeat(e._indent<0?0:e._indent);R(`${o}BEFORE (${t}) asyncId:${n} currentUid:${E} triggerId:${i} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${S.inspect(s)}`),e._indent+=2}e.enter(s)}else if(q){let i=b.triggerAsyncId(),o=" ".repeat(e._indent<0?0:e._indent);R(`${o}BEFORE MISSING CONTEXT (${t}) asyncId:${n} currentUid:${E} triggerId:${i} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} namespace._contexts:${S.inspect(e._contexts,{showHidden:!0,depth:2,colors:!0})}`),e._indent+=2}},after(n){E=b.executionAsyncId();let s;if(s=e._contexts.get(n)||e._contexts.get(E),s){if(q){let i=b.triggerAsyncId();e._indent-=2;let o=" ".repeat(e._indent<0?0:e._indent);R(`${o}AFTER (${t}) asyncId:${n} currentUid:${E} triggerId:${i} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${S.inspect(s)}`)}e.exit(s)}else if(q){let i=b.triggerAsyncId();e._indent-=2;let o=" ".repeat(e._indent<0?0:e._indent);R(`${o}AFTER MISSING CONTEXT (${t}) asyncId:${n} currentUid:${E} triggerId:${i} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${S.inspect(s)}`)}},destroy(n){if(E=b.executionAsyncId(),q){let s=b.triggerAsyncId(),i=" ".repeat(e._indent<0?0:e._indent);R(`${i}DESTROY (${t}) currentUid:${E} asyncId:${n} triggerId:${s} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${S.inspect(e._contexts.get(E))}`)}e._contexts.delete(n)}}).enable(),process.namespaces[t]=e,e}function Zr(t){let e=Jr(t);z.ok(e,`can't delete nonexistent namespace! "`+t+'"'),z.ok(e.id,"don't assign to process.namespaces directly! "+S.inspect(e)),process.namespaces[t]=null}function Ha(){process.namespaces&&Object.keys(process.namespaces).forEach(function(t){Zr(t)}),process.namespaces=Object.create(null)}process.namespaces={};function R(...t){q&&process._rawDebug(`${S.format(...t)}`)}});var A=p((Rd,sn)=>{"use strict";var Xt=["debug","info","warn","error","silent"],rn=Xt.indexOf("error"),ja=Va(process.env.AWS_XRAY_DEBUG_MODE?"debug":process.env.AWS_XRAY_LOG_LEVEL),nn={error:ct("error"),info:ct("info"),warn:ct("warn"),debug:ct("debug")};function ct(t){var e=Xt.indexOf(t),r=console[t]||console.log||(()=>{});return e>=ja?(n,s)=>{(n||s)&&r(Ya(t,n,s))}:()=>{}}function Va(t){if(t){var e=t.toLowerCase(),r=Xt.indexOf(e);return r>=0?r:rn}return rn}function Ka(t){var e=-t.getTimezoneOffset(),r=e>=0?"+":"-",n=function(s){var i=Math.floor(Math.abs(s));return(i<10?"0":"")+i};return new Date(t.getTime()+e*60*1e3).toISOString().replace(/T/," ").replace(/Z/," ")+r+n(e/60)+":"+n(e%60)}function Qa(){return process.env.LAMBDA_TASK_ROOT!==void 0}function Ya(t,e,r){var n=[];Qa()||(n.push(Ka(new Date)),n.push(`[${t.toUpperCase()}]`)),e&&n.push(e);var s=n.join(" "),i=za(r);return[s,i].filter(o=>o.length>0).join(`
  `)}function za(t){return t?typeof t=="string"?t:JSON.stringify(t):""}var Ja={setLogger:function(e){nn=e},getLogger:function(){return nn}};sn.exports=Ja});var Ht=p((Ad,an)=>{"use strict";var Za=require("crypto");function on(t,e){this.init(t,e)}on.prototype.init=function(e,r){var n=typeof e=="string"||e instanceof String?{message:e,name:""}:e;if(this.message=n.message,this.type=n.name,this.stack=[],this.remote=!!r,this.id=Za.randomBytes(8).toString("hex"),n.stack){var s=n.stack.split(`
`);s.shift(),s.forEach(i=>{var o=i.trim().replace(/\(|\)/g,"");o=o.substring(o.indexOf(" ")+1);var a=o.lastIndexOf(" ")>=0?o.slice(0,o.lastIndexOf(" ")):null,u=Array.isArray(a)&&!a.length?o:o.slice(o.lastIndexOf(" ")+1);u=u.split(":");var c={path:u[0],line:parseInt(u[1]),label:a||"anonymous"};this.stack.push(c)},this)}};an.exports=on});var cn=p((qd,un)=>{un.exports=eu;function eu(t){var e=!1,r=null,n=null,s=null;return o;function i(a){s&&nu(s,a),e=!1,s=n;var u=r;if(r=null,n=null,!u||!u.length){if(!s||!s.length){s=null;return}u||(u=[])}e=!0,t(u,i)}function o(a,u){e?(r||(r=[],n=[]),tu(r,a),u&&n.push(u)):(u&&(s=[u]),e=!0,t(Array.isArray(a)?a:[a],i))}}function tu(t,e){Array.isArray(e)?ru(t,e):t.push(e)}function ru(t,e){for(var r=0;r<e.length;r++)t.push(e[r])}function nu(t,e){for(var r=0;r<t.length;r++)t[r](e)}});var lt=p((Id,fn)=>{"use strict";var ln=A(),j={udp_ip:"127.0.0.1",udp_port:2e3,tcp_ip:"127.0.0.1",tcp_port:2e3,setDaemonAddress:function(e){process.env.AWS_XRAY_DAEMON_ADDRESS?ln.getLogger().warn("Ignoring call to setDaemonAddress as AWS_XRAY_DAEMON_ADDRESS is set. The current daemon address will not be changed."):(pn(e),ln.getLogger().info("Configured daemon address to "+e+"."))}},pn=function(e){if(e.indexOf(":")===-1)throw new Error("Invalid Daemon Address. You must specify an ip and port.");var r=e.split(" ");if(r.length===1){if(e.indexOf("udp")>-1||e.indexOf("tcp")>-1)throw new Error("Invalid Daemon Address. You must specify both tcp and udp addresses.");var n=e.split(":");if(!n[0])throw new Error("Invalid Daemon Address. You must specify an ip.");j.udp_ip=n[0],j.tcp_ip=n[0],j.udp_port=n[1],j.tcp_port=n[1]}else if(r.length===2){var s=r[0].split(":"),i=r[1].split(":"),o={};if(o[s[0]]=s,o[i[0]]=i,j.udp_ip=o.udp[1],j.udp_port=parseInt(o.udp[2]),j.tcp_ip=o.tcp[1],j.tcp_port=parseInt(o.tcp[2]),!j.udp_port||!j.tcp_port)throw new Error("Invalid Daemon Address. You must specify port number.")}};process.env.AWS_XRAY_DAEMON_ADDRESS&&pn(process.env.AWS_XRAY_DAEMON_ADDRESS);fn.exports=j});var ft=p((wd,_n)=>{"use strict";var gn=require("dgram"),su=cn(),pt=A(),dn='{"format":"json","version":1}',hn=`
`;function iu(t,e){var r=gn.createSocket("udp4");mn(r,t,0,function(){try{r.close()}finally{e()}})}function mn(t,e,r,n){if(r>=e.length){n();return}ou(t,e[r],function(){mn(t,e,r+1,n)})}function ou(t,e,r){var n=e.msg,s=e.offset,i=e.length,o=e.port,a=e.address,u=e.callback;t.send(n,s,i,o,a,function(c){try{u(c)}finally{r()}})}function vn(){this.batchSend=su(iu)}vn.prototype.send=function(t,e,r,n,s,i){var o={msg:t,offset:e,length:r,port:n,address:s,callback:i};this.batchSend(o)};var au={daemonConfig:lt(),format:function(e){return dn+hn+e.toString()},send:function(e){this.socket||(this.useBatchingTemporarySocket?this.socket=new vn:this.socket=gn.createSocket("udp4").unref());var r=this.socket,n=e.format(),s=dn+hn+n,i=Buffer.from(s),o='{"trace_id:"'+e.trace_id+'","id":"'+e.id+'"}',a=e.type==="subsegment"?"Subsegment":"Segment";r.send(i,0,i.length,this.daemonConfig.udp_port,this.daemonConfig.udp_ip,function(u){u?u.code==="EMSGSIZE"?pt.getLogger().error(a+" too large to send: "+o+" ("+i.length+" bytes)."):pt.getLogger().error("Error occured sending segment: ",u):(pt.getLogger().debug(a+' sent: {"trace_id:"'+e.trace_id+'","id":"'+e.id+'"}'),pt.getLogger().debug("UDP message sent: "+e))})},setDaemonAddress:function(e){this.daemonConfig.setDaemonAddress(e)},getIp:function(){return this.daemonConfig.udp_ip},getPort:function(){return this.daemonConfig.udp_port},disableReusableSocket:function(){this.useBatchingTemporarySocket=!0}};_n.exports=au});var ht=p((Cd,En)=>{"use strict";var uu=require("crypto"),dt=A(),_e=class{constructor(e,r){this.version=1,this.timestamp=e||Math.round(new Date().getTime()/1e3).toString(16),this.id=r||uu.randomBytes(12).toString("hex")}static Invalid(){return new _e("00000000","000000000000000000000000")}static FromString(e){let r="-";var n=new _e,s,i;if(!e||typeof e!="string")return dt.getLogger().error("Empty or non-string trace ID provided"),n;let o=e.trim().split(r);return o.length!==3?(dt.getLogger().error("Unrecognized trace ID format"),n):(s=parseInt(o[0]),isNaN(s)||s<1?(dt.getLogger().error("Trace ID version must be positive integer"),n):(i=parseInt(o[1],16).toString(16),i==="NaN"?(dt.getLogger().error("Trace ID timestamp must be a hex-encoded value"),n):(n.version=s,n.timestamp=i,n.id=o[2],n)))}toString(){return`${this.version.toString()}-${this.timestamp}-${this.id}`}};En.exports=_e});var L=p((Nd,Sn)=>{"use strict";var cu=require("crypto"),Me=A(),lu=ht(),jt={getCauseTypeFromHttpStatus:function(e){var r=e.toString();if(r.match(/^[4][0-9]{2}$/)!==null)return"error";if(r.match(/^[5][0-9]{2}$/)!==null)return"fault"},stripQueryStringFromPath:function(e){return e?e.split("?")[0]:""},wildcardMatch:function(e,r){if(e===void 0||r===void 0)return!1;if(e.length===1&&e.charAt(0)==="*")return!0;var n=e.length,s=r.length,i=e.indexOf("*");if(e=e.toLowerCase(),r=r.toLowerCase(),i===-1||i===n-1){var o=function(){for(var m=0,d=0;d<n;d++){var P=e.charAt(d);if(P==="*")return!0;if(P==="?"){if(m===s)return!1;m++}else{if(m>=s||P!=r.charAt(m))return!1;m++}}return m===s};return o()}var a=[];a[0]=!0;for(var u=0;u<n;u++){var c,l=e.charAt(u);if(l!="*")for(c=s-1;c>=0;c--)a[c+1]=!!a[c]&&(l==="?"||l===r.charAt(c));else{for(c=0;c<=s&&!a[c];)c++;for(c;c<=s;c++)a[c]=!0}a[0]=a[0]&&l==="*"}return a[s]},LambdaUtils:{validTraceData:function(t){var e=!1;if(t){var r=jt.processTraceData(t);e=!!(r&&r.root&&r.parent&&r.sampled)}return e},populateTraceData:function(t,e){Me.getLogger().debug("Lambda trace data found: "+e);let r=jt.processTraceData(e);var n=!1;return r?!r.root||!r.parent||!r.sampled?Me.getLogger().error("_X_AMZN_TRACE_ID is missing required information"):n=!0:(r={},Me.getLogger().error("_X_AMZN_TRACE_ID is empty or has an invalid format")),t.trace_id=lu.FromString(r.root).toString(),t.id=r.parent||cu.randomBytes(8).toString("hex"),r.root&&t.trace_id!==r.root&&(Me.getLogger().error("_X_AMZN_TRACE_ID contains invalid trace ID"),n=!1),parseInt(r.sampled)?delete t.notTraced:t.notTraced=!0,r.data&&(t.userData=r.data),Me.getLogger().debug("Segment started: "+JSON.stringify(r)),n}},processTraceData:function(e){var r={},n={},s=["root","parent","sampled","self"],i=256;return typeof e=="string"&&e&&(e.split(";").forEach(function(o){if(o){var a=o.split("=");if(a[0]&&a[1]){let u=a[0].trim(),c=a[1].trim(),l=u.toLowerCase(),f=s.indexOf(l)!==-1;f?r[l]=c:!f&&i-(l.length+c.length)>=0&&(n[u]=c,i-=u.length+c.length)}}}),r.data=n),r},objectWithoutProperties:function(e,r,n){r=Array.isArray(r)?r:[],n=typeof n=="boolean"?n:!1;var s=n?Object.create(Object.getPrototypeOf(e)):{};for(var i in e)r.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(s[i]=e[i]);return s},safeParseInt:t=>!t||isNaN(t)?0:parseInt(t)};Sn.exports=jt});var re=p((xd,bn)=>{"use strict";var{safeParseInt:yn}=L(),Tn=A(),pu=100,Vt={streamingThreshold:pu,getCurrentTime:function(){return Date.now()/1e3},setOrigin:function(e){this.origin=e},setPluginData:function(e){this.pluginData=e},setSDKData:function(e){this.sdkData=e},setServiceData:function(e){this.serviceData=e},setStreamingThreshold:function(e){isFinite(e)&&e>=0?(Vt.streamingThreshold=e,Tn.getLogger().debug("Subsegment streaming threshold set to: "+e)):Tn.getLogger().error("Invalid threshold: "+e+". Must be a whole number >= 0.")},getStreamingThreshold:function(){return Vt.streamingThreshold},getHttpResponseData:t=>{let e={};if(!t)return e;let r=yn(t.statusCode);return r!==0&&(e.status=r),t.headers&&t.headers["content-length"]&&(e.content_length=yn(t.headers["content-length"])),e}};bn.exports=Vt});var qn=p((Ld,An)=>{"use strict";var{getHttpResponseData:fu}=re(),{stripQueryStringFromPath:du}=L();function Rn(t,e,r){this.init(t,e,r)}Rn.prototype.init=function(e,r,n){this.request={url:e.agent&&e.agent.protocol?e.agent.protocol+"//"+(e.host||e.getHeader("host"))+du(e.path):"",method:e.method||""},n&&(this.request.traced=!0),r&&(this.response=fu(r))};An.exports=Rn});var Pe=p((Od,In)=>{"use strict";var hu=require("crypto"),gu=Ht(),mu=qn(),vu=ft(),Kt=re(),_u=L(),J=A();function y(t){this.init(t)}y.prototype.init=function(e){if(typeof e!="string")throw new Error("Subsegment name must be of type string.");this.id=hu.randomBytes(8).toString("hex"),this.name=e,this.start_time=Kt.getCurrentTime(),this.in_progress=!0,this.counter=0,this.notTraced=!1};y.prototype.addNewSubsegment=function(e){let r=new y(e);return this.addSubsegment(r),r};y.prototype.addSubsegmentWithoutSampling=function(e){this.addSubsegment(e),e.notTraced=!0};y.prototype.addNewSubsegmentWithoutSampling=function(e){let r=new y(e);return this.addSubsegment(r),r.notTraced=!0,r};y.prototype.addSubsegment=function(t){if(!(t instanceof y))throw new Error("Failed to add subsegment:"+t+' to subsegment "'+this.name+'".  Not a subsegment.');this.subsegments===void 0&&(this.subsegments=[]),t.segment=this.segment,t.parent=this,t.notTraced=t.parent.notTraced,t.end_time===void 0&&this.incrementCounter(t.counter),this.subsegments.push(t)};y.prototype.removeSubsegment=function(e){if(!(e instanceof y))throw new Error("Failed to remove subsegment:"+e+' from subsegment "'+this.name+'".  Not a subsegment.');if(this.subsegments!==void 0){var r=this.subsegments.indexOf(e);r>=0&&this.subsegments.splice(r,1)}};y.prototype.addAttribute=function(e,r){this[e]=r};y.prototype.addPrecursorId=function(t){typeof t!="string"&&J.getLogger().error("Failed to add id:"+t+" to subsegment "+this.name+".  Precursor Ids must be of type string."),this.precursor_ids===void 0&&(this.precursor_ids=[]),this.precursor_ids.push(t)};y.prototype.addAnnotation=function(t,e){if(typeof e!="boolean"&&typeof e!="string"&&!isFinite(e)){J.getLogger().error("Failed to add annotation key: "+t+" value: "+e+" to subsegment "+this.name+". Value must be of type string, number or boolean.");return}if(typeof t!="string"){J.getLogger().error("Failed to add annotation key: "+t+" value: "+e+" to subsegment "+this.name+". Key must be of type string.");return}this.annotations===void 0&&(this.annotations={}),this.annotations[t]=e};y.prototype.addMetadata=function(t,e,r){if(typeof t!="string"){J.getLogger().error("Failed to add metadata key: "+t+" value: "+e+" to subsegment "+this.name+". Key must be of type string.");return}if(r&&typeof r!="string"){J.getLogger().error("Failed to add metadata key: "+t+" value: "+e+" to subsegment "+this.name+". Namespace must be of type string.");return}var n=r||"default";this.metadata||(this.metadata={}),this.metadata[n]||(this.metadata[n]={}),n!=="__proto__"&&(this.metadata[n][t]=e??"")};y.prototype.addSqlData=function(e){this.sql=e};y.prototype.addError=function(e,r){if(e==null||typeof e!="object"&&typeof e!="string"){J.getLogger().error("Failed to add error:"+e+' to subsegment "'+this.name+'".  Not an object or string literal.');return}if(this.addFaultFlag(),this.segment&&this.segment.exception){if(e===this.segment.exception.ex){this.fault=!0,this.cause={id:this.segment.exception.cause,exceptions:[]};return}delete this.segment.exception}this.segment&&(this.segment.exception={ex:e,cause:this.id}),this.cause===void 0&&(this.cause={working_directory:process.cwd(),exceptions:[]}),this.cause.exceptions.unshift(new gu(e,r))};y.prototype.addRemoteRequestData=function(e,r,n){this.http=new mu(e,r,n),"traced"in this.http.request&&(this.traced=this.http.request.traced,delete this.http.request.traced)};y.prototype.addFaultFlag=function(){this.fault=!0};y.prototype.addErrorFlag=function(){this.error=!0};y.prototype.addThrottleFlag=function(){this.throttle=!0};y.prototype.close=function(e,r){var n=this.segment;this.end_time=Kt.getCurrentTime(),delete this.in_progress,e&&this.addError(e,r),this.parent&&this.parent.decrementCounter(),n&&n.counter>Kt.getStreamingThreshold()&&this.streamSubsegments()&&this.parent&&this.parent.removeSubsegment(this)};y.prototype.incrementCounter=function(e){this.counter=e?this.counter+e+1:this.counter+1,this.parent&&this.parent.incrementCounter(e)};y.prototype.decrementCounter=function(){this.counter--,this.parent&&this.parent.decrementCounter()};y.prototype.isClosed=function(){return!this.in_progress};y.prototype.flush=function(){if(!this.parent||!this.segment){J.getLogger().error("Failed to flush subsegment: "+this.name+". Subsegment must be added to a segment chain to flush.");return}this.segment.trace_id?this.segment.notTraced!==!0&&!this.notTraced?vu.send(this):J.getLogger().debug("Ignoring flush on subsegment "+this.id+". Associated segment is marked as not sampled."):J.getLogger().debug("Ignoring flush on subsegment "+this.id+". Associated segment is missing a trace ID.")};y.prototype.streamSubsegments=function(){if(this.isClosed()&&this.counter<=0)return this.flush(),!0;if(this.subsegments&&this.subsegments.length>0){var e=[];this.subsegments.forEach(function(r){r.streamSubsegments()||e.push(r)}),this.subsegments=e}};y.prototype.format=function(){return this.type="subsegment",this.parent&&(this.parent_id=this.parent.id),this.segment&&(this.trace_id=this.segment.trace_id),JSON.stringify(this)};y.prototype.toString=function(){return JSON.stringify(this)};y.prototype.toJSON=function(){var e=["segment","parent","counter"];(this.subsegments==null||this.subsegments.length===0)&&e.push("subsegments");var r=_u.objectWithoutProperties(this,e,!1);return r};In.exports=y});var Fe=p(($d,Nn)=>{"use strict";var Eu=require("crypto"),Su=Ht(),yu=ft(),V=re(),gt=Pe(),wn=ht(),Cn=L(),ne=A();function T(t,e,r){this.init(t,e,r)}T.prototype.init=function(e,r,n){if(typeof e!="string")throw new Error("Segment name must be of type string.");var s;r&&typeof r=="string"?s=wn.FromString(r):s=new wn;var i=Eu.randomBytes(8).toString("hex"),o=V.getCurrentTime();this.trace_id=s.toString(),this.id=i,this.start_time=o,this.name=e||"",this.in_progress=!0,this.counter=0,n&&(this.parent_id=n),V.serviceData&&this.setServiceData(V.serviceData),V.pluginData&&this.addPluginData(V.pluginData),V.origin&&(this.origin=V.origin),V.sdkData&&this.setSDKData(V.sdkData)};T.prototype.addIncomingRequestData=function(e){this.http=e};T.prototype.addAnnotation=function(e,r){if(typeof r!="boolean"&&typeof r!="string"&&!isFinite(r)){ne.getLogger().error("Failed to add annotation key: "+e+" value: "+r+" to subsegment "+this.name+". Value must be of type string, number or boolean.");return}if(typeof e!="string"){ne.getLogger().error("Failed to add annotation key: "+e+" value: "+r+" to subsegment "+this.name+". Key must be of type string.");return}this.annotations===void 0&&(this.annotations={}),this.annotations[e]=r};T.prototype.setUser=function(t){typeof t!="string"&&ne.getLogger().error("Set user: "+t+" failed. User IDs must be of type string."),this.user=t};T.prototype.addMetadata=function(t,e,r){if(typeof t!="string"){ne.getLogger().error("Failed to add metadata key: "+t+" value: "+e+" to segment "+this.name+". Key must be of type string.");return}if(r&&typeof r!="string"){ne.getLogger().error("Failed to add metadata key: "+t+" value: "+e+" to segment "+this.name+". Namespace must be of type string.");return}var n=r||"default";this.metadata||(this.metadata={}),this.metadata[n]||(this.metadata[n]={}),n!=="__proto__"&&(this.metadata[n][t]=e??"")};T.prototype.setSDKData=function(e){if(!e){ne.getLogger().error("Add SDK data: "+e+" failed.Must not be empty.");return}this.aws||(this.aws={}),this.aws.xray=e};T.prototype.setMatchedSamplingRule=function(e){this.aws&&(this.aws=JSON.parse(JSON.stringify(this.aws))),this.aws&&this.aws.xray?this.aws.xray.rule_name=e:this.aws={xray:{rule_name:e}}};T.prototype.setServiceData=function(e){if(!e){ne.getLogger().error("Add service data: "+e+" failed.Must not be empty.");return}this.service=e};T.prototype.addPluginData=function(e){this.aws===void 0&&(this.aws={}),Object.assign(this.aws,e)};T.prototype.addNewSubsegment=function(e){var r=new gt(e);return this.addSubsegment(r),r};T.prototype.addSubsegmentWithoutSampling=function(e){this.addSubsegment(e),e.notTraced=!0};T.prototype.addNewSubsegmentWithoutSampling=function(e){let r=new gt(e);return this.addSubsegment(r),r.notTraced=!0,r};T.prototype.addSubsegment=function(e){if(!(e instanceof gt))throw new Error("Cannot add subsegment: "+e+". Not a subsegment.");this.subsegments===void 0&&(this.subsegments=[]),e.segment=this,e.parent=this,e.notTraced=e.parent.notTraced,this.subsegments.push(e),e.end_time||this.incrementCounter(e.counter)};T.prototype.removeSubsegment=function(e){if(!(e instanceof gt))throw new Error("Failed to remove subsegment:"+e+' from subsegment "'+this.name+'".  Not a subsegment.');if(this.subsegments!==void 0){var r=this.subsegments.indexOf(e);r>=0&&this.subsegments.splice(r,1)}};T.prototype.addError=function(e,r){if(e==null||typeof e!="object"&&typeof e!="string"){ne.getLogger().error("Failed to add error:"+e+' to subsegment "'+this.name+'".  Not an object or string literal.');return}if(this.addFaultFlag(),this.exception){if(e===this.exception.ex){this.cause={id:this.exception.cause},delete this.exception;return}delete this.exception}this.cause===void 0&&(this.cause={working_directory:process.cwd(),exceptions:[]}),this.cause.exceptions.push(new Su(e,r))};T.prototype.addFaultFlag=function(){this.fault=!0};T.prototype.addErrorFlag=function(){this.error=!0};T.prototype.addThrottleFlag=function(){this.throttle=!0};T.prototype.isClosed=function(){return!this.in_progress};T.prototype.incrementCounter=function(e){if(this.counter=e?this.counter+e+1:this.counter+1,this.counter>V.streamingThreshold&&this.subsegments&&this.subsegments.length>0){var r=[];this.subsegments.forEach(function(n){n.streamSubsegments()||r.push(n)}),this.subsegments=r}};T.prototype.decrementCounter=function(){this.counter--,this.counter<=0&&this.isClosed()&&this.flush()};T.prototype.close=function(t,e){this.end_time||(this.end_time=V.getCurrentTime()),t!==void 0&&this.addError(t,e),delete this.in_progress,delete this.exception,this.counter<=0&&this.flush()};T.prototype.flush=function(){if(this.notTraced!==!0){delete this.exception;var e=Cn.objectWithoutProperties(this,["counter","notTraced"],!0);yu.send(e)}};T.prototype.format=function(){var e=["segment","parent","counter"];(this.subsegments==null||this.subsegments.length===0)&&e.push("subsegments");var r=Cn.objectWithoutProperties(this,e,!1);return JSON.stringify(r)};T.prototype.toString=function(){return JSON.stringify(this)};Nn.exports=T});var oe=p((Dd,$n)=>{"use strict";var Be=tn(),Q=A(),Qt=Fe(),xn=Pe(),se=!0,ie="AWSXRay",Ln="segment",On=!1,O={CONTEXT_MISSING_STRATEGY:{RUNTIME_ERROR:{contextMissing:function(e){throw new Error(e)}},LOG_ERROR:{contextMissing:function(e){var r=new Error(e);Q.getLogger().error(r.stack)}},IGNORE_ERROR:{contextMissing:function(){}}},contextMissingStrategy:{},resolveManualSegmentParams:function(e){if(e&&!O.isAutomaticMode()){var r=e.XRaySegment||e.XraySegment,n=e.Segment,s=null;return r&&(r instanceof Qt||r instanceof xn)?(s=r,delete e.XRaySegment,delete e.XraySegment):n&&(n instanceof Qt||n instanceof xn)&&(s=n,delete e.Segment),s}},getNamespace:function(){return Be.getNamespace(ie)||Be.createNamespace(ie)},resolveSegment:function(e){if(se)return this.getSegment();if(e&&!se)return e;!e&&!se&&O.contextMissingStrategy.contextMissing("No sub/segment specified. A sub/segment must be provided for manual mode.")},getSegment:function(){if(se){var e=O.getNamespace(ie).get(Ln);return e?e instanceof Qt&&process.env.LAMBDA_TASK_ROOT&&e.facade==!0&&e.resolveLambdaTraceData():O.contextMissingStrategy.contextMissing("Failed to get the current sub/segment from the context."),e}else O.contextMissingStrategy.contextMissing("Cannot get sub/segment from context. Not supported in manual mode.")},setSegment:function(e){se?O.getNamespace(ie).set(Ln,e)||Q.getLogger().warn("Failed to set the current sub/segment on the context."):O.contextMissingStrategy.contextMissing("Cannot set sub/segment on context. Not supported in manual mode.")},isAutomaticMode:function(){return se},enableAutomaticMode:function(){se=!0,O.getNamespace(ie),Q.getLogger().debug("Overriding AWS X-Ray SDK mode. Set to automatic mode.")},enableManualMode:function(){se=!1,Be.getNamespace(ie)&&Be.destroyNamespace(ie),Q.getLogger().debug("Overriding AWS X-Ray SDK mode. Set to manual mode.")},setContextMissingStrategy:function(e){if(On)Q.getLogger().warn("Ignoring call to setContextMissingStrategy as AWS_XRAY_CONTEXT_MISSING is set. The current context missing strategy will not be changed.");else if(typeof e=="string"){var r=O.CONTEXT_MISSING_STRATEGY[e.toUpperCase()];if(r)O.contextMissingStrategy.contextMissing=r.contextMissing,process.env.AWS_XRAY_CONTEXT_MISSING?Q.getLogger().debug("AWS_XRAY_CONTEXT_MISSING is set. Configured context missing strategy to "+process.env.AWS_XRAY_CONTEXT_MISSING+"."):Q.getLogger().debug("Configured context missing strategy to: "+e);else throw new Error("Invalid context missing strategy: "+e+". Valid values are "+Object.keys(O.CONTEXT_MISSING_STRATEGY)+".")}else if(typeof e=="function")O.contextMissingStrategy.contextMissing=e,Q.getLogger().info("Configured custom context missing strategy to function: "+e.name);else throw new Error("Context missing strategy must be either a string or a custom function.")}};Be.createNamespace(ie);Q.getLogger().debug("Starting the AWS X-Ray SDK in automatic mode (default).");process.env.AWS_XRAY_CONTEXT_MISSING?(O.setContextMissingStrategy(process.env.AWS_XRAY_CONTEXT_MISSING),On=!0):(O.contextMissingStrategy.contextMissing=O.CONTEXT_MISSING_STRATEGY.LOG_ERROR.contextMissing,Q.getLogger().debug("Using default context missing strategy: LOG_ERROR"));$n.exports=O});var zt=p((kd,Dn)=>{"use strict";var{getHttpResponseData:Tu}=re();function Yt(t){this.init(t)}Yt.prototype.init=function(e){var r=!!e.headers["x-forwarded-for"],n;e.connection&&(n=(e.connection.secure||e.connection.encrypted?"https://":"http://")+((e.headers.host||"")+(e.url||""))),this.request={method:e.method||"",user_agent:e.headers["user-agent"]||"",client_ip:bu(e)||"",url:n||""},r&&(this.request.x_forwarded_for=r)};var bu=function(e){var r;return e.headers["x-forwarded-for"]?r=(e.headers["x-forwarded-for"]||"").split(",")[0]:e.connection&&e.connection.remoteAddress?r=e.connection.remoteAddress:e.socket&&e.socket.remoteAddress?r=e.socket.remoteAddress:e.connection&&e.connection.socket&&e.connection.socket.remoteAddress&&(r=e.connection.socket.remoteAddress),r};Yt.prototype.close=function(e){this.response=Tu(e)};Dn.exports=Yt});var Mn=p((Md,kn)=>{"use strict";function Jt(t,e){this.init(t,e)}Jt.prototype.init=function(e,r){if(this.usedThisSecond=0,typeof e=="number"&&e%1===0&&e>=0)this.fixedTarget=e;else throw new Error('Error in sampling file. Rule attribute "fixed_target" must be a non-negative integer.');if(typeof r=="number"&&r>=0&&r<=1)this.fallbackRate=r;else throw new Error('Error in sampling file. Rule attribute "rate" must be a number between 0 and 1 inclusive.')};Jt.prototype.isSampled=function(){var e=Math.round(new Date().getTime()/1e3);return e!==this.thisSecond&&(this.usedThisSecond=0,this.thisSecond=e),this.usedThisSecond>=this.fixedTarget?Math.random()<this.fallbackRate:(this.usedThisSecond++,!0)};kn.exports=Jt});var Pn=p((Pd,Ru)=>{Ru.exports={default:{fixed_target:1,rate:.05},version:2}});var er=p((Fd,Gn)=>{"use strict";var Au=require("fs"),Fn=Mn(),Zt=L(),qu=Pn(),mt=A(),Un={shouldSample:function(e){var r=e.host,n=e.httpMethod,s=e.urlPath,i="{ http_method: "+n+", host: "+r+", url_path: "+s+" }",o;return this.rules.some(function(a){if(a.default||r==null||Zt.wildcardMatch(a.host,r)&&(n==null||Zt.wildcardMatch(a.http_method,n))&&(s==null||Zt.wildcardMatch(a.url_path,s)))return o=a.reservoir,mt.getLogger().debug("Local sampling rule match found for "+i+". Matched "+(a.default?"default":"{ http_method: "+a.http_method+", host: "+a.host+", url_path: "+a.url_path+" }")+". Using fixed_target: "+o.fixedTarget+" and rate: "+o.fallbackRate+"."),!0}),o?o.isSampled():(mt.getLogger().debug("No sampling rule matched for "+i),!1)},setLocalRules:function(e){e?typeof e=="string"?(mt.getLogger().info("Using custom sampling rules file: "+e),this.rules=Bn(JSON.parse(Au.readFileSync(e,"utf8")))):(mt.getLogger().info("Using custom sampling rules source."),this.rules=Bn(e)):this.rules=Wn(qu)}},Bn=function(e){if(!e.version)throw new Error('Error in sampling file. Missing "version" attribute.');if(e.version===1||e.version===2)return Wn(e);throw new Error('Error in sampling file. Unknown version "'+e.version+'".')},Wn=function(e){var r,n=[];if(e.default){var s=[];for(var i in e.default){if(i!=="fixed_target"&&i!=="rate")throw new Error("Error in sampling file. Invalid attribute for default: "+i+'. Valid attributes for default are "fixed_target" and "rate".');if(typeof e.default[i]!="number")throw new Error("Error in sampling file. Default "+i+" must be a number.")}if(typeof e.default.fixed_target>"u"&&s.push("fixed_target"),typeof e.default.rate>"u"&&s.push("rate"),s.length!==0)throw new Error("Error in sampling file. Missing required attributes for default: "+s+".");r={default:!0,reservoir:new Fn(e.default.fixed_target,e.default.rate)}}else throw new Error('Error in sampling file. Expecting "default" object to be defined with attributes "fixed_target" and "rate".');return Array.isArray(e.rules)&&e.rules.forEach(function(o){var a={},u;e.version===2&&(u={host:1,http_method:1,url_path:1,fixed_target:1,rate:1}),e.version===1&&(u={service_name:1,http_method:1,url_path:1,fixed_target:1,rate:1});for(var c in o){var l=o[c];if(!u[c]&&c!="description")throw new Error("Error in sampling file. Rule "+JSON.stringify(o)+" has invalid attribute: "+c+".");if(c!="description"&&!l&&l!==0)throw new Error("Error in sampling file. Rule "+JSON.stringify(o)+' attribute "'+c+'" has invalid value: '+l+".");e.version===2&&(a[c]=l),e.version===1&&c==="service_name"?a.host=l:a[c]=l,delete u[c]}if(Object.keys(u).length!==0&&u.constructor===Object)throw new Error("Error in sampling file. Rule "+JSON.stringify(o)+" is missing required attributes: "+Object.keys(u)+".");var f=a;f.reservoir=new Fn(o.fixed_target,o.rate),n.push(f)}),n.push(r),n};Un.setLocalRules();Gn.exports=Un});var Hn=p((Bd,Xn)=>{"use strict";function Ee(){this.init()}Ee.prototype.init=function(){this.quota=null,this.TTL=null,this.takenThisSec=0,this.borrowedThisSec=0,this.reportInterval=1,this.reportElapsed=0};Ee.prototype.borrowOrTake=function(e,r){if(this.adjustThisSec(e),this.quota>=0&&this.TTL>=e)return this.takenThisSec>=this.quota?!1:(this.takenThisSec++,"take");if(r)return this.borrowedThisSec>=1?!1:(this.borrowedThisSec++,"borrow")};Ee.prototype.adjustThisSec=function(e){e!==this.thisSec&&(this.takenThisSec=0,this.borrowedThisSec=0,this.thisSec=e)};Ee.prototype.loadNewQuota=function(e,r,n){e&&(this.quota=e),r&&(this.TTL=r),n&&(this.reportInterval=n/10)};Ee.prototype.timeToReport=function(){return this.reportElapsed+1>=this.reportInterval?(this.reportElapsed=0,!0):(this.reportElapsed+=1,!1)};Xn.exports=Ee});var Vn=p((Ud,jn)=>{"use strict";var Ue=L(),Iu=Hn();function N(t,e,r,n,s,i,o,a,u){this.init(t,e,r,n,s,i,o,a,u)}N.prototype.init=function(e,r,n,s,i,o,a,u,c){this.name=e,this.priority=r,this.rate=n,this.host=i,this.httpMethod=o,this.urlPath=a,this.serviceName=u,this.serviceType=c,this.reservoir=new Iu,this.borrow=!!s,this.resetStatistics()};N.prototype.match=function(e){var r=e.host,n=e.httpMethod,s=e.serviceName,i=e.urlPath,o=e.serviceType;return this.isDefault()||(!r||Ue.wildcardMatch(this.host,r))&&(!n||Ue.wildcardMatch(this.httpMethod,n))&&(!s||Ue.wildcardMatch(this.serviceName,s))&&(!i||Ue.wildcardMatch(this.urlPath,i))&&(!o||Ue.wildcardMatch(this.serviceType,o))};N.prototype.snapshotStatistics=function(){var e={requestCount:this.requestCount,borrowCount:this.borrowCount,sampledCount:this.sampledCount};return this.resetStatistics(),e};N.prototype.merge=function(e){this.reservoir=e.reservoir,this.requestCount=e.requestCount,this.borrowCount=e.borrowCount,this.sampledCount=e.sampledCount,e=null};N.prototype.isDefault=function(){return this.name==="Default"};N.prototype.incrementRequestCount=function(){this.requestCount++};N.prototype.incrementBorrowCount=function(){this.borrowCount++};N.prototype.incrementSampledCount=function(){this.sampledCount++};N.prototype.setRate=function(e){this.rate=e};N.prototype.getRate=function(){return this.rate};N.prototype.getName=function(){return this.name};N.prototype.getPriority=function(){return this.priority};N.prototype.getReservoir=function(){return this.reservoir};N.prototype.resetStatistics=function(){this.requestCount=0,this.borrowCount=0,this.sampledCount=0};N.prototype.canBorrow=function(){return this.borrow};N.prototype.everMatched=function(){return this.requestCount>0};N.prototype.timeToReport=function(){return this.reservoir.timeToReport()};jn.exports=N});var tr=p((Wd,zn)=>{"use strict";var wu=require("crypto"),Cu=A(),Nu=Vn(),vt=lt(),xu=require("util"),Lu=require("http"),Qn={clientId:wu.randomBytes(12).toString("hex"),samplingRulesPath:"/GetSamplingRules",samplingTargetsPath:"/SamplingTargets",logger:Cu,httpClient:Lu,fetchSamplingRules:function(e){let r="{}",n=Kn(this.samplingRulesPath,r.length),i=(this.httpClient.__request?this.httpClient.__request:this.httpClient.request)(n,o=>{var a="";o.on("data",u=>{a+=u}),o.on("error",u=>{e(u)}),o.on("end",()=>{var u;try{u=JSON.parse(a)}catch(l){e(l);return}if(!u){e(new Error("AWS X-Ray GetSamplingRules API returned empty response"));return}var c=$u(u);e(null,c)})});i.on("error",()=>{e(new Error(`Failed to connect to X-Ray daemon at ${n.hostname}:${n.port} to get sampling rules.`))}),i.write(r),i.end()},fetchTargets:function(e,r){let n=JSON.stringify(Ou(e)),s=Kn(this.samplingTargetsPath,n.length),o=(this.httpClient.__request?this.httpClient.__request:this.httpClient.request)(s,a=>{var u="";a.on("data",c=>{u+=c}),a.on("error",c=>{r(c)}),a.on("end",()=>{var c;try{c=JSON.parse(u)}catch(m){r(m);return}if(!c||typeof c.LastRuleModification!="number"){r(new Error("AWS X-Ray SamplingTargets API returned invalid response"));return}var l=Du(c),f=Yn(c.LastRuleModification);r(null,l,f)})});o.on("error",()=>{r(new Error(`Failed to connect to X-Ray daemon at ${s.hostname}:${s.port} to get sampling targets.`))}),o.write(n),o.end()}},Ou=function(e){var r=[],n=Math.floor(new Date().getTime()/1e3);return e.forEach(function(s){var i=s.snapshotStatistics(),o={RuleName:s.getName(),ClientID:Qn.clientId,RequestCount:i.requestCount,BorrowCount:i.borrowCount,SampledCount:i.sampledCount,Timestamp:n};r.push(o)}),{SamplingStatisticsDocuments:r}},$u=function(e){var r=[],n=e.SamplingRuleRecords||[];return n.forEach(function(s){if(s=s.SamplingRule,ku(s)){var i=new Nu(s.RuleName,s.Priority,s.FixedRate,s.ReservoirSize,s.Host,s.HTTPMethod,s.URLPath,s.ServiceName,s.ServiceType);r.push(i)}}),r},Du=function(e){var r=e.SamplingTargetDocuments||[],n={};return r.forEach(function(s){var i={rate:s.FixedRate,quota:s.ReservoirQuota,TTL:Yn(s.ReservoirQuotaTTL),interval:s.Interval};n[s.RuleName]=i}),n},ku=function(e){return e.Version===1&&e.ResourceARN==="*"&&e.Attributes&&Object.keys(e.Attributes).length===0&&e.ServiceType&&e.RuleName&&e.Priority&&typeof e.FixedRate=="number"},Yn=function(e){return new Date(e).getTime()/1e3},Kn=function(e,r){return{hostname:vt.tcp_ip,port:vt.tcp_port,method:"POST",path:e,headers:{"Content-Type":"application/json","Content-Length":r,Host:xu.format("%s:%d",vt.tcp_ip,vt.tcp_port)}}};zn.exports=Qn});var _t=p((Gd,Jn)=>{"use strict";var Mu=3600,rr={rules:[],lastUpdated:null,getMatchedRule:function(e,r){if(Pu(r))return null;var n;return this.rules.forEach(function(s){!n&&s.match(e)&&(n=s),s.isDefault()&&!n&&(n=s)}),n},loadRules:function(e){var r={};this.rules.forEach(function(n){r[n.getName()]=n}),this.rules=e,this.rules.forEach(function(n){var s=r[n.getName()];s&&n.merge(s)}),this.rules.sort(function(n,s){var i=n.getPriority()-s.getPriority();return i!==0?i:n.getName()>s.getName()?1:-1})},loadTargets:function(e){this.rules.forEach(function(r){var n=e[r.getName()];n&&(r.getReservoir().loadNewQuota(n.quota,n.TTL,n.interval),r.setRate(n.rate))})},getRules:function(){return this.rules},timestamp:function(e){this.lastUpdated=e},getLastUpdated:function(){return this.lastUpdated}},Pu=function(e){return rr.getLastUpdated()?e>rr.getLastUpdated()+Mu:!0};Jn.exports=rr});var sr=p((Xd,rs)=>{"use strict";var nr=A(),Fu=tr(),Zn=_t(),Bu=5*60*1e3,Uu={start:function(){this.poller&&clearInterval(this.poller),es(!1),this.poller=setInterval(es,Bu),this.poller.unref()}},es=function(e){if(e=typeof e>"u"?!0:e,e){var r=Gu();setTimeout(ts,r)}else ts()},ts=function(){try{Wu()}catch(e){nr.getLogger().warn("Encountered unexpected exception when fetching sampling rules: "+e)}},Wu=function(){var e=Math.floor(new Date().getTime()/1e3);Fu.fetchSamplingRules(function(r,n){r?nr.getLogger().warn("Failed to retrieve sampling rules from X-Ray service:",r):n.length!==0&&(Zn.loadRules(n),Zn.timestamp(e),nr.getLogger().info("Successfully refreshed centralized sampling rule cache."))})},Gu=function(){return Math.random()*5};rs.exports=Uu});var os=p((Hd,is)=>{"use strict";var Xu=sr(),Hu=tr(),ir=_t(),Et=A(),ns=10*1e3,ss={interval:ns,start:function(){this.poller=setInterval(ju,ns+Qu()),this.poller.unref()}},ju=function(){try{Vu()}catch(e){Et.getLogger().warn("Encountered unexpected exception when fetching sampling targets: "+e)}},Vu=function(){var e=Ku();e&&e.length>0&&Hu.fetchTargets(e,function(r,n,s){if(r){Et.getLogger().warn("Failed to retrieve sampling targets from X-Ray service:",r);return}ir.loadTargets(n),s>ir.getLastUpdated()&&(Et.getLogger().info("Performing out-of-band sampling rule polling to fetch updated rules."),Xu.start()),Et.getLogger().info("Successfully reported rule statistics to get new sampling quota.")})},Ku=function(){var e=ir.getRules(),r=[];return e.forEach(function(n){n.everMatched()&&n.timeToReport()&&r.push(n)}),r},Qu=function(){return Math.random()/ss.interval};is.exports=ss});var us=p((jd,as)=>{"use strict";var or=A(),Yu=require("util"),zu=re(),Ju={localSampler:er(),rulePoller:sr(),targetPoller:os(),ruleCache:_t(),started:!1,shouldSample:function(e){try{this.started||this.start(),e.serviceType||(e.serviceType=zu.origin);var r=Math.floor(new Date().getTime()/1e3),n=this.ruleCache.getMatchedRule(e,r);return n?(or.getLogger().debug(Yu.format("Rule %s is matched.",n.getName())),Zu(n,r)):(or.getLogger().info("No effective centralized sampling rule match. Fallback to local rules."),this.localSampler.shouldSample(e))}catch(s){or.getLogger().error("Unhandled exception by the SDK during making sampling decisions: "+s)}},setLocalRules:function(e){this.localSampler.setLocalRules(e)},start:function(){this.started||(this.rulePoller.start(),this.targetPoller.start(),this.started=!0)}},Zu=function(e,r){e.incrementRequestCount();var n=e.getReservoir(),s=!0,i=n.borrowOrTake(r,e.canBorrow());return i==="borrow"?e.incrementBorrowCount():i==="take"||Math.random()<=e.getRate()?e.incrementSampledCount():s=!1,s?e.getName():!1};as.exports=Ju});var ur=p((Vd,cs)=>{"use strict";var ec=Fe(),tc=zt(),rc=A(),nc=L(),sc=L().wildcardMatch,ic=L().processTraceData,ar="x-amzn-trace-id",oc=!!process.env.AWS_XRAY_TRACING_NAME,ac={defaultName:process.env.AWS_XRAY_TRACING_NAME,dynamicNaming:!1,hostPattern:null,sampler:us(),enableDynamicNaming:function(t){if(this.dynamicNaming=!0,t&&typeof t!="string")throw new Error("Host pattern must be a string.");this.hostPattern=t||null},processHeaders:function(e){var r={};return e&&e.headers&&e.headers[ar]&&(r=ic(e.headers[ar])),r},resolveName:function(e){var r;return this.dynamicNaming&&e?r=this.hostPattern?sc(this.hostPattern,e)?e:this.defaultName:e:r=this.defaultName,r},resolveSampling:function(e,r,n){var s;if(e.sampled==="1")s=!0;else if(e.sampled==="0")s=!1;else{var i={host:n.req.headers.host,httpMethod:n.req.method,urlPath:n.req.url,serviceName:r.name};s=this.sampler.shouldSample(i),(s instanceof String||typeof s=="string")&&(r.setMatchedSamplingRule(s),s=!0)}e.sampled==="?"&&(n.header[ar]="Root="+e.root+";Sampled="+(s?"1":"0")),s||(r.notTraced=!0)},setDefaultName:function(e){oc||(this.defaultName=e)},disableCentralizedSampling:function(){this.sampler=er()},setSamplingRules:function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local sampling rules file, or supply an object containing the rules.");this.sampler.setLocalRules(e)},middlewareLog:function(e,r,n){rc.getLogger().debug(e+": { url: "+r+", name: "+n.name+", trace_id: "+n.trace_id+", id: "+n.id+", sampled: "+!n.notTraced+" }")},traceRequestResponseCycle:function(e,r){var n=this.processHeaders(e),s=this.resolveName(e.headers.host),i=new ec(s,n.root,n.parent),o=Object.assign({},r,{req:e});this.resolveSampling(n,i,o),i.addIncomingRequestData(new tc(e)),this.middlewareLog("Starting middleware segment",e.url,i);var a=this.middlewareLog,u=!1,c=function(){if(u)return;u=!0,r.statusCode===429&&i.addThrottleFlag();let l=nc.getCauseTypeFromHttpStatus(r.statusCode);l&&(i[l]=!0),i.http.close(r),i.close(),a("Closed middleware segment successfully",e.url,i)};return r.on("finish",c),r.on("close",c),i}};cs.exports=ac});var fs=p((Kd,ps)=>{"use strict";var St=oe(),uc=ur(),cr=L().LambdaUtils,cc=Fe(),lc=ft(),pc=re(),pr=A(),ls=ht(),lr=null;ps.exports.init=function(){St.enableManualMode=function(){pr.getLogger().warn("AWS Lambda does not support AWS X-Ray manual mode.")},lc.disableReusableSocket(),pc.setStreamingThreshold(0),pr.getLogger().info("Disabling centralized sampling in Lambda environment."),uc.disableCentralizedSampling();var e=St.getNamespace();e.enter(e.createContext()),St.setSegment(fc())};var fc=function(){var e=new cc("facade"),r=["addNewSubsegment","addSubsegment","removeSubsegment","toString","addSubsegmentWithoutSampling","addNewSubsegmentWithoutSampling"],n=["incrementCounter","decrementCounter","isClosed","close","format","flush"],s=process.env._X_AMZN_TRACE_ID;for(var i in e)typeof e[i]=="function"&&r.indexOf(i)===-1&&(n.indexOf(i)===-1?e[i]=function(){var o=i;return function(){pr.getLogger().warn('Function "'+o+'" cannot be called on an AWS Lambda segment. Please use a subsegment to record data.')}}():e[i]=function(){});return e.trace_id=ls.Invalid().toString(),e.isClosed=function(){return!0},e.in_progress=!1,e.counter=1,e.notTraced=!0,e.facade=!0,e.reset=function(){this.trace_id=ls.Invalid().toString(),this.id="00000000",delete this.subsegments,this.notTraced=!0},e.resolveLambdaTraceData=function(){var a=process.env._X_AMZN_TRACE_ID;a?a!=lr&&(this.reset(),cr.populateTraceData(e,a)&&(lr=a)):(this.reset(),St.contextMissingStrategy.contextMissing("Missing AWS Lambda trace data for X-Ray. Ensure Active Tracing is enabled and no subsegments are created outside the function handler."))},cr.validTraceData(s)&&cr.populateTraceData(e,s)&&(lr=s),e}});var ds=p((Qd,dc)=>{dc.exports={name:"aws-xray-sdk-core",version:"3.5.0",description:"AWS X-Ray SDK for Javascript",author:"Amazon Web Services",contributors:["Sandra McMullen <mcmuls@amazon.com>","William Armiros <armiros@amazon.com>","Moritz Onken <onken@netcubed.de>"],files:["dist/lib/**/*","LICENSE","README.md"],main:"dist/lib/index.js",types:"dist/lib/index.d.ts",engines:{node:">= 14.x"},directories:{test:"test"},"//":"@types/cls-hooked is exposed in API so must be in dependencies, not devDependencies",dependencies:{"@aws-sdk/service-error-classification":"^3.4.1","@aws-sdk/types":"^3.4.1","@types/cls-hooked":"^4.3.3","atomic-batcher":"^1.0.2","cls-hooked":"^4.2.2",semver:"^7.3.8"},scripts:{prepare:"npm run compile",compile:"tsc && npm run copy-lib && npm run copy-test","copy-lib":"find lib -type f \\( -name '*.d.ts' -o -name '*.json' \\) | xargs -I % ../../scripts/cp-with-structure.sh % dist","copy-test":"find test -name '*.json' | xargs -I % ../../scripts/cp-with-structure.sh % dist",lint:"eslint .","lint:fix":"eslint . --fix",test:"npm run compile && mocha --recursive ./dist/test/ -R spec && tsd && mocha --recursive ./dist/test_async/ -R spec","test-d":"tsd","test-async":"npm run compile && mocha --recursive ./dist/test_async/ -R spec",clean:"rm -rf dist && rm -rf node_modules",testcov:"nyc npm run test",reportcov:"nyc report --reporter=text-lcov > coverage.lcov && codecov"},keywords:["amazon","api","aws","core","xray","x-ray","x ray"],license:"Apache-2.0",repository:"https://github.com/aws/aws-xray-sdk-node/tree/master/packages/core",gitHead:"0579d9c75e08f8747f9eb87596bea58a7d7e9e25"}});var ms=p((Yd,gs)=>{"use strict";var fr=require("http"),hs={METADATA_TIMEOUT:1e3,getPluginMetadata:function(t,e){var s=5,i=function(){var o=fr.__request?fr.__request:fr.request,a=o(t,function(u){var c="";u.on("data",function(l){c+=l}),u.on("end",function(){if(this.statusCode===200||this.statusCode===300){try{c=JSON.parse(c)}catch(l){e(l);return}e(null,c)}else s>0&&Math.floor(this.statusCode/100)===5?(s--,setTimeout(i,250)):e(new Error(`Failed to retrieve metadata with options: ${t}`))})});a.on("error",function(u){e(u)}),a.on("timeout",function(){a.abort()}),a.setTimeout(hs.METADATA_TIMEOUT),a.end()};i()}};gs.exports=hs});var ys=p((zd,Ss)=>{"use strict";var _s=ms(),vs=A(),dr=require("http"),hc={getData:function(t){let e="/latest/dynamic/instance-identity/document";function r(n){let s=Es(e,"GET",n?{"X-aws-ec2-metadata-token":n}:{});_s.getPluginMetadata(s,function(i,o){if(i||!o){vs.getLogger().error("Error loading EC2 plugin metadata: ",i?i.toString():"Could not retrieve data from IMDS."),t();return}let a={ec2:{instance_id:o.instanceId,availability_zone:o.availabilityZone,instance_size:o.instanceType,ami_id:o.imageId}};t(a)})}gc(function(n){n===null&&vs.getLogger().debug("EC2Plugin failed to get token from IMDSv2. Falling back to IMDSv1."),r(n)})},originName:"AWS::EC2::Instance"};function gc(t){let e=dr.__request?dr.__request:dr.request,s=Es("/latest/api/token","PUT",{"X-aws-ec2-metadata-token-ttl-seconds":60}),i=e(s,function(o){let a="";o.on("data",function(u){a+=u}),o.on("end",function(){this.statusCode===200||this.statusCode===300?t(a):t(null)})});i.on("error",function(){t(null)}),i.on("timeout",function(){i.abort(),t(null)}),i.setTimeout(_s.METADATA_TIMEOUT),i.end()}function Es(t,e,r){return e||(e="GET"),r||(r={}),{host:"169.254.169.254",path:t,method:e,headers:r}}Ss.exports=hc});var bs=p((Jd,Ts)=>{"use strict";var mc=require("os"),vc={getData:function(t){t({ecs:{container:mc.hostname()}})},originName:"AWS::ECS::Container"};Ts.exports=vc});var As=p((Zd,Rs)=>{"use strict";var _c=require("fs"),Ec=A(),Sc="/var/elasticbeanstalk/xray/environment.conf",yc={getData:function(t){_c.readFile(Sc,"utf8",function(e,r){if(e)Ec.getLogger().error("Error loading Elastic Beanstalk plugin:",e.stack),t();else{var n=JSON.parse(r),s={elastic_beanstalk:{environment:n.environment_name,version_label:n.version_label,deployment_id:n.deployment_id}};t(s)}})},originName:"AWS::ElasticBeanstalk::Environment"};Rs.exports=yc});var qs=p((eh,Tc)=>{Tc.exports={services:{dynamodb:{operations:{batchGetItem:{request_descriptors:{RequestItems:{get_keys:!0,rename_to:"table_names"}},response_parameters:["ConsumedCapacity"]},batchWriteItem:{request_descriptors:{RequestItems:{get_keys:!0,rename_to:"table_names"}},response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},createTable:{request_parameters:["GlobalSecondaryIndexes","LocalSecondaryIndexes","ProvisionedThroughput","TableName"]},deleteItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},deleteTable:{request_parameters:["TableName"]},describeTable:{request_parameters:["TableName"]},getItem:{request_parameters:["ConsistentRead","ProjectionExpression","TableName"],response_parameters:["ConsumedCapacity"]},listTables:{request_parameters:["ExclusiveStartTableName","Limit"],response_descriptors:{TableNames:{list:!0,get_count:!0,rename_to:"table_count"}}},putItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},query:{request_parameters:["AttributesToGet","ConsistentRead","IndexName","Limit","ProjectionExpression","ScanIndexForward","Select","TableName"],response_parameters:["ConsumedCapacity"]},scan:{request_parameters:["AttributesToGet","ConsistentRead","IndexName","Limit","ProjectionExpression","Segment","Select","TableName","TotalSegments"],response_parameters:["ConsumedCapacity","Count","ScannedCount"]},updateItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},updateTable:{request_parameters:["AttributeDefinitions","GlobalSecondaryIndexUpdates","ProvisionedThroughput","TableName"]}}},sqs:{operations:{addPermission:{request_parameters:["Label","QueueUrl"]},changeMessageVisibility:{request_parameters:["QueueUrl","VisibilityTimeout"]},changeMessageVisibilityBatch:{request_parameters:["QueueUrl"],response_parameters:["Failed"]},createQueue:{request_parameters:["Attributes","QueueName"]},deleteMessage:{request_parameters:["QueueUrl"]},deleteMessageBatch:{request_parameters:["QueueUrl"],response_parameters:["Failed"]},deleteQueue:{request_parameters:["QueueUrl"]},getQueueAttributes:{request_parameters:["QueueUrl"],response_parameters:["Attributes"]},getQueueUrl:{request_parameters:["QueueName","QueueOwnerAWSAccountId"],response_parameters:["QueueUrl"]},listDeadLetterSourceQueues:{request_parameters:["QueueUrl"],response_parameters:["QueueUrls"]},listQueues:{request_parameters:["QueueNamePrefix"],response_descriptors:{QueueUrls:{list:!0,get_count:!0,rename_to:"queue_count"}}},purgeQueue:{request_parameters:["QueueUrl"]},receiveMessage:{request_parameters:["AttributeNames","MaxNumberOfMessages","MessageAttributeNames","QueueUrl","VisibilityTimeout","WaitTimeSeconds"],response_descriptors:{Messages:{list:!0,get_count:!0,rename_to:"message_count"}}},removePermission:{request_parameters:["QueueUrl"]},sendMessage:{request_parameters:["DelaySeconds","QueueUrl"],request_descriptors:{MessageAttributes:{get_keys:!0,rename_to:"message_attribute_names"}},response_parameters:["MessageId"]},sendMessageBatch:{request_parameters:["QueueUrl"],request_descriptors:{Entries:{list:!0,get_count:!0,rename_to:"message_count"}},response_descriptors:{Failed:{list:!0,get_count:!0,rename_to:"failed_count"},Successful:{list:!0,get_count:!0,rename_to:"successful_count"}}},setQueueAttributes:{request_parameters:["QueueUrl"],request_descriptors:{Attributes:{get_keys:!0,rename_to:"attribute_names"}}}}},sns:{operations:{publish:{request_parameters:["TopicArn"]},publishBatch:{request_parameters:["TopicArn"]}}},lambda:{operations:{invoke:{request_parameters:["FunctionName","InvocationType","LogType","Qualifier"],response_parameters:["FunctionError","StatusCode"]},invokeAsync:{request_parameters:["FunctionName"],response_parameters:["Status"]}}},s3:{operations:{abortMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},completeMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},copyObject:{request_parameters:["CopySource","Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},createBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},createMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObjects:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAccelerateConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAcl:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLifecycleConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLocation:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLogging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketNotification:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketNotificationConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketRequestPayment:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketVersioning:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectAcl:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectTorrent:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},headBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},headObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketAnalyticsConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketInventoryConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketMetricsConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listMultipartUploads:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjectVersions:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjects:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjectsV2:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listParts:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAccelerateConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAcl:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLifecycleConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLogging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketNotification:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketNotificationConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketRequestPayment:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketVersioning:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObject:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObjectAcl:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},restoreObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},uploadPart:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},uploadPartCopy:{request_parameters:["CopySource","Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}}}},sagemakerruntime:{operations:{invokeEndpoint:{request_parameters:["EndpointName"]}}}}}});var Ls=p((th,xs)=>{"use strict";var Cs=require("fs"),Se=A(),bc=qs(),yt={REQ_DESC:"request_descriptors",REQ_PARAMS:"request_parameters",RES_DESC:"response_descriptors",RES_PARAMS:"response_parameters"};function bt(t){this.init(t)}bt.prototype.init=function(e){e?typeof e=="string"?(Se.getLogger().info("Using custom AWS whitelist file: "+e),this.services=Tt(JSON.parse(Cs.readFileSync(e,"utf8")))):(Se.getLogger().info("Using custom AWS whitelist source."),this.services=Tt(e)):this.services=bc.services};bt.prototype.append=function(e){var r={};typeof e=="string"?(Se.getLogger().info("Appending AWS whitelist with custom file: "+e),r=Tt(JSON.parse(Cs.readFileSync(e,"utf8")))):(Se.getLogger().info("Appending AWS whitelist with a custom source."),r=Tt(e));for(var n in r)this.services[n]=r[n]};bt.prototype.capture=function(e,r){var n=r.request.operation,s=this.services[e]!==void 0?this.services[e].operations[n]:null;if(s===null){Se.getLogger().debug('Call "'+e+"."+n+'" is not whitelisted for additional data capturing. Ignoring.');return}var i={};for(var o in s){var a=s[o];o===yt.REQ_PARAMS?Is(a,r.request.params,i):o===yt.REQ_DESC?ws(a,r.request.params,i):o===yt.RES_PARAMS?r.data&&Is(a,r.data,i):o===yt.RES_DESC?r.data&&ws(a,r.data,i):Se.getLogger().error('Unknown parameter type "'+o+'". Must be "request_descriptors", "response_descriptors", "request_parameters" or "response_parameters".')}return i};function Is(t,e,r){t.forEach(function(n){if(typeof e[n]<"u"){var s=Ns(n);this[s]=e[n]}},r)}function ws(t,e,r){for(var n in t){var s=t[n];if(typeof e[n]<"u"){var i;if(s.list&&s.get_count?i=e[n]?e[n].length:0:i=s.get_keys===!0?Object.keys(e[n]):e[n],typeof s.rename_to=="string")r[s.rename_to]=i;else{var o=Ns(n);r[o]=i}}}}function Ns(t){return t==="IPAddress"?"ip_address":t.split(/(?=[A-Z])/).join("_").toLowerCase()}function Tt(t){var e=t;if(e.services===void 0)throw new Error('Document formatting is incorrect. Expecting "services" param.');return e.services}xs.exports=bt});var We=p((rh,Rt)=>{"use strict";var Os=Ls(),hr=new Os;function gr(t,e){this.init(t,e)}gr.prototype.init=function(e,r){this.operation=qc(e.request.operation)||"",e&&e.request&&e.request.httpRequest&&e.request.httpRequest.region&&(this.region=e.request.httpRequest.region),e&&e.requestId&&(this.request_id=e.requestId),this.retries=e.retryCount||0,e.extendedRequestId&&r&&r.toLowerCase()==="s3"&&(this.id_2=e.extendedRequestId),r&&this.addData(hr.capture(r.toLowerCase(),e))};gr.prototype.addData=function(e){for(var r in e)this[r]=e[r]};var Rc=function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local whitelist file, or supply a whitelist source object.");hr=new Os(e)},Ac=function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local whitelist file, or supply a whitelist source object.");hr.append(e)};function qc(t){if(t)return t.charAt(0).toUpperCase()+t.slice(1)}Rt.exports=gr;Rt.exports.appendAWSWhitelist=Ac;Rt.exports.setAWSWhitelist=Rc});var qt=p((nh,At)=>{"use strict";var le=oe(),Ge=A(),$s=function(e,r,n){mr(e,r);var s,i,o=le.resolveSegment(n);if(!o)return Ge.getLogger().warn("Failed to capture function."),r();s=o.addNewSubsegment(e),i=Ds(r,s);try{let a=i(s);return s.close(),a}catch(a){throw s.close(a),a}},Ic=function(e,r,n){mr(e,r);var s,i,o=le.resolveSegment(n);if(!o)return Ge.getLogger().warn("Failed to capture async function."),r();s=o.addNewSubsegment(e),i=Ds(r,s);try{return i(s)}catch(a){throw s.close(a),a}},wc=function(e,r,n){mr(e,r);var s=le.resolveSegment(n);return s?(s.incrementCounter(),function(){var i=le.resolveSegment(n),o=Array.prototype.slice.call(arguments);$s(e,r.bind.apply(r,[null].concat(o)),i),s.decrementCounter()}.bind(this)):(Ge.getLogger().warn("Failed to capture callback function."),r)};function Ds(t,e){var r;if(le.isAutomaticMode()){var n=le.getNamespace(),s=function(){var i;return n.run(function(){le.setSegment(e),i=t(e)}),i};r=s}else r=t;return r}function mr(t,e){var r;if(!t||typeof t!="string")throw r='Param "name" must be a non-empty string.',Ge.getLogger().error(r),new Error(r);if(typeof e!="function")throw r='Param "fcn" must be a function.',Ge.getLogger().error(r),new Error(r)}At.exports.captureFunc=$s;At.exports.captureAsyncFunc=Ic;At.exports.captureCallbackFunc=wc});var Xe=p((sh,ks)=>{var Cc="2.0.0",Nc=Number.MAX_SAFE_INTEGER||9007199254740991,xc=16,Lc=["major","premajor","minor","preminor","patch","prepatch","prerelease"];ks.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:xc,MAX_SAFE_INTEGER:Nc,RELEASE_TYPES:Lc,SEMVER_SPEC_VERSION:Cc,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var He=p((ih,Ms)=>{var Oc=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{};Ms.exports=Oc});var ye=p((ae,Ps)=>{var{MAX_SAFE_COMPONENT_LENGTH:vr}=Xe(),$c=He();ae=Ps.exports={};var Dc=ae.re=[],h=ae.src=[],g=ae.t={},kc=0,v=(t,e,r)=>{let n=kc++;$c(t,n,e),g[t]=n,h[n]=e,Dc[n]=new RegExp(e,r?"g":void 0)};v("NUMERICIDENTIFIER","0|[1-9]\\d*");v("NUMERICIDENTIFIERLOOSE","[0-9]+");v("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*");v("MAINVERSION",`(${h[g.NUMERICIDENTIFIER]})\\.(${h[g.NUMERICIDENTIFIER]})\\.(${h[g.NUMERICIDENTIFIER]})`);v("MAINVERSIONLOOSE",`(${h[g.NUMERICIDENTIFIERLOOSE]})\\.(${h[g.NUMERICIDENTIFIERLOOSE]})\\.(${h[g.NUMERICIDENTIFIERLOOSE]})`);v("PRERELEASEIDENTIFIER",`(?:${h[g.NUMERICIDENTIFIER]}|${h[g.NONNUMERICIDENTIFIER]})`);v("PRERELEASEIDENTIFIERLOOSE",`(?:${h[g.NUMERICIDENTIFIERLOOSE]}|${h[g.NONNUMERICIDENTIFIER]})`);v("PRERELEASE",`(?:-(${h[g.PRERELEASEIDENTIFIER]}(?:\\.${h[g.PRERELEASEIDENTIFIER]})*))`);v("PRERELEASELOOSE",`(?:-?(${h[g.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${h[g.PRERELEASEIDENTIFIERLOOSE]})*))`);v("BUILDIDENTIFIER","[0-9A-Za-z-]+");v("BUILD",`(?:\\+(${h[g.BUILDIDENTIFIER]}(?:\\.${h[g.BUILDIDENTIFIER]})*))`);v("FULLPLAIN",`v?${h[g.MAINVERSION]}${h[g.PRERELEASE]}?${h[g.BUILD]}?`);v("FULL",`^${h[g.FULLPLAIN]}$`);v("LOOSEPLAIN",`[v=\\s]*${h[g.MAINVERSIONLOOSE]}${h[g.PRERELEASELOOSE]}?${h[g.BUILD]}?`);v("LOOSE",`^${h[g.LOOSEPLAIN]}$`);v("GTLT","((?:<|>)?=?)");v("XRANGEIDENTIFIERLOOSE",`${h[g.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);v("XRANGEIDENTIFIER",`${h[g.NUMERICIDENTIFIER]}|x|X|\\*`);v("XRANGEPLAIN",`[v=\\s]*(${h[g.XRANGEIDENTIFIER]})(?:\\.(${h[g.XRANGEIDENTIFIER]})(?:\\.(${h[g.XRANGEIDENTIFIER]})(?:${h[g.PRERELEASE]})?${h[g.BUILD]}?)?)?`);v("XRANGEPLAINLOOSE",`[v=\\s]*(${h[g.XRANGEIDENTIFIERLOOSE]})(?:\\.(${h[g.XRANGEIDENTIFIERLOOSE]})(?:\\.(${h[g.XRANGEIDENTIFIERLOOSE]})(?:${h[g.PRERELEASELOOSE]})?${h[g.BUILD]}?)?)?`);v("XRANGE",`^${h[g.GTLT]}\\s*${h[g.XRANGEPLAIN]}$`);v("XRANGELOOSE",`^${h[g.GTLT]}\\s*${h[g.XRANGEPLAINLOOSE]}$`);v("COERCE",`(^|[^\\d])(\\d{1,${vr}})(?:\\.(\\d{1,${vr}}))?(?:\\.(\\d{1,${vr}}))?(?:$|[^\\d])`);v("COERCERTL",h[g.COERCE],!0);v("LONETILDE","(?:~>?)");v("TILDETRIM",`(\\s*)${h[g.LONETILDE]}\\s+`,!0);ae.tildeTrimReplace="$1~";v("TILDE",`^${h[g.LONETILDE]}${h[g.XRANGEPLAIN]}$`);v("TILDELOOSE",`^${h[g.LONETILDE]}${h[g.XRANGEPLAINLOOSE]}$`);v("LONECARET","(?:\\^)");v("CARETTRIM",`(\\s*)${h[g.LONECARET]}\\s+`,!0);ae.caretTrimReplace="$1^";v("CARET",`^${h[g.LONECARET]}${h[g.XRANGEPLAIN]}$`);v("CARETLOOSE",`^${h[g.LONECARET]}${h[g.XRANGEPLAINLOOSE]}$`);v("COMPARATORLOOSE",`^${h[g.GTLT]}\\s*(${h[g.LOOSEPLAIN]})$|^$`);v("COMPARATOR",`^${h[g.GTLT]}\\s*(${h[g.FULLPLAIN]})$|^$`);v("COMPARATORTRIM",`(\\s*)${h[g.GTLT]}\\s*(${h[g.LOOSEPLAIN]}|${h[g.XRANGEPLAIN]})`,!0);ae.comparatorTrimReplace="$1$2$3";v("HYPHENRANGE",`^\\s*(${h[g.XRANGEPLAIN]})\\s+-\\s+(${h[g.XRANGEPLAIN]})\\s*$`);v("HYPHENRANGELOOSE",`^\\s*(${h[g.XRANGEPLAINLOOSE]})\\s+-\\s+(${h[g.XRANGEPLAINLOOSE]})\\s*$`);v("STAR","(<|>)?=?\\s*\\*");v("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");v("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var It=p((oh,Fs)=>{var Mc=Object.freeze({loose:!0}),Pc=Object.freeze({}),Fc=t=>t?typeof t!="object"?Mc:t:Pc;Fs.exports=Fc});var _r=p((ah,Ws)=>{var Bs=/^[0-9]+$/,Us=(t,e)=>{let r=Bs.test(t),n=Bs.test(e);return r&&n&&(t=+t,e=+e),t===e?0:r&&!n?-1:n&&!r?1:t<e?-1:1},Bc=(t,e)=>Us(e,t);Ws.exports={compareIdentifiers:Us,rcompareIdentifiers:Bc}});var $=p((uh,js)=>{var wt=He(),{MAX_LENGTH:Gs,MAX_SAFE_INTEGER:Ct}=Xe(),{re:Xs,t:Hs}=ye(),Uc=It(),{compareIdentifiers:Te}=_r(),B=class{constructor(e,r){if(r=Uc(r),e instanceof B){if(e.loose===!!r.loose&&e.includePrerelease===!!r.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>Gs)throw new TypeError(`version is longer than ${Gs} characters`);wt("SemVer",e,r),this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease;let n=e.trim().match(r.loose?Xs[Hs.LOOSE]:Xs[Hs.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>Ct||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Ct||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Ct||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(s=>{if(/^[0-9]+$/.test(s)){let i=+s;if(i>=0&&i<Ct)return i}return s}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(wt("SemVer.compare",this.version,this.options,e),!(e instanceof B)){if(typeof e=="string"&&e===this.version)return 0;e=new B(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof B||(e=new B(e,this.options)),Te(this.major,e.major)||Te(this.minor,e.minor)||Te(this.patch,e.patch)}comparePre(e){if(e instanceof B||(e=new B(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let r=0;do{let n=this.prerelease[r],s=e.prerelease[r];if(wt("prerelease compare",r,n,s),n===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(n===void 0)return-1;if(n===s)continue;return Te(n,s)}while(++r)}compareBuild(e){e instanceof B||(e=new B(e,this.options));let r=0;do{let n=this.build[r],s=e.build[r];if(wt("prerelease compare",r,n,s),n===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(n===void 0)return-1;if(n===s)continue;return Te(n,s)}while(++r)}inc(e,r,n){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",r,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",r,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",r,n),this.inc("pre",r,n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",r,n),this.inc("pre",r,n);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let s=Number(n)?1:0;if(!r&&n===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[s];else{let i=this.prerelease.length;for(;--i>=0;)typeof this.prerelease[i]=="number"&&(this.prerelease[i]++,i=-2);if(i===-1){if(r===this.prerelease.join(".")&&n===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(s)}}if(r){let i=[r,s];n===!1&&(i=[r]),Te(this.prerelease[0],r)===0?isNaN(this.prerelease[1])&&(this.prerelease=i):this.prerelease=i}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.format(),this.raw=this.version,this}};js.exports=B});var pe=p((ch,Ks)=>{var Vs=$(),Wc=(t,e,r=!1)=>{if(t instanceof Vs)return t;try{return new Vs(t,e)}catch(n){if(!r)return null;throw n}};Ks.exports=Wc});var Ys=p((lh,Qs)=>{var Gc=pe(),Xc=(t,e)=>{let r=Gc(t,e);return r?r.version:null};Qs.exports=Xc});var Js=p((ph,zs)=>{var Hc=pe(),jc=(t,e)=>{let r=Hc(t.trim().replace(/^[=v]+/,""),e);return r?r.version:null};zs.exports=jc});var ti=p((fh,ei)=>{var Zs=$(),Vc=(t,e,r,n,s)=>{typeof r=="string"&&(s=n,n=r,r=void 0);try{return new Zs(t instanceof Zs?t.version:t,r).inc(e,n,s).version}catch{return null}};ei.exports=Vc});var si=p((dh,ni)=>{var ri=pe(),Kc=(t,e)=>{let r=ri(t,null,!0),n=ri(e,null,!0),s=r.compare(n);if(s===0)return null;let i=s>0,o=i?r:n,a=i?n:r,u=!!o.prerelease.length,c=u?"pre":"";return r.major!==n.major?c+"major":r.minor!==n.minor?c+"minor":r.patch!==n.patch?c+"patch":u?"prerelease":a.patch?"patch":a.minor?"minor":"major"};ni.exports=Kc});var oi=p((hh,ii)=>{var Qc=$(),Yc=(t,e)=>new Qc(t,e).major;ii.exports=Yc});var ui=p((gh,ai)=>{var zc=$(),Jc=(t,e)=>new zc(t,e).minor;ai.exports=Jc});var li=p((mh,ci)=>{var Zc=$(),el=(t,e)=>new Zc(t,e).patch;ci.exports=el});var fi=p((vh,pi)=>{var tl=pe(),rl=(t,e)=>{let r=tl(t,e);return r&&r.prerelease.length?r.prerelease:null};pi.exports=rl});var G=p((_h,hi)=>{var di=$(),nl=(t,e,r)=>new di(t,r).compare(new di(e,r));hi.exports=nl});var mi=p((Eh,gi)=>{var sl=G(),il=(t,e,r)=>sl(e,t,r);gi.exports=il});var _i=p((Sh,vi)=>{var ol=G(),al=(t,e)=>ol(t,e,!0);vi.exports=al});var Nt=p((yh,Si)=>{var Ei=$(),ul=(t,e,r)=>{let n=new Ei(t,r),s=new Ei(e,r);return n.compare(s)||n.compareBuild(s)};Si.exports=ul});var Ti=p((Th,yi)=>{var cl=Nt(),ll=(t,e)=>t.sort((r,n)=>cl(r,n,e));yi.exports=ll});var Ri=p((bh,bi)=>{var pl=Nt(),fl=(t,e)=>t.sort((r,n)=>pl(n,r,e));bi.exports=fl});var je=p((Rh,Ai)=>{var dl=G(),hl=(t,e,r)=>dl(t,e,r)>0;Ai.exports=hl});var xt=p((Ah,qi)=>{var gl=G(),ml=(t,e,r)=>gl(t,e,r)<0;qi.exports=ml});var Er=p((qh,Ii)=>{var vl=G(),_l=(t,e,r)=>vl(t,e,r)===0;Ii.exports=_l});var Sr=p((Ih,wi)=>{var El=G(),Sl=(t,e,r)=>El(t,e,r)!==0;wi.exports=Sl});var Lt=p((wh,Ci)=>{var yl=G(),Tl=(t,e,r)=>yl(t,e,r)>=0;Ci.exports=Tl});var Ot=p((Ch,Ni)=>{var bl=G(),Rl=(t,e,r)=>bl(t,e,r)<=0;Ni.exports=Rl});var yr=p((Nh,xi)=>{var Al=Er(),ql=Sr(),Il=je(),wl=Lt(),Cl=xt(),Nl=Ot(),xl=(t,e,r,n)=>{switch(e){case"===":return typeof t=="object"&&(t=t.version),typeof r=="object"&&(r=r.version),t===r;case"!==":return typeof t=="object"&&(t=t.version),typeof r=="object"&&(r=r.version),t!==r;case"":case"=":case"==":return Al(t,r,n);case"!=":return ql(t,r,n);case">":return Il(t,r,n);case">=":return wl(t,r,n);case"<":return Cl(t,r,n);case"<=":return Nl(t,r,n);default:throw new TypeError(`Invalid operator: ${e}`)}};xi.exports=xl});var Oi=p((xh,Li)=>{var Ll=$(),Ol=pe(),{re:$t,t:Dt}=ye(),$l=(t,e)=>{if(t instanceof Ll)return t;if(typeof t=="number"&&(t=String(t)),typeof t!="string")return null;e=e||{};let r=null;if(!e.rtl)r=t.match($t[Dt.COERCE]);else{let n;for(;(n=$t[Dt.COERCERTL].exec(t))&&(!r||r.index+r[0].length!==t.length);)(!r||n.index+n[0].length!==r.index+r[0].length)&&(r=n),$t[Dt.COERCERTL].lastIndex=n.index+n[1].length+n[2].length;$t[Dt.COERCERTL].lastIndex=-1}return r===null?null:Ol(`${r[2]}.${r[3]||"0"}.${r[4]||"0"}`,e)};Li.exports=$l});var Di=p((Lh,$i)=>{"use strict";$i.exports=function(t){t.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}});var Mi=p((Oh,ki)=>{"use strict";ki.exports=_;_.Node=fe;_.create=_;function _(t){var e=this;if(e instanceof _||(e=new _),e.tail=null,e.head=null,e.length=0,t&&typeof t.forEach=="function")t.forEach(function(s){e.push(s)});else if(arguments.length>0)for(var r=0,n=arguments.length;r<n;r++)e.push(arguments[r]);return e}_.prototype.removeNode=function(t){if(t.list!==this)throw new Error("removing node which does not belong to this list");var e=t.next,r=t.prev;return e&&(e.prev=r),r&&(r.next=e),t===this.head&&(this.head=e),t===this.tail&&(this.tail=r),t.list.length--,t.next=null,t.prev=null,t.list=null,e};_.prototype.unshiftNode=function(t){if(t!==this.head){t.list&&t.list.removeNode(t);var e=this.head;t.list=this,t.next=e,e&&(e.prev=t),this.head=t,this.tail||(this.tail=t),this.length++}};_.prototype.pushNode=function(t){if(t!==this.tail){t.list&&t.list.removeNode(t);var e=this.tail;t.list=this,t.prev=e,e&&(e.next=t),this.tail=t,this.head||(this.head=t),this.length++}};_.prototype.push=function(){for(var t=0,e=arguments.length;t<e;t++)kl(this,arguments[t]);return this.length};_.prototype.unshift=function(){for(var t=0,e=arguments.length;t<e;t++)Ml(this,arguments[t]);return this.length};_.prototype.pop=function(){if(this.tail){var t=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,t}};_.prototype.shift=function(){if(this.head){var t=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,t}};_.prototype.forEach=function(t,e){e=e||this;for(var r=this.head,n=0;r!==null;n++)t.call(e,r.value,n,this),r=r.next};_.prototype.forEachReverse=function(t,e){e=e||this;for(var r=this.tail,n=this.length-1;r!==null;n--)t.call(e,r.value,n,this),r=r.prev};_.prototype.get=function(t){for(var e=0,r=this.head;r!==null&&e<t;e++)r=r.next;if(e===t&&r!==null)return r.value};_.prototype.getReverse=function(t){for(var e=0,r=this.tail;r!==null&&e<t;e++)r=r.prev;if(e===t&&r!==null)return r.value};_.prototype.map=function(t,e){e=e||this;for(var r=new _,n=this.head;n!==null;)r.push(t.call(e,n.value,this)),n=n.next;return r};_.prototype.mapReverse=function(t,e){e=e||this;for(var r=new _,n=this.tail;n!==null;)r.push(t.call(e,n.value,this)),n=n.prev;return r};_.prototype.reduce=function(t,e){var r,n=this.head;if(arguments.length>1)r=e;else if(this.head)n=this.head.next,r=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var s=0;n!==null;s++)r=t(r,n.value,s),n=n.next;return r};_.prototype.reduceReverse=function(t,e){var r,n=this.tail;if(arguments.length>1)r=e;else if(this.tail)n=this.tail.prev,r=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var s=this.length-1;n!==null;s--)r=t(r,n.value,s),n=n.prev;return r};_.prototype.toArray=function(){for(var t=new Array(this.length),e=0,r=this.head;r!==null;e++)t[e]=r.value,r=r.next;return t};_.prototype.toArrayReverse=function(){for(var t=new Array(this.length),e=0,r=this.tail;r!==null;e++)t[e]=r.value,r=r.prev;return t};_.prototype.slice=function(t,e){e=e||this.length,e<0&&(e+=this.length),t=t||0,t<0&&(t+=this.length);var r=new _;if(e<t||e<0)return r;t<0&&(t=0),e>this.length&&(e=this.length);for(var n=0,s=this.head;s!==null&&n<t;n++)s=s.next;for(;s!==null&&n<e;n++,s=s.next)r.push(s.value);return r};_.prototype.sliceReverse=function(t,e){e=e||this.length,e<0&&(e+=this.length),t=t||0,t<0&&(t+=this.length);var r=new _;if(e<t||e<0)return r;t<0&&(t=0),e>this.length&&(e=this.length);for(var n=this.length,s=this.tail;s!==null&&n>e;n--)s=s.prev;for(;s!==null&&n>t;n--,s=s.prev)r.push(s.value);return r};_.prototype.splice=function(t,e,...r){t>this.length&&(t=this.length-1),t<0&&(t=this.length+t);for(var n=0,s=this.head;s!==null&&n<t;n++)s=s.next;for(var i=[],n=0;s&&n<e;n++)i.push(s.value),s=this.removeNode(s);s===null&&(s=this.tail),s!==this.head&&s!==this.tail&&(s=s.prev);for(var n=0;n<r.length;n++)s=Dl(this,s,r[n]);return i};_.prototype.reverse=function(){for(var t=this.head,e=this.tail,r=t;r!==null;r=r.prev){var n=r.prev;r.prev=r.next,r.next=n}return this.head=e,this.tail=t,this};function Dl(t,e,r){var n=e===t.head?new fe(r,null,e,t):new fe(r,e,e.next,t);return n.next===null&&(t.tail=n),n.prev===null&&(t.head=n),t.length++,n}function kl(t,e){t.tail=new fe(e,t.tail,null,t),t.head||(t.head=t.tail),t.length++}function Ml(t,e){t.head=new fe(e,null,t.head,t),t.tail||(t.tail=t.head),t.length++}function fe(t,e,r,n){if(!(this instanceof fe))return new fe(t,e,r,n);this.list=n,this.value=t,e?(e.next=this,this.prev=e):this.prev=null,r?(r.prev=this,this.next=r):this.next=null}try{Di()(_)}catch{}});var Wi=p(($h,Ui)=>{"use strict";var Pl=Mi(),de=Symbol("max"),ee=Symbol("length"),be=Symbol("lengthCalculator"),Ke=Symbol("allowStale"),he=Symbol("maxAge"),Z=Symbol("dispose"),Pi=Symbol("noDisposeOnSet"),x=Symbol("lruList"),K=Symbol("cache"),Bi=Symbol("updateAgeOnGet"),Tr=()=>1,Rr=class{constructor(e){if(typeof e=="number"&&(e={max:e}),e||(e={}),e.max&&(typeof e.max!="number"||e.max<0))throw new TypeError("max must be a non-negative number");let r=this[de]=e.max||1/0,n=e.length||Tr;if(this[be]=typeof n!="function"?Tr:n,this[Ke]=e.stale||!1,e.maxAge&&typeof e.maxAge!="number")throw new TypeError("maxAge must be a number");this[he]=e.maxAge||0,this[Z]=e.dispose,this[Pi]=e.noDisposeOnSet||!1,this[Bi]=e.updateAgeOnGet||!1,this.reset()}set max(e){if(typeof e!="number"||e<0)throw new TypeError("max must be a non-negative number");this[de]=e||1/0,Ve(this)}get max(){return this[de]}set allowStale(e){this[Ke]=!!e}get allowStale(){return this[Ke]}set maxAge(e){if(typeof e!="number")throw new TypeError("maxAge must be a non-negative number");this[he]=e,Ve(this)}get maxAge(){return this[he]}set lengthCalculator(e){typeof e!="function"&&(e=Tr),e!==this[be]&&(this[be]=e,this[ee]=0,this[x].forEach(r=>{r.length=this[be](r.value,r.key),this[ee]+=r.length})),Ve(this)}get lengthCalculator(){return this[be]}get length(){return this[ee]}get itemCount(){return this[x].length}rforEach(e,r){r=r||this;for(let n=this[x].tail;n!==null;){let s=n.prev;Fi(this,e,n,r),n=s}}forEach(e,r){r=r||this;for(let n=this[x].head;n!==null;){let s=n.next;Fi(this,e,n,r),n=s}}keys(){return this[x].toArray().map(e=>e.key)}values(){return this[x].toArray().map(e=>e.value)}reset(){this[Z]&&this[x]&&this[x].length&&this[x].forEach(e=>this[Z](e.key,e.value)),this[K]=new Map,this[x]=new Pl,this[ee]=0}dump(){return this[x].map(e=>kt(this,e)?!1:{k:e.key,v:e.value,e:e.now+(e.maxAge||0)}).toArray().filter(e=>e)}dumpLru(){return this[x]}set(e,r,n){if(n=n||this[he],n&&typeof n!="number")throw new TypeError("maxAge must be a number");let s=n?Date.now():0,i=this[be](r,e);if(this[K].has(e)){if(i>this[de])return Re(this,this[K].get(e)),!1;let u=this[K].get(e).value;return this[Z]&&(this[Pi]||this[Z](e,u.value)),u.now=s,u.maxAge=n,u.value=r,this[ee]+=i-u.length,u.length=i,this.get(e),Ve(this),!0}let o=new Ar(e,r,i,s,n);return o.length>this[de]?(this[Z]&&this[Z](e,r),!1):(this[ee]+=o.length,this[x].unshift(o),this[K].set(e,this[x].head),Ve(this),!0)}has(e){if(!this[K].has(e))return!1;let r=this[K].get(e).value;return!kt(this,r)}get(e){return br(this,e,!0)}peek(e){return br(this,e,!1)}pop(){let e=this[x].tail;return e?(Re(this,e),e.value):null}del(e){Re(this,this[K].get(e))}load(e){this.reset();let r=Date.now();for(let n=e.length-1;n>=0;n--){let s=e[n],i=s.e||0;if(i===0)this.set(s.k,s.v);else{let o=i-r;o>0&&this.set(s.k,s.v,o)}}}prune(){this[K].forEach((e,r)=>br(this,r,!1))}},br=(t,e,r)=>{let n=t[K].get(e);if(n){let s=n.value;if(kt(t,s)){if(Re(t,n),!t[Ke])return}else r&&(t[Bi]&&(n.value.now=Date.now()),t[x].unshiftNode(n));return s.value}},kt=(t,e)=>{if(!e||!e.maxAge&&!t[he])return!1;let r=Date.now()-e.now;return e.maxAge?r>e.maxAge:t[he]&&r>t[he]},Ve=t=>{if(t[ee]>t[de])for(let e=t[x].tail;t[ee]>t[de]&&e!==null;){let r=e.prev;Re(t,e),e=r}},Re=(t,e)=>{if(e){let r=e.value;t[Z]&&t[Z](r.key,r.value),t[ee]-=r.length,t[K].delete(r.key),t[x].removeNode(e)}},Ar=class{constructor(e,r,n,s,i){this.key=e,this.value=r,this.length=n,this.now=s,this.maxAge=i||0}},Fi=(t,e,r,n)=>{let s=r.value;kt(t,s)&&(Re(t,r),t[Ke]||(s=void 0)),s&&e.call(n,s.value,s.key,t)};Ui.exports=Rr});var X=p((Dh,ji)=>{var ge=class{constructor(e,r){if(r=Bl(r),e instanceof ge)return e.loose===!!r.loose&&e.includePrerelease===!!r.includePrerelease?e:new ge(e.raw,r);if(e instanceof qr)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease,this.raw=e,this.set=e.split("||").map(n=>this.parseRange(n.trim())).filter(n=>n.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${e}`);if(this.set.length>1){let n=this.set[0];if(this.set=this.set.filter(s=>!Xi(s[0])),this.set.length===0)this.set=[n];else if(this.set.length>1){for(let s of this.set)if(s.length===1&&Vl(s[0])){this.set=[s];break}}}this.format()}format(){return this.range=this.set.map(e=>e.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(e){e=e.trim();let n=((this.options.includePrerelease&&Hl)|(this.options.loose&&jl))+":"+e,s=Gi.get(n);if(s)return s;let i=this.options.loose,o=i?F[k.HYPHENRANGELOOSE]:F[k.HYPHENRANGE];e=e.replace(o,np(this.options.includePrerelease)),I("hyphen replace",e),e=e.replace(F[k.COMPARATORTRIM],Wl),I("comparator trim",e),e=e.replace(F[k.TILDETRIM],Gl),e=e.replace(F[k.CARETTRIM],Xl),e=e.split(/\s+/).join(" ");let a=e.split(" ").map(f=>Kl(f,this.options)).join(" ").split(/\s+/).map(f=>rp(f,this.options));i&&(a=a.filter(f=>(I("loose invalid filter",f,this.options),!!f.match(F[k.COMPARATORLOOSE])))),I("range list",a);let u=new Map,c=a.map(f=>new qr(f,this.options));for(let f of c){if(Xi(f))return[f];u.set(f.value,f)}u.size>1&&u.has("")&&u.delete("");let l=[...u.values()];return Gi.set(n,l),l}intersects(e,r){if(!(e instanceof ge))throw new TypeError("a Range is required");return this.set.some(n=>Hi(n,r)&&e.set.some(s=>Hi(s,r)&&n.every(i=>s.every(o=>i.intersects(o,r)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new Ul(e,this.options)}catch{return!1}for(let r=0;r<this.set.length;r++)if(sp(this.set[r],e,this.options))return!0;return!1}};ji.exports=ge;var Fl=Wi(),Gi=new Fl({max:1e3}),Bl=It(),qr=Qe(),I=He(),Ul=$(),{re:F,t:k,comparatorTrimReplace:Wl,tildeTrimReplace:Gl,caretTrimReplace:Xl}=ye(),{FLAG_INCLUDE_PRERELEASE:Hl,FLAG_LOOSE:jl}=Xe(),Xi=t=>t.value==="<0.0.0-0",Vl=t=>t.value==="",Hi=(t,e)=>{let r=!0,n=t.slice(),s=n.pop();for(;r&&n.length;)r=n.every(i=>s.intersects(i,e)),s=n.pop();return r},Kl=(t,e)=>(I("comp",t,e),t=zl(t,e),I("caret",t),t=Ql(t,e),I("tildes",t),t=Zl(t,e),I("xrange",t),t=tp(t,e),I("stars",t),t),M=t=>!t||t.toLowerCase()==="x"||t==="*",Ql=(t,e)=>t.trim().split(/\s+/).map(r=>Yl(r,e)).join(" "),Yl=(t,e)=>{let r=e.loose?F[k.TILDELOOSE]:F[k.TILDE];return t.replace(r,(n,s,i,o,a)=>{I("tilde",t,n,s,i,o,a);let u;return M(s)?u="":M(i)?u=`>=${s}.0.0 <${+s+1}.0.0-0`:M(o)?u=`>=${s}.${i}.0 <${s}.${+i+1}.0-0`:a?(I("replaceTilde pr",a),u=`>=${s}.${i}.${o}-${a} <${s}.${+i+1}.0-0`):u=`>=${s}.${i}.${o} <${s}.${+i+1}.0-0`,I("tilde return",u),u})},zl=(t,e)=>t.trim().split(/\s+/).map(r=>Jl(r,e)).join(" "),Jl=(t,e)=>{I("caret",t,e);let r=e.loose?F[k.CARETLOOSE]:F[k.CARET],n=e.includePrerelease?"-0":"";return t.replace(r,(s,i,o,a,u)=>{I("caret",t,s,i,o,a,u);let c;return M(i)?c="":M(o)?c=`>=${i}.0.0${n} <${+i+1}.0.0-0`:M(a)?i==="0"?c=`>=${i}.${o}.0${n} <${i}.${+o+1}.0-0`:c=`>=${i}.${o}.0${n} <${+i+1}.0.0-0`:u?(I("replaceCaret pr",u),i==="0"?o==="0"?c=`>=${i}.${o}.${a}-${u} <${i}.${o}.${+a+1}-0`:c=`>=${i}.${o}.${a}-${u} <${i}.${+o+1}.0-0`:c=`>=${i}.${o}.${a}-${u} <${+i+1}.0.0-0`):(I("no pr"),i==="0"?o==="0"?c=`>=${i}.${o}.${a}${n} <${i}.${o}.${+a+1}-0`:c=`>=${i}.${o}.${a}${n} <${i}.${+o+1}.0-0`:c=`>=${i}.${o}.${a} <${+i+1}.0.0-0`),I("caret return",c),c})},Zl=(t,e)=>(I("replaceXRanges",t,e),t.split(/\s+/).map(r=>ep(r,e)).join(" ")),ep=(t,e)=>{t=t.trim();let r=e.loose?F[k.XRANGELOOSE]:F[k.XRANGE];return t.replace(r,(n,s,i,o,a,u)=>{I("xRange",t,n,s,i,o,a,u);let c=M(i),l=c||M(o),f=l||M(a),m=f;return s==="="&&m&&(s=""),u=e.includePrerelease?"-0":"",c?s===">"||s==="<"?n="<0.0.0-0":n="*":s&&m?(l&&(o=0),a=0,s===">"?(s=">=",l?(i=+i+1,o=0,a=0):(o=+o+1,a=0)):s==="<="&&(s="<",l?i=+i+1:o=+o+1),s==="<"&&(u="-0"),n=`${s+i}.${o}.${a}${u}`):l?n=`>=${i}.0.0${u} <${+i+1}.0.0-0`:f&&(n=`>=${i}.${o}.0${u} <${i}.${+o+1}.0-0`),I("xRange return",n),n})},tp=(t,e)=>(I("replaceStars",t,e),t.trim().replace(F[k.STAR],"")),rp=(t,e)=>(I("replaceGTE0",t,e),t.trim().replace(F[e.includePrerelease?k.GTE0PRE:k.GTE0],"")),np=t=>(e,r,n,s,i,o,a,u,c,l,f,m,d)=>(M(n)?r="":M(s)?r=`>=${n}.0.0${t?"-0":""}`:M(i)?r=`>=${n}.${s}.0${t?"-0":""}`:o?r=`>=${r}`:r=`>=${r}${t?"-0":""}`,M(c)?u="":M(l)?u=`<${+c+1}.0.0-0`:M(f)?u=`<${c}.${+l+1}.0-0`:m?u=`<=${c}.${l}.${f}-${m}`:t?u=`<${c}.${l}.${+f+1}-0`:u=`<=${u}`,`${r} ${u}`.trim()),sp=(t,e,r)=>{for(let n=0;n<t.length;n++)if(!t[n].test(e))return!1;if(e.prerelease.length&&!r.includePrerelease){for(let n=0;n<t.length;n++)if(I(t[n].semver),t[n].semver!==qr.ANY&&t[n].semver.prerelease.length>0){let s=t[n].semver;if(s.major===e.major&&s.minor===e.minor&&s.patch===e.patch)return!0}return!1}return!0}});var Qe=p((kh,Ji)=>{var Ye=Symbol("SemVer ANY"),Ae=class{static get ANY(){return Ye}constructor(e,r){if(r=Vi(r),e instanceof Ae){if(e.loose===!!r.loose)return e;e=e.value}wr("comparator",e,r),this.options=r,this.loose=!!r.loose,this.parse(e),this.semver===Ye?this.value="":this.value=this.operator+this.semver.version,wr("comp",this)}parse(e){let r=this.options.loose?Ki[Qi.COMPARATORLOOSE]:Ki[Qi.COMPARATOR],n=e.match(r);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=n[1]!==void 0?n[1]:"",this.operator==="="&&(this.operator=""),n[2]?this.semver=new Yi(n[2],this.options.loose):this.semver=Ye}toString(){return this.value}test(e){if(wr("Comparator.test",e,this.options.loose),this.semver===Ye||e===Ye)return!0;if(typeof e=="string")try{e=new Yi(e,this.options)}catch{return!1}return Ir(e,this.operator,this.semver,this.options)}intersects(e,r){if(!(e instanceof Ae))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new zi(e.value,r).test(this.value):e.operator===""?e.value===""?!0:new zi(this.value,r).test(e.semver):(r=Vi(r),r.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!r.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||Ir(this.semver,"<",e.semver,r)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||Ir(this.semver,">",e.semver,r)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};Ji.exports=Ae;var Vi=It(),{re:Ki,t:Qi}=ye(),Ir=yr(),wr=He(),Yi=$(),zi=X()});var ze=p((Mh,Zi)=>{var ip=X(),op=(t,e,r)=>{try{e=new ip(e,r)}catch{return!1}return e.test(t)};Zi.exports=op});var to=p((Ph,eo)=>{var ap=X(),up=(t,e)=>new ap(t,e).set.map(r=>r.map(n=>n.value).join(" ").trim().split(" "));eo.exports=up});var no=p((Fh,ro)=>{var cp=$(),lp=X(),pp=(t,e,r)=>{let n=null,s=null,i=null;try{i=new lp(e,r)}catch{return null}return t.forEach(o=>{i.test(o)&&(!n||s.compare(o)===-1)&&(n=o,s=new cp(n,r))}),n};ro.exports=pp});var io=p((Bh,so)=>{var fp=$(),dp=X(),hp=(t,e,r)=>{let n=null,s=null,i=null;try{i=new dp(e,r)}catch{return null}return t.forEach(o=>{i.test(o)&&(!n||s.compare(o)===1)&&(n=o,s=new fp(n,r))}),n};so.exports=hp});var uo=p((Uh,ao)=>{var Cr=$(),gp=X(),oo=je(),mp=(t,e)=>{t=new gp(t,e);let r=new Cr("0.0.0");if(t.test(r)||(r=new Cr("0.0.0-0"),t.test(r)))return r;r=null;for(let n=0;n<t.set.length;++n){let s=t.set[n],i=null;s.forEach(o=>{let a=new Cr(o.semver.version);switch(o.operator){case">":a.prerelease.length===0?a.patch++:a.prerelease.push(0),a.raw=a.format();case"":case">=":(!i||oo(a,i))&&(i=a);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${o.operator}`)}}),i&&(!r||oo(r,i))&&(r=i)}return r&&t.test(r)?r:null};ao.exports=mp});var lo=p((Wh,co)=>{var vp=X(),_p=(t,e)=>{try{return new vp(t,e).range||"*"}catch{return null}};co.exports=_p});var Mt=p((Gh,go)=>{var Ep=$(),ho=Qe(),{ANY:Sp}=ho,yp=X(),Tp=ze(),po=je(),fo=xt(),bp=Ot(),Rp=Lt(),Ap=(t,e,r,n)=>{t=new Ep(t,n),e=new yp(e,n);let s,i,o,a,u;switch(r){case">":s=po,i=bp,o=fo,a=">",u=">=";break;case"<":s=fo,i=Rp,o=po,a="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Tp(t,e,n))return!1;for(let c=0;c<e.set.length;++c){let l=e.set[c],f=null,m=null;if(l.forEach(d=>{d.semver===Sp&&(d=new ho(">=0.0.0")),f=f||d,m=m||d,s(d.semver,f.semver,n)?f=d:o(d.semver,m.semver,n)&&(m=d)}),f.operator===a||f.operator===u||(!m.operator||m.operator===a)&&i(t,m.semver))return!1;if(m.operator===u&&o(t,m.semver))return!1}return!0};go.exports=Ap});var vo=p((Xh,mo)=>{var qp=Mt(),Ip=(t,e,r)=>qp(t,e,">",r);mo.exports=Ip});var Eo=p((Hh,_o)=>{var wp=Mt(),Cp=(t,e,r)=>wp(t,e,"<",r);_o.exports=Cp});var To=p((jh,yo)=>{var So=X(),Np=(t,e,r)=>(t=new So(t,r),e=new So(e,r),t.intersects(e,r));yo.exports=Np});var Ro=p((Vh,bo)=>{var xp=ze(),Lp=G();bo.exports=(t,e,r)=>{let n=[],s=null,i=null,o=t.sort((l,f)=>Lp(l,f,r));for(let l of o)xp(l,e,r)?(i=l,s||(s=l)):(i&&n.push([s,i]),i=null,s=null);s&&n.push([s,null]);let a=[];for(let[l,f]of n)l===f?a.push(l):!f&&l===o[0]?a.push("*"):f?l===o[0]?a.push(`<=${f}`):a.push(`${l} - ${f}`):a.push(`>=${l}`);let u=a.join(" || "),c=typeof e.raw=="string"?e.raw:String(e);return u.length<c.length?u:e}});var No=p((Kh,Co)=>{var Ao=X(),xr=Qe(),{ANY:Nr}=xr,Je=ze(),Lr=G(),Op=(t,e,r={})=>{if(t===e)return!0;t=new Ao(t,r),e=new Ao(e,r);let n=!1;e:for(let s of t.set){for(let i of e.set){let o=Dp(s,i,r);if(n=n||o!==null,o)continue e}if(n)return!1}return!0},$p=[new xr(">=0.0.0-0")],qo=[new xr(">=0.0.0")],Dp=(t,e,r)=>{if(t===e)return!0;if(t.length===1&&t[0].semver===Nr){if(e.length===1&&e[0].semver===Nr)return!0;r.includePrerelease?t=$p:t=qo}if(e.length===1&&e[0].semver===Nr){if(r.includePrerelease)return!0;e=qo}let n=new Set,s,i;for(let d of t)d.operator===">"||d.operator===">="?s=Io(s,d,r):d.operator==="<"||d.operator==="<="?i=wo(i,d,r):n.add(d.semver);if(n.size>1)return null;let o;if(s&&i){if(o=Lr(s.semver,i.semver,r),o>0)return null;if(o===0&&(s.operator!==">="||i.operator!=="<="))return null}for(let d of n){if(s&&!Je(d,String(s),r)||i&&!Je(d,String(i),r))return null;for(let P of e)if(!Je(d,String(P),r))return!1;return!0}let a,u,c,l,f=i&&!r.includePrerelease&&i.semver.prerelease.length?i.semver:!1,m=s&&!r.includePrerelease&&s.semver.prerelease.length?s.semver:!1;f&&f.prerelease.length===1&&i.operator==="<"&&f.prerelease[0]===0&&(f=!1);for(let d of e){if(l=l||d.operator===">"||d.operator===">=",c=c||d.operator==="<"||d.operator==="<=",s){if(m&&d.semver.prerelease&&d.semver.prerelease.length&&d.semver.major===m.major&&d.semver.minor===m.minor&&d.semver.patch===m.patch&&(m=!1),d.operator===">"||d.operator===">="){if(a=Io(s,d,r),a===d&&a!==s)return!1}else if(s.operator===">="&&!Je(s.semver,String(d),r))return!1}if(i){if(f&&d.semver.prerelease&&d.semver.prerelease.length&&d.semver.major===f.major&&d.semver.minor===f.minor&&d.semver.patch===f.patch&&(f=!1),d.operator==="<"||d.operator==="<="){if(u=wo(i,d,r),u===d&&u!==i)return!1}else if(i.operator==="<="&&!Je(i.semver,String(d),r))return!1}if(!d.operator&&(i||s)&&o!==0)return!1}return!(s&&c&&!i&&o!==0||i&&l&&!s&&o!==0||m||f)},Io=(t,e,r)=>{if(!t)return e;let n=Lr(t.semver,e.semver,r);return n>0?t:n<0||e.operator===">"&&t.operator===">="?e:t},wo=(t,e,r)=>{if(!t)return e;let n=Lr(t.semver,e.semver,r);return n<0?t:n>0||e.operator==="<"&&t.operator==="<="?e:t};Co.exports=Op});var $o=p((Qh,Oo)=>{var Or=ye(),xo=Xe(),kp=$(),Lo=_r(),Mp=pe(),Pp=Ys(),Fp=Js(),Bp=ti(),Up=si(),Wp=oi(),Gp=ui(),Xp=li(),Hp=fi(),jp=G(),Vp=mi(),Kp=_i(),Qp=Nt(),Yp=Ti(),zp=Ri(),Jp=je(),Zp=xt(),ef=Er(),tf=Sr(),rf=Lt(),nf=Ot(),sf=yr(),of=Oi(),af=Qe(),uf=X(),cf=ze(),lf=to(),pf=no(),ff=io(),df=uo(),hf=lo(),gf=Mt(),mf=vo(),vf=Eo(),_f=To(),Ef=Ro(),Sf=No();Oo.exports={parse:Mp,valid:Pp,clean:Fp,inc:Bp,diff:Up,major:Wp,minor:Gp,patch:Xp,prerelease:Hp,compare:jp,rcompare:Vp,compareLoose:Kp,compareBuild:Qp,sort:Yp,rsort:zp,gt:Jp,lt:Zp,eq:ef,neq:tf,gte:rf,lte:nf,cmp:sf,coerce:of,Comparator:af,Range:uf,satisfies:cf,toComparators:lf,maxSatisfying:pf,minSatisfying:ff,minVersion:df,validRange:hf,outside:gf,gtr:mf,ltr:vf,intersects:_f,simplifyRange:Ef,subset:Sf,SemVer:kp,re:Or.re,src:Or.src,tokens:Or.t,SEMVER_SPEC_VERSION:xo.SEMVER_SPEC_VERSION,RELEASE_TYPES:xo.RELEASE_TYPES,compareIdentifiers:Lo.compareIdentifiers,rcompareIdentifiers:Lo.rcompareIdentifiers}});var Dr=p((Yh,$r)=>{"use strict";var yf=$o(),Tf=We(),qe=oe(),Do=L(),ko=A(),Mo="2.7.15",bf=function(){return!1},Rf=function(e){if(!yf.gte(e.VERSION,Mo))throw new Error("AWS SDK version "+Mo+" or greater required.");for(var r in e)if(e[r].serviceIdentifier){var n=e[r];n.prototype.customizeRequests(Po)}return e},Af=function(e){return e.customizeRequests(Po),e};function Po(t){var e=qe.resolveSegment(qe.resolveManualSegmentParams(t.params));if(!e){var r=this.serviceIdentifier+"."+t.operation;return qe.isAutomaticMode()?ko.getLogger().info("Call "+r+" is missing the sub/segment context for automatic mode. Ignoring."):ko.getLogger().info("Call "+r+' requires a segment object on the request params as "XRaySegment" for tracing in manual mode. Ignoring.'),t}var n=this.throttledError||bf,s=new Error().stack;let i;e.notTraced?i=e.addNewSubsegmentWithoutSampling(this.serviceIdentifier):i=e.addNewSubsegment(this.serviceIdentifier);var o=e.segment?e.segment.trace_id:e.trace_id;let a=e.segment?e.segment.additionalTraceData:e.additionalTraceData;var u=function(l){let f="Root="+o+";Parent="+i.id+";Sampled="+(i.notTraced?"0":"1");if(a!=null)for(let[m,d]of Object.entries(a))f+=";"+m+"="+d;l.httpRequest.headers["X-Amzn-Trace-Id"]=f},c=function(l){i.addAttribute("namespace","aws"),i.addAttribute("aws",new Tf(l,i.name));var f=l.httpResponse;if(f&&(i.addAttribute("http",new Fo(f)),(f.statusCode===429||l.error&&n(l.error))&&i.addThrottleFlag()),l.error){var m={message:l.error.message,name:l.error.code,stack:s};f&&f.statusCode?(Do.getCauseTypeFromHttpStatus(f.statusCode)=="error"&&i.addErrorFlag(),i.close(m,!0)):i.close(m)}else{if(f&&f.statusCode){var d=Do.getCauseTypeFromHttpStatus(f.statusCode);d&&(i[d]=!0)}i.close()}};t.on("beforePresign",function(l){e.removeSubsegment(i),e.decrementCounter(),l.removeListener("build",u),l.removeListener("complete",c)}),t.on("build",u).on("complete",c),t.__send||(t.__send=t.send,t.send=function(l){if(qe.isAutomaticMode()){var f=qe.getNamespace();f.run(function(){qe.setSegment(i),t.__send(l)})}else t.__send(l)})}function Fo(t){this.init(t)}Fo.prototype.init=function(e){this.response={status:e.statusCode||""},e.headers&&e.headers["content-length"]&&(this.response.content_length=e.headers["content-length"])};$r.exports.captureAWSClient=Af;$r.exports.captureAWS=Rf});var Bo=p(H=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0});H.NODEJS_TIMEOUT_ERROR_CODES=H.TRANSIENT_ERROR_STATUS_CODES=H.TRANSIENT_ERROR_CODES=H.THROTTLING_ERROR_CODES=H.CLOCK_SKEW_ERROR_CODES=void 0;H.CLOCK_SKEW_ERROR_CODES=["AuthFailure","InvalidSignatureException","RequestExpired","RequestInTheFuture","RequestTimeTooSkewed","SignatureDoesNotMatch"];H.THROTTLING_ERROR_CODES=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException","TransactionInProgressException"];H.TRANSIENT_ERROR_CODES=["AbortError","TimeoutError","RequestTimeout","RequestTimeoutException"];H.TRANSIENT_ERROR_STATUS_CODES=[500,502,503,504];H.NODEJS_TIMEOUT_ERROR_CODES=["ECONNRESET","ECONNREFUSED","EPIPE","ETIMEDOUT"]});var Uo=p(U=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0});U.isServerError=U.isTransientError=U.isThrottlingError=U.isClockSkewError=U.isRetryableByTrait=void 0;var Ze=Bo(),qf=t=>t.$retryable!==void 0;U.isRetryableByTrait=qf;var If=t=>Ze.CLOCK_SKEW_ERROR_CODES.includes(t.name);U.isClockSkewError=If;var wf=t=>{var e,r;return((e=t.$metadata)===null||e===void 0?void 0:e.httpStatusCode)===429||Ze.THROTTLING_ERROR_CODES.includes(t.name)||((r=t.$retryable)===null||r===void 0?void 0:r.throttling)==!0};U.isThrottlingError=wf;var Cf=t=>{var e;return Ze.TRANSIENT_ERROR_CODES.includes(t.name)||Ze.NODEJS_TIMEOUT_ERROR_CODES.includes((t==null?void 0:t.code)||"")||Ze.TRANSIENT_ERROR_STATUS_CODES.includes(((e=t.$metadata)===null||e===void 0?void 0:e.httpStatusCode)||0)};U.isTransientError=Cf;var Nf=t=>{var e;if(((e=t.$metadata)===null||e===void 0?void 0:e.httpStatusCode)!==void 0){let r=t.$metadata.httpStatusCode;return 500<=r&&r<=599&&!(0,U.isTransientError)(t)}return!1};U.isServerError=Nf});var Vo=p(Ie=>{"use strict";var Ho=Ie&&Ie.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Ie,"__esModule",{value:!0});Ie.captureAWSClient=void 0;var xf=Uo(),Lf=Ho(We()),Of=require("querystring"),$f=Ho(Pe()),kr=oe(),Wo=A(),{safeParseInt:Pt}=L(),Df=L(),jo="XRaySDKInstrumentation",Go=async(t,e,r,n,s)=>{var i,o,a;let{extendedRequestId:u,requestId:c,httpStatusCode:l,attempts:f}=((i=n==null?void 0:n.output)===null||i===void 0?void 0:i.$metadata)||(s==null?void 0:s.$metadata),m=new Lf.default({extendedRequestId:u,requestId:c,retryCount:f,request:{operation:e,httpRequest:{region:r,statusCode:l}}},t),d={};return l&&(d.response={},d.response.status=l),!((o=n==null?void 0:n.response)===null||o===void 0)&&o.headers&&((a=n==null?void 0:n.response)===null||a===void 0?void 0:a.headers["content-length"])!==void 0&&(d.response||(d.response={}),d.response.content_length=Pt(n.response.headers["content-length"])),[m,d]};function Xo(t,e,r){var n,s,i;(r&&(0,xf.isThrottlingError)(r)||Pt((n=t.response)===null||n===void 0?void 0:n.status)===429||Pt((s=r==null?void 0:r.$metadata)===null||s===void 0?void 0:s.httpStatusCode)===429)&&e.addThrottleFlag();let o=(0,Df.getCauseTypeFromHttpStatus)(Pt((i=t.response)===null||i===void 0?void 0:i.status));o==="fault"?e.addFaultFlag():o==="error"&&e.addErrorFlag()}var kf=(t,e)=>(r,n)=>async s=>{let i=kr.isAutomaticMode()?kr.resolveSegment():e,{clientName:o,commandName:a}=n,u=a.slice(0,-7),c=o.slice(0,-6);if(!i){let d=c+"."+u.charAt(0).toLowerCase()+u.slice(1);return kr.isAutomaticMode()?Wo.getLogger().info("Call "+d+" is missing the sub/segment context for automatic mode. Ignoring."):Wo.getLogger().info("Call "+d+" requires a segment object passed to captureAWSv3Client for tracing in manual mode. Ignoring."),r(s)}let l;i.notTraced?l=i.addNewSubsegmentWithoutSampling(c):l=i.addNewSubsegment(c),l.addAttribute("namespace","aws");let f=i instanceof $f.default?i.segment:i;s.request.headers["X-Amzn-Trace-Id"]=(0,Of.stringify)({Root:f.trace_id,Parent:l.id,Sampled:l.notTraced?"0":"1"},";");let m;try{if(m=await r(s),!m)throw new Error("Failed to get response from instrumented AWS Client.");let[d,P]=await Go(c,u,await t.region(),m,null);return l.addAttribute("aws",d),l.addAttribute("http",P),Xo(P,l),l.close(),m}catch(d){if(d.$metadata){let[w,it]=await Go(c,u,await t.region(),null,d);l.addAttribute("aws",w),l.addAttribute("http",it),Xo(it,l,d)}let P={message:d.message,name:d.name,stack:d.stack||new Error().stack};throw l.close(P,!0),d}},Mf={name:jo,step:"build"},Pf=(t,e)=>({applyToStack:r=>{r.add(kf(t,e),Mf)}});function Ff(t,e){return t.middlewareStack.remove(jo),t.middlewareStack.use(Pf(t.config,e)),t}Ie.captureAWSClient=Ff});var Pr=p((eg,Mr)=>{"use strict";var Ko=require("url"),we=oe(),Ft=L(),Qo=A(),Bf=require("events"),Uf=function(e,r,n){e.__request||Yo(e,r,n)},Wf=function(e,r,n){if(e.__request)return e;var s={};return Object.keys(e).forEach(function(i){s[i]=e[i]}),Yo(s,r,n),s};function Yo(t,e,r){function n(o,...a){let u,c,l,f,m=a[0];if(typeof a[1]=="object"?(l=!0,f=typeof m=="string"?new Ko.URL(m):m,u=a[1],c=a[2]):(l=!1,u=m,c=a[1]),!u||u.headers&&u.headers["X-Amzn-Trace-Id"])return o(...a);typeof u=="string"&&(u=new Ko.URL(u)),l||(f=u);let d=we.resolveSegment(we.resolveManualSegmentParams(u)),P=u.hostname||u.host||f.hostname||f.host||"Unknown host";if(!d){let C="[ host: "+P;return C=u.method?C+", method: "+u.method:C,C+=", path: "+(f.pathname||Ft.stripQueryStringFromPath(u.path))+" ]",we.isAutomaticMode()?Qo.getLogger().info("Options for request "+C+" is missing the sub/segment context for automatic mode. Ignoring."):Qo.getLogger().info("Options for request "+C+' requires a segment object on the options params as "XRaySegment" for tracing in manual mode. Ignoring.'),o(...a)}let w;d.notTraced?w=d.addNewSubsegmentWithoutSampling(P):w=d.addNewSubsegment(P);let it=d.segment?d.segment:d;w.namespace="remote",u.headers||(u.headers={}),u.headers["X-Amzn-Trace-Id"]="Root="+it.trace_id+";Parent="+w.id+";Sampled="+(w.notTraced?"0":"1");let wa=function(te){if(r&&r(w,this,null,te),w.http&&w.http.response)Ft.getCauseTypeFromHttpStatus(w.http.response.status)==="error"&&w.addErrorFlag(),w.close(te,!0);else{let Na=te.code!=="ECONNREFUSED";w.addRemoteRequestData(this,null,Na&&e),w.close(te)}},Ca=Ft.objectWithoutProperties(u,["Segment"],!0),Ur=o(...l?[m,Ca]:[u],function(C){C.on("end",function(){r&&r(w,this.req,C),C.statusCode===429&&w.addThrottleFlag();let te=Ft.getCauseTypeFromHttpStatus(C.statusCode);te&&(w[te]=!0),w.addRemoteRequestData(C.req,C,!!e),w.close()}),typeof c=="function"?we.isAutomaticMode()?we.getNamespace().run(function(){we.setSegment(w),c(C)}):c(C):C.req&&C.req.listenerCount("response")===0&&C.resume()});return Ur.on(Bf.errorMonitor||"error",wa),Ur}t.__request=t.request;function s(...o){return n(t.__request,...o)}t.__get=t.get;function i(...o){return n(t.__get,...o)}Object.defineProperties(t,{request:{value:s,configurable:!0,enumerable:!0,writable:!0},get:{value:i,configurable:!0,enumerable:!0,writable:!0}})}Mr.exports.captureHTTPsGlobal=Uf;Mr.exports.captureHTTPs=Wf});var ea=p((tg,Fr)=>{"use strict";var et=oe(),Bt=Symbol("original then"),Ut=Symbol("original catch");function Jo(t){let e=t.prototype.then;e[Bt]||(t.prototype.then=function(n,s){if(et.isAutomaticMode()&&zo()){let i=et.getNamespace();n=n&&i.bind(n),s=s&&i.bind(s)}return e.call(this,n,s)},t.prototype.then[Bt]=e);let r=t.prototype.catch;r&&!r[Ut]&&(t.prototype.catch=function(n){if(et.isAutomaticMode()&&zo()){let s=et.getNamespace();n=n&&s.bind(n)}return r.call(this,n)},t.prototype.catch[Ut]=r)}function Gf(t){let e=t.prototype.then;e[Bt]&&(t.prototype.then=e[Bt]);let r=t.prototype.catch;r&&r[Ut]&&(t.prototype.catch=r[Ut])}function zo(){try{return et.getSegment()}catch{return}}function Zo(){Jo(Promise)}function Xf(){Gf(Promise)}Zo.patchThirdPartyPromise=Jo;Fr.exports.capturePromise=Zo;Fr.exports.uncapturePromise=Xf});var na=p((rg,ra)=>{"use strict";function ta(t,e,r,n,s){this.init(t,e,r,n,s)}ta.prototype.init=function(e,r,n,s,i){e&&(this.database_version=e),r&&(this.driver_version=r),i&&(this.preparation=i),this.url=s,this.user=n};ra.exports=ta});var oa=p((ng,ia)=>{"use strict";var ue=oe(),Br=A(),Ce=re(),Hf=L(),jf=fs(),rt={};try{rt=ds()}catch(t){Br.getLogger().debug("Failed to load SDK data:",t)}var tt="unknown",sa={plugins:{EC2Plugin:ys(),ECSPlugin:bs(),ElasticBeanstalkPlugin:As()},config:function(t){var e={};t.forEach(function(r){r.getData(function(n){if(n)for(var s in n)e[s]=n[s]}),Ce.setOrigin(r.originName),Ce.setPluginData(e)})},setAWSWhitelist:We().setAWSWhitelist,appendAWSWhitelist:We().appendAWSWhitelist,setStreamingThreshold:Ce.setStreamingThreshold,setLogger:Br.setLogger,getLogger:Br.getLogger,setDaemonAddress:lt().setDaemonAddress,captureFunc:qt().captureFunc,captureAsyncFunc:qt().captureAsyncFunc,captureCallbackFunc:qt().captureCallbackFunc,captureAWS:Dr().captureAWS,captureAWSClient:Dr().captureAWSClient,captureAWSv3Client:Vo().captureAWSClient,captureHTTPs:Pr().captureHTTPs,captureHTTPsGlobal:Pr().captureHTTPsGlobal,capturePromise:ea().capturePromise,utils:Hf,database:{SqlData:na()},middleware:ur(),getNamespace:ue.getNamespace,resolveSegment:ue.resolveSegment,getSegment:ue.getSegment,setSegment:ue.setSegment,isAutomaticMode:ue.isAutomaticMode,enableAutomaticMode:ue.enableAutomaticMode,enableManualMode:ue.enableManualMode,setContextMissingStrategy:ue.setContextMissingStrategy,Segment:Fe(),Subsegment:Pe(),SegmentUtils:Ce};sa.middleware.IncomingRequestData=zt(),function(){var t={runtime:process.release&&process.release.name?process.release.name:tt,runtime_version:process.version,version:process.env.npm_package_version||tt,name:process.env.npm_package_name||tt},e={sdk:"X-Ray for Node.js",sdk_version:rt.version?rt.version:tt,package:rt.name?rt.name:tt};Ce.setSDKData(e),Ce.setServiceData(t),process.env.LAMBDA_TASK_ROOT&&jf.init()}();ia.exports=sa});var nt=p((sg,aa)=>{"use strict";aa.exports=oa()});var la=p((ig,ca)=>{var Ne=nt(),ua=Ne.middleware,Vf={openSegment:t=>{if(!t||typeof t!="string")throw new Error("Default segment name was not supplied.  Please provide a string.");return ua.setDefaultName(t),(e,r,n)=>{let s=ua.traceRequestResponseCycle(e,r);if(Ne.isAutomaticMode()){let i=Ne.getNamespace();i.bindEmitter(e),i.bindEmitter(r),i.run(()=>{Ne.setSegment(s),n&&n()})}else e.segment=s,n&&n()}},closeSegment:()=>(t,e,r,n)=>{let s=Ne.resolveSegment(e.segment);s&&t&&(s.addError(t),Ne.getLogger().debug("Added Express server fault to segment")),n&&n(t)}};ca.exports=Vf});var fa=p((og,pa)=>{pa.exports=la()});var ga=p((ag,ha)=>{var xe=nt(),Kf=require("events"),Qf=xe.database.SqlData,Yf=process.env.MYSQL_DATABASE_VERSION,zf=process.env.MYSQL_DRIVER_VERSION,Jf="statement";ha.exports=function(e){return e.__createConnection||(Zf(e),ed(e),td(e)),e};function Wt(t){return t!=null&&t.then instanceof Function?(t.constructor!=null?t.constructor.name:void 0)!=="Query":!1}function Zf(t){var e="__createConnection";t[e]=t.createConnection,t.createConnection=function(){var n=t[e].apply(n,arguments);return Wt(n)?n=n.then(s=>(ce(s.connection),s)):n.query instanceof Function&&ce(n),n}}function ed(t){var e="__createPool";t[e]=t.createPool,t.createPool=function(){var n=t[e].apply(n,arguments);return Wt(n)?n=n.then(s=>(ce(s.pool),s)):n.query instanceof Function&&ce(n),n}}function td(t){var e="__createPoolCluster";t[e]=t.createPoolCluster,t.createPoolCluster=function(){var n=t[e].apply(n,arguments);return n.query instanceof Function&&ce(n),n}}function rd(t){var e="__of";t[e]=t.of,t.of=function(){var n=arguments,s=t[e].apply(t,n);return ce(s)}}function nd(t){var e="__getConnection";t[e]=t.getConnection,t.getConnection=function(){var n=arguments,s=n[n.length-1];s instanceof Function&&(n[n.length-1]=(o,a)=>(a&&ce(a),s(o,a)));var i=t[e].apply(t,n);return Wt(i)?i.then(ce):i}}function ce(t){return t.query instanceof Function&&!t.__query&&(t.__query=t.query,t.query=da("query")),t.execute instanceof Function&&!t.__execute&&(t.__execute=t.execute,t.execute=da("execute")),t.getConnection instanceof Function&&!t.__getConnection&&nd(t),t.of instanceof Function&&!t.__of&&rd(t),t}function sd(t){var e={};return t&&t.length>0&&(t[0]instanceof Object?(e.sql=t[0],t[0].values?e.values=t[0].values:typeof t[2]=="function"&&(e.values=typeof t[1]!="function"?t[1]:null),e.callback=typeof t[1]=="function"?t[1]:typeof t[2]=="function"?t[2]:void 0,!t[1]&&t[0].on instanceof Function&&(e.sql=t[0])):(e.sql=t[0],e.values=typeof t[1]!="function"?t[1]:null,e.callback=typeof t[1]=="function"?t[1]:typeof t[2]=="function"?t[2]:void 0),e.segment=t[t.length-1]!=null&&t[t.length-1].constructor&&(t[t.length-1].constructor.name==="Segment"||t[t.length-1].constructor.name==="Subsegment")?t[t.length-1]:null),e}function da(t){return function(){var e=sd(arguments),r=xe.resolveSegment(e.segment),n,s=this["__"+t];if(e.segment&&delete arguments[arguments.length-1],!r)return xe.getLogger().info("Failed to capture MySQL. Cannot resolve sub/segment."),s.apply(this,arguments);var i=this.config.connectionConfig||this.config,o=r.addNewSubsegment(i.database+"@"+i.host);if(e.callback){var a=e.callback;xe.isAutomaticMode()?e.callback=function(l,f){var m=xe.getNamespace();m.run(function(){xe.setSegment(o),a(l,f)}),o.close(l)}:e.callback=function(l,f){a(l,f),o.close(l)}}if(n=s.call(this,e.sql,e.values,e.callback),!e.callback){var u=function(c){o.close(c)};Wt(n)?n.then(()=>{o.close()}).catch(u):(n.on("end",function(){o.close()}),n.on(Kf.errorMonitor||"error",u))}return o.addSqlData(id(i,e.values,e.sql)),o.namespace="remote",n}}function id(t,e,r){var n=e?Jf:null,s=new Qf(Yf,zf,t.user,t.host+":"+t.port+"/"+t.database,n);return process.env.AWS_XRAY_COLLECT_SQL_QUERIES&&r&&(s.sanitized_query=r),s}});var va=p((ug,ma)=>{ma.exports=ga()});var Ea=p((cg,_a)=>{var Le=nt(),od=require("events"),ad=Le.database.SqlData,ud=process.env.POSTGRES_DATABASE_VERSION,cd=process.env.POSTGRES_DRIVER_VERSION,ld="statement";_a.exports=function(e){return e.Client.prototype.__query||(e.Client.prototype.__query=e.Client.prototype.query,e.Client.prototype.query=fd),e};function pd(t,e,r){var n=typeof t=="string"?{text:t}:t;return e&&(typeof e=="function"?n.callback=e:n.values=e),r&&(n.callback=r),n}function fd(){var t=arguments[arguments.length-1],e=Le.resolveSegment(t!=null&&t.constructor&&(t.constructor.name==="Segment"||t.constructor.name==="Subsegment")?t:null);if(!e)return Le.getLogger().info("Failed to capture Postgres. Cannot resolve sub/segment."),this.__query.apply(this,arguments);var r=pd.apply(this,arguments)||{},n=e.addNewSubsegment(this.database+"@"+this.host);if(n.namespace="remote",r.callback){var s=r.callback;Le.isAutomaticMode()?r.callback=function(c,l){var f=Le.getNamespace();f.run(function(){Le.setSegment(n),s(c,l)}),n.close(c)}:r.callback=function(u,c){s(u,c,n),n.close(u)}}var i=this.__query.call(this,r);if(this._queryable&&!this._ending){var o;if(this.queryQueue.length===0?o=this.activeQuery:o=this.queryQueue[this.queryQueue.length-1],!r.callback&&o.on instanceof Function){o.on("end",function(){n.close()});var a=function(u){n.close(u)};o.on(od.errorMonitor||"error",a)}n.addSqlData(dd(this.connectionParameters,o))}return i}function dd(t,e){var r=e.name?ld:void 0,n=new ad(ud,cd,t.user,t.host+":"+t.port+"/"+t.database,r);return process.env.AWS_XRAY_COLLECT_SQL_QUERIES&&(n.sanitized_query=e.text),n}});var ya=p((lg,Sa)=>{Sa.exports=Ea()});var Ta=p((pg,hd)=>{hd.exports={name:"aws-xray-sdk",version:"3.5.0",description:"AWS X-Ray SDK for Javascript",author:"Amazon Web Services",contributors:["Sandra McMullen <mcmuls@amazon.com>","William Armiros <armiros@amazon.com>"],main:"lib/index.js",types:"lib/index.d.ts",engines:{node:">= 14.x"},dependencies:{"aws-xray-sdk-core":"3.5.0","aws-xray-sdk-express":"3.5.0","aws-xray-sdk-mysql":"3.5.0","aws-xray-sdk-postgres":"3.5.0"},scripts:{test:"tsd","test-d":"tsd",lint:"eslint .","lint:fix":"eslint . --fix"},keywords:["amazon","api","aws","xray","x-ray","x ray"],license:"Apache-2.0",repository:"https://github.com/aws/aws-xray-sdk-node/tree/master/packages/full_sdk",gitHead:"0579d9c75e08f8747f9eb87596bea58a7d7e9e25"}});var Aa=p((fg,Ra)=>{var me=nt();me.express=fa();me.captureMySQL=va();me.capturePostgres=ya();var st={};try{st=Ta()}catch(t){me.getLogger().debug("Failed to load SDK data:",t)}var ba="unknown";(function(){var t=me.SegmentUtils.sdkData||{sdk:"X-Ray for Node.js"};t.sdk_version=st.version?st.version:ba,t.package=st.name?st.name:ba,me.SegmentUtils.setSDKData(t)})();Ra.exports=me});var Ed={};ka(Ed,{handler:()=>vd});module.exports=Pa(Ed);var qa=require("aws-sdk"),Ia=Ma(Aa());Ia.captureAWS(require("aws-sdk"));var gd=process.env.EVENTS_DDB,md=new qa.DynamoDB.DocumentClient;async function vd(t,e,r){console.log("event",t),console.log(`Lambda RequestId: ${e.awsRequestId}`),await _d(t),r(null,JSON.stringify({productEventCreated:!0,message:"OK"}))}async function _d(t){let e=Date.now(),r=~~(e/1e3+5*60);await md.put({TableName:gd,Item:{pk:`#product_${t.productCode}`,sk:`${t.eventType}#${e}`,email:t.email,createdAt:e,requestId:t.requestId,eventType:t.eventType,info:{productId:t.productId,price:t.productPrice},ttl:r}}).promise()}0&&(module.exports={handler});
