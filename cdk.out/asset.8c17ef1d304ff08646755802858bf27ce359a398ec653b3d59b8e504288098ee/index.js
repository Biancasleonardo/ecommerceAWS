"use strict";var re=Object.create;var g=Object.defineProperty;var te=Object.getOwnPropertyDescriptor;var ue=Object.getOwnPropertyNames;var ae=Object.getPrototypeOf,de=Object.prototype.hasOwnProperty;var s=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),oe=(e,t)=>{for(var r in t)g(e,r,{get:t[r],enumerable:!0})},L=(e,t,r,u)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of ue(t))!de.call(e,a)&&a!==r&&g(e,a,{get:()=>t[a],enumerable:!(u=te(t,a))||u.enumerable});return e};var ne=(e,t,r)=>(r=e!=null?re(ae(e)):{},L(t||!e||!e.__esModule?g(r,"default",{value:e,enumerable:!0}):r,e)),ie=e=>L(g({},"__esModule",{value:!0}),e);var E=s(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});M.default=fe;var se=ce(require("crypto"));function ce(e){return e&&e.__esModule?e:{default:e}}function fe(){return se.default.randomBytes(16)}});var h=s(x=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0});x.default=void 0;var k=[];for(p=0;p<256;++p)k[p]=(p+256).toString(16).substr(1);var p;function le(e,t){var r=t||0,u=k;return[u[e[r++]],u[e[r++]],u[e[r++]],u[e[r++]],"-",u[e[r++]],u[e[r++]],"-",u[e[r++]],u[e[r++]],"-",u[e[r++]],u[e[r++]],"-",u[e[r++]],u[e[r++]],u[e[r++]],u[e[r++]],u[e[r++]],u[e[r++]]].join("")}var ve=le;x.default=ve});var $=s(D=>{"use strict";Object.defineProperty(D,"__esModule",{value:!0});D.default=void 0;var pe=G(E()),_e=G(h());function G(e){return e&&e.__esModule?e:{default:e}}var J,I,N=0,U=0;function me(e,t,r){var u=t&&r||0,a=t||[];e=e||{};var d=e.node||J,o=e.clockseq!==void 0?e.clockseq:I;if(d==null||o==null){var n=e.random||(e.rng||pe.default)();d==null&&(d=J=[n[0]|1,n[1],n[2],n[3],n[4],n[5]]),o==null&&(o=I=(n[6]<<8|n[7])&16383)}var c=e.msecs!==void 0?e.msecs:new Date().getTime(),i=e.nsecs!==void 0?e.nsecs:U+1,f=c-N+(i-U)/1e4;if(f<0&&e.clockseq===void 0&&(o=o+1&16383),(f<0||c>N)&&e.nsecs===void 0&&(i=0),i>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");N=c,U=i,I=o,c+=122192928e5;var m=((c&268435455)*1e4+i)%4294967296;a[u++]=m>>>24&255,a[u++]=m>>>16&255,a[u++]=m>>>8&255,a[u++]=m&255;var y=c/4294967296*1e4&268435455;a[u++]=y>>>8&255,a[u++]=y&255,a[u++]=y>>>24&15|16,a[u++]=y>>>16&255,a[u++]=o>>>8|128,a[u++]=o&255;for(var P=0;P<6;++P)a[u+P]=d[P];return t||(0,_e.default)(a)}var ye=me;D.default=ye});var b=s(l=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0});l.default=De;l.URL=l.DNS=void 0;var Pe=ge(h());function ge(e){return e&&e.__esModule?e:{default:e}}function xe(e){var t=[];return e.replace(/[a-fA-F0-9]{2}/g,function(r){t.push(parseInt(r,16))}),t}function he(e){e=unescape(encodeURIComponent(e));for(var t=new Array(e.length),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}var B="6ba7b810-9dad-11d1-80b4-00c04fd430c8";l.DNS=B;var H="6ba7b811-9dad-11d1-80b4-00c04fd430c8";l.URL=H;function De(e,t,r){var u=function(a,d,o,n){var c=o&&n||0;if(typeof a=="string"&&(a=he(a)),typeof d=="string"&&(d=xe(d)),!Array.isArray(a))throw TypeError("value must be an array of bytes");if(!Array.isArray(d)||d.length!==16)throw TypeError("namespace must be uuid string or an Array of 16 byte values");var i=r(d.concat(a));if(i[6]=i[6]&15|t,i[8]=i[8]&63|128,o)for(var f=0;f<16;++f)o[c+f]=i[f];return o||(0,Pe.default)(i)};try{u.name=e}catch{}return u.DNS=B,u.URL=H,u}});var K=s(q=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0});q.default=void 0;var qe=Ce(require("crypto"));function Ce(e){return e&&e.__esModule?e:{default:e}}function we(e){return Array.isArray(e)?e=Buffer.from(e):typeof e=="string"&&(e=Buffer.from(e,"utf8")),qe.default.createHash("md5").update(e).digest()}var Ae=we;q.default=Ae});var F=s(C=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0});C.default=void 0;var Re=V(b()),Oe=V(K());function V(e){return e&&e.__esModule?e:{default:e}}var Te=(0,Re.default)("v3",48,Oe.default),Me=Te;C.default=Me});var z=s(w=>{"use strict";Object.defineProperty(w,"__esModule",{value:!0});w.default=void 0;var Ee=W(E()),Ie=W(h());function W(e){return e&&e.__esModule?e:{default:e}}function Ne(e,t,r){var u=t&&r||0;typeof e=="string"&&(t=e==="binary"?new Array(16):null,e=null),e=e||{};var a=e.random||(e.rng||Ee.default)();if(a[6]=a[6]&15|64,a[8]=a[8]&63|128,t)for(var d=0;d<16;++d)t[u+d]=a[d];return t||(0,Ie.default)(a)}var Ue=Ne;w.default=Ue});var Q=s(A=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0});A.default=void 0;var be=Se(require("crypto"));function Se(e){return e&&e.__esModule?e:{default:e}}function Le(e){return Array.isArray(e)?e=Buffer.from(e):typeof e=="string"&&(e=Buffer.from(e,"utf8")),be.default.createHash("sha1").update(e).digest()}var ke=Le;A.default=ke});var Y=s(R=>{"use strict";Object.defineProperty(R,"__esModule",{value:!0});R.default=void 0;var Je=X(b()),Ge=X(Q());function X(e){return e&&e.__esModule?e:{default:e}}var $e=(0,Je.default)("v5",80,Ge.default),Be=$e;R.default=Be});var Z=s(v=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0});Object.defineProperty(v,"v1",{enumerable:!0,get:function(){return He.default}});Object.defineProperty(v,"v3",{enumerable:!0,get:function(){return Ke.default}});Object.defineProperty(v,"v4",{enumerable:!0,get:function(){return Ve.default}});Object.defineProperty(v,"v5",{enumerable:!0,get:function(){return Fe.default}});var He=O($()),Ke=O(F()),Ve=O(z()),Fe=O(Y());function O(e){return e&&e.__esModule?e:{default:e}}});var Xe={};oe(Xe,{handler:()=>Qe});module.exports=ie(Xe);var _=ne(Z(),1),ir=_.default.v1,sr=_.default.v3,j=_.default.v4,cr=_.default.v5;var T=class{constructor(t,r){this.ddbCliente=t,this.productsDdb=r}async getAllProducts(){return console.log("this.ddbCliente:",this.ddbCliente),console.log("this.productsDdb:",this.productsDdb),(await this.ddbCliente.scan({TableName:this.productsDdb}).promise()).Items}async getProductById(t){let r=await this.ddbCliente.get({TableName:this.productsDdb,Key:{id:t}}).promise();if(r.Item)return r.Item;throw new Error("Product not found")}async createProduct(t){return t.id=j(),await this.ddbCliente.put({TableName:this.productsDdb,Item:t}).promise(),t}async deleteProduct(t){let r=await this.ddbCliente.delete({TableName:this.productsDdb,Key:{id:t},ReturnValues:"ALL_OLD"}).promise();if(r.Attributes)return r.Attributes;throw new Error("Product not found")}async updateProduct(t,r){let u=await this.ddbCliente.update({TableName:this.productsDdb,Key:{id:t},ConditionExpression:"attribute_exists(id)",ReturnValues:"UPDATED_NEW",UpdateExpression:"set productName = :n, code = :c, price = :p, model = :m, productUrl = :u",ExpressionAttributeValues:{":n":r.productName,":c":r.code,":p":r.price,":m":r.model,":u":r.productUrl}}).promise();return u.Attributes.id=t,u.Attributes}};var ee=require("aws-sdk"),We=process.env.PRODUCTS_DDB,ze=new ee.DynamoDB.DocumentClient,S=new T(ze,We);async function Qe(e,t){let r=e.httpMethod,u=t.awsRequestId,a=e.requestContext.requestId;if(console.log(`API Gateway RequestId: ${a} - lambda RequestId: ${u}`),e.resource==="/products"){if(r==="POST"){console.log("POST /products");let d=JSON.parse(e.body),o=await S.createProduct(d);return{statusCode:201,body:JSON.stringify(o)}}}else if(e.resource==="/products/{id}"){let d=e.pathParameters.id;if(r==="PUT"){console.log(`PUT /products/${d}`);let o=JSON.parse(e.body);try{let n=await S.updateProduct(d,o);return{statusCode:200,body:JSON.stringify(n)}}catch{return{statusCode:404,body:"Product nout found"}}}else if(r==="DELETE"){console.log(`DELETE /products/${d}`);try{let o=await S.deleteProduct(d);return{statusCode:200,body:JSON.stringify(o)}}catch(o){return console.log(o.message),{statusCode:404,body:o.message}}}}return{statusCode:400,body:JSON.stringify({message:"bad request"})}}0&&(module.exports={handler});
