"use strict";var mu=Object.create;var lt=Object.defineProperty;var vu=Object.getOwnPropertyDescriptor;var _u=Object.getOwnPropertyNames;var Eu=Object.getPrototypeOf,Su=Object.prototype.hasOwnProperty;var d=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),yu=(t,e)=>{for(var r in e)lt(t,r,{get:e[r],enumerable:!0})},fn=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of _u(e))!Su.call(t,s)&&s!==r&&lt(t,s,{get:()=>e[s],enumerable:!(n=vu(e,s))||n.enumerable});return t};var pn=(t,e,r)=>(r=t!=null?mu(Eu(t)):{},fn(e||!t||!t.__esModule?lt(r,"default",{value:t,enumerable:!0}):r,t)),Tu=t=>fn(lt({},"__esModule",{value:!0}),t);var ir=d(sr=>{"use strict";Object.defineProperty(sr,"__esModule",{value:!0});sr.default=Au;var Ru=bu(require("crypto"));function bu(t){return t&&t.__esModule?t:{default:t}}function Au(){return Ru.default.randomBytes(16)}});var ft=d(dt=>{"use strict";Object.defineProperty(dt,"__esModule",{value:!0});dt.default=void 0;var hn=[];for($e=0;$e<256;++$e)hn[$e]=($e+256).toString(16).substr(1);var $e;function qu(t,e){var r=e||0,n=hn;return[n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]]].join("")}var Iu=qu;dt.default=Iu});var vn=d(pt=>{"use strict";Object.defineProperty(pt,"__esModule",{value:!0});pt.default=void 0;var Cu=mn(ir()),wu=mn(ft());function mn(t){return t&&t.__esModule?t:{default:t}}var gn,or,ar=0,ur=0;function xu(t,e,r){var n=e&&r||0,s=e||[];t=t||{};var i=t.node||gn,o=t.clockseq!==void 0?t.clockseq:or;if(i==null||o==null){var a=t.random||(t.rng||Cu.default)();i==null&&(i=gn=[a[0]|1,a[1],a[2],a[3],a[4],a[5]]),o==null&&(o=or=(a[6]<<8|a[7])&16383)}var u=t.msecs!==void 0?t.msecs:new Date().getTime(),c=t.nsecs!==void 0?t.nsecs:ur+1,l=u-ar+(c-ur)/1e4;if(l<0&&t.clockseq===void 0&&(o=o+1&16383),(l<0||u>ar)&&t.nsecs===void 0&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");ar=u,ur=c,or=o,u+=122192928e5;var f=((u&268435455)*1e4+c)%4294967296;s[n++]=f>>>24&255,s[n++]=f>>>16&255,s[n++]=f>>>8&255,s[n++]=f&255;var m=u/4294967296*1e4&268435455;s[n++]=m>>>8&255,s[n++]=m&255,s[n++]=m>>>24&15|16,s[n++]=m>>>16&255,s[n++]=o>>>8|128,s[n++]=o&255;for(var p=0;p<6;++p)s[n+p]=i[p];return e||(0,wu.default)(s)}var Nu=xu;pt.default=Nu});var cr=d(le=>{"use strict";Object.defineProperty(le,"__esModule",{value:!0});le.default=Pu;le.URL=le.DNS=void 0;var Ou=Lu(ft());function Lu(t){return t&&t.__esModule?t:{default:t}}function Du(t){var e=[];return t.replace(/[a-fA-F0-9]{2}/g,function(r){e.push(parseInt(r,16))}),e}function $u(t){t=unescape(encodeURIComponent(t));for(var e=new Array(t.length),r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}var _n="6ba7b810-9dad-11d1-80b4-00c04fd430c8";le.DNS=_n;var En="6ba7b811-9dad-11d1-80b4-00c04fd430c8";le.URL=En;function Pu(t,e,r){var n=function(s,i,o,a){var u=o&&a||0;if(typeof s=="string"&&(s=$u(s)),typeof i=="string"&&(i=Du(i)),!Array.isArray(s))throw TypeError("value must be an array of bytes");if(!Array.isArray(i)||i.length!==16)throw TypeError("namespace must be uuid string or an Array of 16 byte values");var c=r(i.concat(s));if(c[6]=c[6]&15|e,c[8]=c[8]&63|128,o)for(var l=0;l<16;++l)o[u+l]=c[l];return o||(0,Ou.default)(c)};try{n.name=t}catch{}return n.DNS=_n,n.URL=En,n}});var Sn=d(ht=>{"use strict";Object.defineProperty(ht,"__esModule",{value:!0});ht.default=void 0;var ku=Mu(require("crypto"));function Mu(t){return t&&t.__esModule?t:{default:t}}function Fu(t){return Array.isArray(t)?t=Buffer.from(t):typeof t=="string"&&(t=Buffer.from(t,"utf8")),ku.default.createHash("md5").update(t).digest()}var Uu=Fu;ht.default=Uu});var Tn=d(gt=>{"use strict";Object.defineProperty(gt,"__esModule",{value:!0});gt.default=void 0;var Bu=yn(cr()),Wu=yn(Sn());function yn(t){return t&&t.__esModule?t:{default:t}}var Gu=(0,Bu.default)("v3",48,Wu.default),Xu=Gu;gt.default=Xu});var bn=d(mt=>{"use strict";Object.defineProperty(mt,"__esModule",{value:!0});mt.default=void 0;var Hu=Rn(ir()),Vu=Rn(ft());function Rn(t){return t&&t.__esModule?t:{default:t}}function ju(t,e,r){var n=e&&r||0;typeof t=="string"&&(e=t==="binary"?new Array(16):null,t=null),t=t||{};var s=t.random||(t.rng||Hu.default)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,e)for(var i=0;i<16;++i)e[n+i]=s[i];return e||(0,Vu.default)(s)}var Ku=ju;mt.default=Ku});var An=d(vt=>{"use strict";Object.defineProperty(vt,"__esModule",{value:!0});vt.default=void 0;var Qu=Yu(require("crypto"));function Yu(t){return t&&t.__esModule?t:{default:t}}function zu(t){return Array.isArray(t)?t=Buffer.from(t):typeof t=="string"&&(t=Buffer.from(t,"utf8")),Qu.default.createHash("sha1").update(t).digest()}var Ju=zu;vt.default=Ju});var In=d(_t=>{"use strict";Object.defineProperty(_t,"__esModule",{value:!0});_t.default=void 0;var Zu=qn(cr()),ec=qn(An());function qn(t){return t&&t.__esModule?t:{default:t}}var tc=(0,Zu.default)("v5",80,ec.default),rc=tc;_t.default=rc});var Cn=d(_e=>{"use strict";Object.defineProperty(_e,"__esModule",{value:!0});Object.defineProperty(_e,"v1",{enumerable:!0,get:function(){return nc.default}});Object.defineProperty(_e,"v3",{enumerable:!0,get:function(){return sc.default}});Object.defineProperty(_e,"v4",{enumerable:!0,get:function(){return ic.default}});Object.defineProperty(_e,"v5",{enumerable:!0,get:function(){return oc.default}});var nc=Et(vn()),sc=Et(Tn()),ic=Et(bn()),oc=Et(In());function Et(t){return t&&t.__esModule?t:{default:t}}});var Ln=d((og,On)=>{"use strict";function lr(t){return typeof t=="function"}var $=console.error.bind(console);function ke(t,e,r){var n=!!t[e]&&t.propertyIsEnumerable(e);Object.defineProperty(t,e,{configurable:!0,enumerable:n,writable:!0,value:r})}function Me(t){t&&t.logger&&(lr(t.logger)?$=t.logger:$("new logger isn't a function, not replacing"))}function xn(t,e,r){if(!t||!t[e]){$("no original function "+e+" to wrap");return}if(!r){$("no wrapper function"),$(new Error().stack);return}if(!lr(t[e])||!lr(r)){$("original object and wrapper must be functions");return}var n=t[e],s=r(n,e);return ke(s,"__original",n),ke(s,"__unwrap",function(){t[e]===s&&ke(t,e,n)}),ke(s,"__wrapped",!0),ke(t,e,s),s}function ac(t,e,r){if(t)Array.isArray(t)||(t=[t]);else{$("must provide one or more modules to patch"),$(new Error().stack);return}if(!(e&&Array.isArray(e))){$("must provide one or more functions to wrap on modules");return}t.forEach(function(n){e.forEach(function(s){xn(n,s,r)})})}function Nn(t,e){if(!t||!t[e]){$("no function to unwrap."),$(new Error().stack);return}if(!t[e].__unwrap)$("no original to unwrap to -- has "+e+" already been unwrapped?");else return t[e].__unwrap()}function uc(t,e){if(t)Array.isArray(t)||(t=[t]);else{$("must provide one or more modules to patch"),$(new Error().stack);return}if(!(e&&Array.isArray(e))){$("must provide one or more functions to unwrap on modules");return}t.forEach(function(r){e.forEach(function(n){Nn(r,n)})})}Me.wrap=xn;Me.massWrap=ac;Me.unwrap=Nn;Me.massUnwrap=uc;On.exports=Me});var Mn=d((ag,kn)=>{"use strict";var $n=Ln(),Ee=$n.wrap,yt=$n.unwrap,Y="wrap@before";function Tt(t,e,r){var n=!!t[e]&&t.propertyIsEnumerable(e);Object.defineProperty(t,e,{configurable:!0,enumerable:n,writable:!0,value:r})}function cc(t,e){for(var r=e.length,n=0;n<r;n++){var s=e[n],i=t[Y];if(typeof i=="function")i(s);else if(Array.isArray(i))for(var o=i.length,a=0;a<o;a++)i[a](s)}}function Pn(t,e){var r;return r=t._events&&t._events[e],Array.isArray(r)||(r?r=[r]:r=[]),r}function lc(t,e,r){var n=Pn(t,e),s=n.filter(function(i){return r.indexOf(i)===-1});s.length>0&&cc(t,s)}function Dn(t,e){if(t){var r=t;if(typeof t=="function")r=e(t);else if(Array.isArray(t)){r=[];for(var n=0;n<t.length;n++)r[n]=e(t[n])}return r}}kn.exports=function(e,r,n){if(!e||!e.on||!e.addListener||!e.removeListener||!e.emit)throw new Error("can only wrap real EEs");if(!r)throw new Error("must have function to run on listener addition");if(!n)throw new Error("must have function to wrap listeners when emitting");function s(o){return function(u,c){var l=Pn(this,u).slice();try{var f=o.call(this,u,c);return lc(this,u,l),f}finally{this.on.__wrapped||Ee(this,"on",s),this.addListener.__wrapped||Ee(this,"addListener",s)}}}function i(o){return function(u){if(!this._events||!this._events[u])return o.apply(this,arguments);var c=this._events[u];function l(f){return function(){this._events[u]=c;try{return f.apply(this,arguments)}finally{c=this._events[u],this._events[u]=Dn(c,n)}}}Ee(this,"removeListener",l);try{return this._events[u]=Dn(c,n),o.apply(this,arguments)}finally{yt(this,"removeListener"),this._events[u]=c}}}e[Y]?typeof e[Y]=="function"?Tt(e,Y,[e[Y],r]):Array.isArray(e[Y])&&e[Y].push(r):Tt(e,Y,r),e.__wrapped||(Ee(e,"addListener",s),Ee(e,"on",s),Ee(e,"emit",i),Tt(e,"__unwrap",function(){yt(e,"addListener"),yt(e,"on"),yt(e,"emit"),delete e[Y],delete e.__wrapped}),Tt(e,"__wrapped",!0))}});var Wn=d((ug,Bn)=>{"use strict";var S=require("util"),z=require("assert"),dc=Mn(),R=require("async_hooks"),Fe="cls@contexts",Ue="error@context",q=process.env.DEBUG_CLS_HOOKED,E=-1;Bn.exports={getNamespace:Fn,createNamespace:fc,destroyNamespace:Un,reset:pc,ERROR_SYMBOL:Ue};function W(t){this.name=t,this.active=null,this._set=[],this.id=null,this._contexts=new Map,this._indent=0}W.prototype.set=function(e,r){if(!this.active)throw new Error("No context available. ns.run() or ns.bind() must be called first.");if(this.active[e]=r,q){let n=" ".repeat(this._indent<0?0:this._indent);b(n+"CONTEXT-SET KEY:"+e+"="+r+" in ns:"+this.name+" currentUid:"+E+" active:"+S.inspect(this.active,{showHidden:!0,depth:2,colors:!0}))}return r};W.prototype.get=function(e){if(!this.active){if(q){let r=R.currentId(),n=R.triggerAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);b(`${s}CONTEXT-GETTING KEY NO ACTIVE NS: (${this.name}) ${e}=undefined currentUid:${E} asyncHooksCurrentId:${r} triggerId:${n} len:${this._set.length}`)}return}if(q){let r=R.executionAsyncId(),n=R.triggerAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);b(s+"CONTEXT-GETTING KEY:"+e+"="+this.active[e]+" ("+this.name+") currentUid:"+E+" active:"+S.inspect(this.active,{showHidden:!0,depth:2,colors:!0})),b(`${s}CONTEXT-GETTING KEY: (${this.name}) ${e}=${this.active[e]} currentUid:${E} asyncHooksCurrentId:${r} triggerId:${n} len:${this._set.length} active:${S.inspect(this.active)}`)}return this.active[e]};W.prototype.createContext=function(){let e=Object.create(this.active?this.active:Object.prototype);if(e._ns_name=this.name,e.id=E,q){let r=R.executionAsyncId(),n=R.triggerAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);b(`${s}CONTEXT-CREATED Context: (${this.name}) currentUid:${E} asyncHooksCurrentId:${r} triggerId:${n} len:${this._set.length} context:${S.inspect(e,{showHidden:!0,depth:2,colors:!0})}`)}return e};W.prototype.run=function(e){let r=this.createContext();this.enter(r);try{if(q){let n=R.triggerAsyncId(),s=R.executionAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);b(`${i}CONTEXT-RUN BEGIN: (${this.name}) currentUid:${E} triggerId:${n} asyncHooksCurrentId:${s} len:${this._set.length} context:${S.inspect(r)}`)}return e(r),r}catch(n){throw n&&(n[Ue]=r),n}finally{if(q){let n=R.triggerAsyncId(),s=R.executionAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);b(`${i}CONTEXT-RUN END: (${this.name}) currentUid:${E} triggerId:${n} asyncHooksCurrentId:${s} len:${this._set.length} ${S.inspect(r)}`)}this.exit(r)}};W.prototype.runAndReturn=function(e){let r;return this.run(function(n){r=e(n)}),r};W.prototype.runPromise=function(e){let r=this.createContext();this.enter(r);let n=e(r);if(!n||!n.then||!n.catch)throw new Error("fn must return a promise.");return q&&b("CONTEXT-runPromise BEFORE: ("+this.name+") currentUid:"+E+" len:"+this._set.length+" "+S.inspect(r)),n.then(s=>(q&&b("CONTEXT-runPromise AFTER then: ("+this.name+") currentUid:"+E+" len:"+this._set.length+" "+S.inspect(r)),this.exit(r),s)).catch(s=>{throw s[Ue]=r,q&&b("CONTEXT-runPromise AFTER catch: ("+this.name+") currentUid:"+E+" len:"+this._set.length+" "+S.inspect(r)),this.exit(r),s})};W.prototype.bind=function(e,r){r||(this.active?r=this.active:r=this.createContext());let n=this;return function(){n.enter(r);try{return e.apply(this,arguments)}catch(i){throw i&&(i[Ue]=r),i}finally{n.exit(r)}}};W.prototype.enter=function(e){if(z.ok(e,"context must be provided for entering"),q){let r=R.executionAsyncId(),n=R.triggerAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);b(`${s}CONTEXT-ENTER: (${this.name}) currentUid:${E} triggerId:${n} asyncHooksCurrentId:${r} len:${this._set.length} ${S.inspect(e)}`)}this._set.push(this.active),this.active=e};W.prototype.exit=function(e){if(z.ok(e,"context must be provided for exiting"),q){let n=R.executionAsyncId(),s=R.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);b(`${i}CONTEXT-EXIT: (${this.name}) currentUid:${E} triggerId:${s} asyncHooksCurrentId:${n} len:${this._set.length} ${S.inspect(e)}`)}if(this.active===e){z.ok(this._set.length,"can't remove top context"),this.active=this._set.pop();return}let r=this._set.lastIndexOf(e);r<0?(q&&b("??ERROR?? context exiting but not entered - ignoring: "+S.inspect(e)),z.ok(r>=0,`context not currently entered; can't exit. 
`+S.inspect(this)+`
`+S.inspect(e))):(z.ok(r,"can't remove top context"),this._set.splice(r,1))};W.prototype.bindEmitter=function(e){z.ok(e.on&&e.addListener&&e.emit,"can only bind real EEs");let r=this,n="context@"+this.name;function s(o){o&&(o[Fe]||(o[Fe]=Object.create(null)),o[Fe][n]={namespace:r,context:r.active})}function i(o){if(!(o&&o[Fe]))return o;let a=o,u=o[Fe];return Object.keys(u).forEach(function(c){let l=u[c];a=l.namespace.bind(a,l.context)}),a}dc(e,s,i)};W.prototype.fromException=function(e){return e[Ue]};function Fn(t){return process.namespaces[t]}function fc(t){z.ok(t,"namespace must be given a name."),q&&b(`NS-CREATING NAMESPACE (${t})`);let e=new W(t);return e.id=E,R.createHook({init(n,s,i,o){if(E=R.executionAsyncId(),e.active){if(e._contexts.set(n,e.active),q){let a=" ".repeat(e._indent<0?0:e._indent);b(`${a}INIT [${s}] (${t}) asyncId:${n} currentUid:${E} triggerId:${i} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${o}`)}}else if(E===0){let a=R.triggerAsyncId(),u=e._contexts.get(a);if(u){if(e._contexts.set(n,u),q){let c=" ".repeat(e._indent<0?0:e._indent);b(`${c}INIT USING CONTEXT FROM TRIGGERID [${s}] (${t}) asyncId:${n} currentUid:${E} triggerId:${a} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${o}`)}}else if(q){let c=" ".repeat(e._indent<0?0:e._indent);b(`${c}INIT MISSING CONTEXT [${s}] (${t}) asyncId:${n} currentUid:${E} triggerId:${a} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${o}`)}}if(q&&s==="PROMISE"){b(S.inspect(o,{showHidden:!0}));let a=o.parentId,u=" ".repeat(e._indent<0?0:e._indent);b(`${u}INIT RESOURCE-PROMISE [${s}] (${t}) parentId:${a} asyncId:${n} currentUid:${E} triggerId:${i} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${o}`)}},before(n){E=R.executionAsyncId();let s;if(s=e._contexts.get(n)||e._contexts.get(E),s){if(q){let i=R.triggerAsyncId(),o=" ".repeat(e._indent<0?0:e._indent);b(`${o}BEFORE (${t}) asyncId:${n} currentUid:${E} triggerId:${i} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${S.inspect(s)}`),e._indent+=2}e.enter(s)}else if(q){let i=R.triggerAsyncId(),o=" ".repeat(e._indent<0?0:e._indent);b(`${o}BEFORE MISSING CONTEXT (${t}) asyncId:${n} currentUid:${E} triggerId:${i} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} namespace._contexts:${S.inspect(e._contexts,{showHidden:!0,depth:2,colors:!0})}`),e._indent+=2}},after(n){E=R.executionAsyncId();let s;if(s=e._contexts.get(n)||e._contexts.get(E),s){if(q){let i=R.triggerAsyncId();e._indent-=2;let o=" ".repeat(e._indent<0?0:e._indent);b(`${o}AFTER (${t}) asyncId:${n} currentUid:${E} triggerId:${i} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${S.inspect(s)}`)}e.exit(s)}else if(q){let i=R.triggerAsyncId();e._indent-=2;let o=" ".repeat(e._indent<0?0:e._indent);b(`${o}AFTER MISSING CONTEXT (${t}) asyncId:${n} currentUid:${E} triggerId:${i} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${S.inspect(s)}`)}},destroy(n){if(E=R.executionAsyncId(),q){let s=R.triggerAsyncId(),i=" ".repeat(e._indent<0?0:e._indent);b(`${i}DESTROY (${t}) currentUid:${E} asyncId:${n} triggerId:${s} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${S.inspect(e._contexts.get(E))}`)}e._contexts.delete(n)}}).enable(),process.namespaces[t]=e,e}function Un(t){let e=Fn(t);z.ok(e,`can't delete nonexistent namespace! "`+t+'"'),z.ok(e.id,"don't assign to process.namespaces directly! "+S.inspect(e)),process.namespaces[t]=null}function pc(){process.namespaces&&Object.keys(process.namespaces).forEach(function(t){Un(t)}),process.namespaces=Object.create(null)}process.namespaces={};function b(...t){q&&process._rawDebug(`${S.format(...t)}`)}});var A=d((cg,Hn)=>{"use strict";var dr=["debug","info","warn","error","silent"],Gn=dr.indexOf("error"),hc=gc(process.env.AWS_XRAY_DEBUG_MODE?"debug":process.env.AWS_XRAY_LOG_LEVEL),Xn={error:Rt("error"),info:Rt("info"),warn:Rt("warn"),debug:Rt("debug")};function Rt(t){var e=dr.indexOf(t),r=console[t]||console.log||(()=>{});return e>=hc?(n,s)=>{(n||s)&&r(_c(t,n,s))}:()=>{}}function gc(t){if(t){var e=t.toLowerCase(),r=dr.indexOf(e);return r>=0?r:Gn}return Gn}function mc(t){var e=-t.getTimezoneOffset(),r=e>=0?"+":"-",n=function(s){var i=Math.floor(Math.abs(s));return(i<10?"0":"")+i};return new Date(t.getTime()+e*60*1e3).toISOString().replace(/T/," ").replace(/Z/," ")+r+n(e/60)+":"+n(e%60)}function vc(){return process.env.LAMBDA_TASK_ROOT!==void 0}function _c(t,e,r){var n=[];vc()||(n.push(mc(new Date)),n.push(`[${t.toUpperCase()}]`)),e&&n.push(e);var s=n.join(" "),i=Ec(r);return[s,i].filter(o=>o.length>0).join(`
  `)}function Ec(t){return t?typeof t=="string"?t:JSON.stringify(t):""}var Sc={setLogger:function(e){Xn=e},getLogger:function(){return Xn}};Hn.exports=Sc});var fr=d((lg,jn)=>{"use strict";var yc=require("crypto");function Vn(t,e){this.init(t,e)}Vn.prototype.init=function(e,r){var n=typeof e=="string"||e instanceof String?{message:e,name:""}:e;if(this.message=n.message,this.type=n.name,this.stack=[],this.remote=!!r,this.id=yc.randomBytes(8).toString("hex"),n.stack){var s=n.stack.split(`
`);s.shift(),s.forEach(i=>{var o=i.trim().replace(/\(|\)/g,"");o=o.substring(o.indexOf(" ")+1);var a=o.lastIndexOf(" ")>=0?o.slice(0,o.lastIndexOf(" ")):null,u=Array.isArray(a)&&!a.length?o:o.slice(o.lastIndexOf(" ")+1);u=u.split(":");var c={path:u[0],line:parseInt(u[1]),label:a||"anonymous"};this.stack.push(c)},this)}};jn.exports=Vn});var Qn=d((dg,Kn)=>{Kn.exports=Tc;function Tc(t){var e=!1,r=null,n=null,s=null;return o;function i(a){s&&Ac(s,a),e=!1,s=n;var u=r;if(r=null,n=null,!u||!u.length){if(!s||!s.length){s=null;return}u||(u=[])}e=!0,t(u,i)}function o(a,u){e?(r||(r=[],n=[]),Rc(r,a),u&&n.push(u)):(u&&(s=[u]),e=!0,t(Array.isArray(a)?a:[a],i))}}function Rc(t,e){Array.isArray(e)?bc(t,e):t.push(e)}function bc(t,e){for(var r=0;r<e.length;r++)t.push(e[r])}function Ac(t,e){for(var r=0;r<t.length;r++)t[r](e)}});var bt=d((fg,Jn)=>{"use strict";var Yn=A(),V={udp_ip:"127.0.0.1",udp_port:2e3,tcp_ip:"127.0.0.1",tcp_port:2e3,setDaemonAddress:function(e){process.env.AWS_XRAY_DAEMON_ADDRESS?Yn.getLogger().warn("Ignoring call to setDaemonAddress as AWS_XRAY_DAEMON_ADDRESS is set. The current daemon address will not be changed."):(zn(e),Yn.getLogger().info("Configured daemon address to "+e+"."))}},zn=function(e){if(e.indexOf(":")===-1)throw new Error("Invalid Daemon Address. You must specify an ip and port.");var r=e.split(" ");if(r.length===1){if(e.indexOf("udp")>-1||e.indexOf("tcp")>-1)throw new Error("Invalid Daemon Address. You must specify both tcp and udp addresses.");var n=e.split(":");if(!n[0])throw new Error("Invalid Daemon Address. You must specify an ip.");V.udp_ip=n[0],V.tcp_ip=n[0],V.udp_port=n[1],V.tcp_port=n[1]}else if(r.length===2){var s=r[0].split(":"),i=r[1].split(":"),o={};if(o[s[0]]=s,o[i[0]]=i,V.udp_ip=o.udp[1],V.udp_port=parseInt(o.udp[2]),V.tcp_ip=o.tcp[1],V.tcp_port=parseInt(o.tcp[2]),!V.udp_port||!V.tcp_port)throw new Error("Invalid Daemon Address. You must specify port number.")}};process.env.AWS_XRAY_DAEMON_ADDRESS&&zn(process.env.AWS_XRAY_DAEMON_ADDRESS);Jn.exports=V});var qt=d((pg,ss)=>{"use strict";var ts=require("dgram"),qc=Qn(),At=A(),Zn='{"format":"json","version":1}',es=`
`;function Ic(t,e){var r=ts.createSocket("udp4");rs(r,t,0,function(){try{r.close()}finally{e()}})}function rs(t,e,r,n){if(r>=e.length){n();return}Cc(t,e[r],function(){rs(t,e,r+1,n)})}function Cc(t,e,r){var n=e.msg,s=e.offset,i=e.length,o=e.port,a=e.address,u=e.callback;t.send(n,s,i,o,a,function(c){try{u(c)}finally{r()}})}function ns(){this.batchSend=qc(Ic)}ns.prototype.send=function(t,e,r,n,s,i){var o={msg:t,offset:e,length:r,port:n,address:s,callback:i};this.batchSend(o)};var wc={daemonConfig:bt(),format:function(e){return Zn+es+e.toString()},send:function(e){this.socket||(this.useBatchingTemporarySocket?this.socket=new ns:this.socket=ts.createSocket("udp4").unref());var r=this.socket,n=e.format(),s=Zn+es+n,i=Buffer.from(s),o='{"trace_id:"'+e.trace_id+'","id":"'+e.id+'"}',a=e.type==="subsegment"?"Subsegment":"Segment";r.send(i,0,i.length,this.daemonConfig.udp_port,this.daemonConfig.udp_ip,function(u){u?u.code==="EMSGSIZE"?At.getLogger().error(a+" too large to send: "+o+" ("+i.length+" bytes)."):At.getLogger().error("Error occured sending segment: ",u):(At.getLogger().debug(a+' sent: {"trace_id:"'+e.trace_id+'","id":"'+e.id+'"}'),At.getLogger().debug("UDP message sent: "+e))})},setDaemonAddress:function(e){this.daemonConfig.setDaemonAddress(e)},getIp:function(){return this.daemonConfig.udp_ip},getPort:function(){return this.daemonConfig.udp_port},disableReusableSocket:function(){this.useBatchingTemporarySocket=!0}};ss.exports=wc});var Ct=d((hg,is)=>{"use strict";var xc=require("crypto"),It=A(),Se=class{constructor(e,r){this.version=1,this.timestamp=e||Math.round(new Date().getTime()/1e3).toString(16),this.id=r||xc.randomBytes(12).toString("hex")}static Invalid(){return new Se("00000000","000000000000000000000000")}static FromString(e){let r="-";var n=new Se,s,i;if(!e||typeof e!="string")return It.getLogger().error("Empty or non-string trace ID provided"),n;let o=e.trim().split(r);return o.length!==3?(It.getLogger().error("Unrecognized trace ID format"),n):(s=parseInt(o[0]),isNaN(s)||s<1?(It.getLogger().error("Trace ID version must be positive integer"),n):(i=parseInt(o[1],16).toString(16),i==="NaN"?(It.getLogger().error("Trace ID timestamp must be a hex-encoded value"),n):(n.version=s,n.timestamp=i,n.id=o[2],n)))}toString(){return`${this.version.toString()}-${this.timestamp}-${this.id}`}};is.exports=Se});var O=d((gg,os)=>{"use strict";var Nc=require("crypto"),Be=A(),Oc=Ct(),pr={getCauseTypeFromHttpStatus:function(e){var r=e.toString();if(r.match(/^[4][0-9]{2}$/)!==null)return"error";if(r.match(/^[5][0-9]{2}$/)!==null)return"fault"},stripQueryStringFromPath:function(e){return e?e.split("?")[0]:""},wildcardMatch:function(e,r){if(e===void 0||r===void 0)return!1;if(e.length===1&&e.charAt(0)==="*")return!0;var n=e.length,s=r.length,i=e.indexOf("*");if(e=e.toLowerCase(),r=r.toLowerCase(),i===-1||i===n-1){var o=function(){for(var m=0,p=0;p<n;p++){var M=e.charAt(p);if(M==="*")return!0;if(M==="?"){if(m===s)return!1;m++}else{if(m>=s||M!=r.charAt(m))return!1;m++}}return m===s};return o()}var a=[];a[0]=!0;for(var u=0;u<n;u++){var c,l=e.charAt(u);if(l!="*")for(c=s-1;c>=0;c--)a[c+1]=!!a[c]&&(l==="?"||l===r.charAt(c));else{for(c=0;c<=s&&!a[c];)c++;for(c;c<=s;c++)a[c]=!0}a[0]=a[0]&&l==="*"}return a[s]},LambdaUtils:{validTraceData:function(t){var e=!1;if(t){var r=pr.processTraceData(t);e=!!(r&&r.root&&r.parent&&r.sampled)}return e},populateTraceData:function(t,e){Be.getLogger().debug("Lambda trace data found: "+e);let r=pr.processTraceData(e);var n=!1;return r?!r.root||!r.parent||!r.sampled?Be.getLogger().error("_X_AMZN_TRACE_ID is missing required information"):n=!0:(r={},Be.getLogger().error("_X_AMZN_TRACE_ID is empty or has an invalid format")),t.trace_id=Oc.FromString(r.root).toString(),t.id=r.parent||Nc.randomBytes(8).toString("hex"),r.root&&t.trace_id!==r.root&&(Be.getLogger().error("_X_AMZN_TRACE_ID contains invalid trace ID"),n=!1),parseInt(r.sampled)?delete t.notTraced:t.notTraced=!0,r.data&&(t.userData=r.data),Be.getLogger().debug("Segment started: "+JSON.stringify(r)),n}},processTraceData:function(e){var r={},n={},s=["root","parent","sampled","self"],i=256;return typeof e=="string"&&e&&(e.split(";").forEach(function(o){if(o){var a=o.split("=");if(a[0]&&a[1]){let u=a[0].trim(),c=a[1].trim(),l=u.toLowerCase(),f=s.indexOf(l)!==-1;f?r[l]=c:!f&&i-(l.length+c.length)>=0&&(n[u]=c,i-=u.length+c.length)}}}),r.data=n),r},objectWithoutProperties:function(e,r,n){r=Array.isArray(r)?r:[],n=typeof n=="boolean"?n:!1;var s=n?Object.create(Object.getPrototypeOf(e)):{};for(var i in e)r.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(s[i]=e[i]);return s},safeParseInt:t=>!t||isNaN(t)?0:parseInt(t)};os.exports=pr});var re=d((mg,cs)=>{"use strict";var{safeParseInt:as}=O(),us=A(),Lc=100,hr={streamingThreshold:Lc,getCurrentTime:function(){return Date.now()/1e3},setOrigin:function(e){this.origin=e},setPluginData:function(e){this.pluginData=e},setSDKData:function(e){this.sdkData=e},setServiceData:function(e){this.serviceData=e},setStreamingThreshold:function(e){isFinite(e)&&e>=0?(hr.streamingThreshold=e,us.getLogger().debug("Subsegment streaming threshold set to: "+e)):us.getLogger().error("Invalid threshold: "+e+". Must be a whole number >= 0.")},getStreamingThreshold:function(){return hr.streamingThreshold},getHttpResponseData:t=>{let e={};if(!t)return e;let r=as(t.statusCode);return r!==0&&(e.status=r),t.headers&&t.headers["content-length"]&&(e.content_length=as(t.headers["content-length"])),e}};cs.exports=hr});var fs=d((vg,ds)=>{"use strict";var{getHttpResponseData:Dc}=re(),{stripQueryStringFromPath:$c}=O();function ls(t,e,r){this.init(t,e,r)}ls.prototype.init=function(e,r,n){this.request={url:e.agent&&e.agent.protocol?e.agent.protocol+"//"+(e.host||e.getHeader("host"))+$c(e.path):"",method:e.method||""},n&&(this.request.traced=!0),r&&(this.response=Dc(r))};ds.exports=ls});var We=d((_g,ps)=>{"use strict";var Pc=require("crypto"),kc=fr(),Mc=fs(),Fc=qt(),gr=re(),Uc=O(),J=A();function y(t){this.init(t)}y.prototype.init=function(e){if(typeof e!="string")throw new Error("Subsegment name must be of type string.");this.id=Pc.randomBytes(8).toString("hex"),this.name=e,this.start_time=gr.getCurrentTime(),this.in_progress=!0,this.counter=0,this.notTraced=!1};y.prototype.addNewSubsegment=function(e){let r=new y(e);return this.addSubsegment(r),r};y.prototype.addSubsegmentWithoutSampling=function(e){this.addSubsegment(e),e.notTraced=!0};y.prototype.addNewSubsegmentWithoutSampling=function(e){let r=new y(e);return this.addSubsegment(r),r.notTraced=!0,r};y.prototype.addSubsegment=function(t){if(!(t instanceof y))throw new Error("Failed to add subsegment:"+t+' to subsegment "'+this.name+'".  Not a subsegment.');this.subsegments===void 0&&(this.subsegments=[]),t.segment=this.segment,t.parent=this,t.notTraced=t.parent.notTraced,t.end_time===void 0&&this.incrementCounter(t.counter),this.subsegments.push(t)};y.prototype.removeSubsegment=function(e){if(!(e instanceof y))throw new Error("Failed to remove subsegment:"+e+' from subsegment "'+this.name+'".  Not a subsegment.');if(this.subsegments!==void 0){var r=this.subsegments.indexOf(e);r>=0&&this.subsegments.splice(r,1)}};y.prototype.addAttribute=function(e,r){this[e]=r};y.prototype.addPrecursorId=function(t){typeof t!="string"&&J.getLogger().error("Failed to add id:"+t+" to subsegment "+this.name+".  Precursor Ids must be of type string."),this.precursor_ids===void 0&&(this.precursor_ids=[]),this.precursor_ids.push(t)};y.prototype.addAnnotation=function(t,e){if(typeof e!="boolean"&&typeof e!="string"&&!isFinite(e)){J.getLogger().error("Failed to add annotation key: "+t+" value: "+e+" to subsegment "+this.name+". Value must be of type string, number or boolean.");return}if(typeof t!="string"){J.getLogger().error("Failed to add annotation key: "+t+" value: "+e+" to subsegment "+this.name+". Key must be of type string.");return}this.annotations===void 0&&(this.annotations={}),this.annotations[t]=e};y.prototype.addMetadata=function(t,e,r){if(typeof t!="string"){J.getLogger().error("Failed to add metadata key: "+t+" value: "+e+" to subsegment "+this.name+". Key must be of type string.");return}if(r&&typeof r!="string"){J.getLogger().error("Failed to add metadata key: "+t+" value: "+e+" to subsegment "+this.name+". Namespace must be of type string.");return}var n=r||"default";this.metadata||(this.metadata={}),this.metadata[n]||(this.metadata[n]={}),n!=="__proto__"&&(this.metadata[n][t]=e??"")};y.prototype.addSqlData=function(e){this.sql=e};y.prototype.addError=function(e,r){if(e==null||typeof e!="object"&&typeof e!="string"){J.getLogger().error("Failed to add error:"+e+' to subsegment "'+this.name+'".  Not an object or string literal.');return}if(this.addFaultFlag(),this.segment&&this.segment.exception){if(e===this.segment.exception.ex){this.fault=!0,this.cause={id:this.segment.exception.cause,exceptions:[]};return}delete this.segment.exception}this.segment&&(this.segment.exception={ex:e,cause:this.id}),this.cause===void 0&&(this.cause={working_directory:process.cwd(),exceptions:[]}),this.cause.exceptions.unshift(new kc(e,r))};y.prototype.addRemoteRequestData=function(e,r,n){this.http=new Mc(e,r,n),"traced"in this.http.request&&(this.traced=this.http.request.traced,delete this.http.request.traced)};y.prototype.addFaultFlag=function(){this.fault=!0};y.prototype.addErrorFlag=function(){this.error=!0};y.prototype.addThrottleFlag=function(){this.throttle=!0};y.prototype.close=function(e,r){var n=this.segment;this.end_time=gr.getCurrentTime(),delete this.in_progress,e&&this.addError(e,r),this.parent&&this.parent.decrementCounter(),n&&n.counter>gr.getStreamingThreshold()&&this.streamSubsegments()&&this.parent&&this.parent.removeSubsegment(this)};y.prototype.incrementCounter=function(e){this.counter=e?this.counter+e+1:this.counter+1,this.parent&&this.parent.incrementCounter(e)};y.prototype.decrementCounter=function(){this.counter--,this.parent&&this.parent.decrementCounter()};y.prototype.isClosed=function(){return!this.in_progress};y.prototype.flush=function(){if(!this.parent||!this.segment){J.getLogger().error("Failed to flush subsegment: "+this.name+". Subsegment must be added to a segment chain to flush.");return}this.segment.trace_id?this.segment.notTraced!==!0&&!this.notTraced?Fc.send(this):J.getLogger().debug("Ignoring flush on subsegment "+this.id+". Associated segment is marked as not sampled."):J.getLogger().debug("Ignoring flush on subsegment "+this.id+". Associated segment is missing a trace ID.")};y.prototype.streamSubsegments=function(){if(this.isClosed()&&this.counter<=0)return this.flush(),!0;if(this.subsegments&&this.subsegments.length>0){var e=[];this.subsegments.forEach(function(r){r.streamSubsegments()||e.push(r)}),this.subsegments=e}};y.prototype.format=function(){return this.type="subsegment",this.parent&&(this.parent_id=this.parent.id),this.segment&&(this.trace_id=this.segment.trace_id),JSON.stringify(this)};y.prototype.toString=function(){return JSON.stringify(this)};y.prototype.toJSON=function(){var e=["segment","parent","counter"];(this.subsegments==null||this.subsegments.length===0)&&e.push("subsegments");var r=Uc.objectWithoutProperties(this,e,!1);return r};ps.exports=y});var Ge=d((Eg,ms)=>{"use strict";var Bc=require("crypto"),Wc=fr(),Gc=qt(),j=re(),wt=We(),hs=Ct(),gs=O(),ne=A();function T(t,e,r){this.init(t,e,r)}T.prototype.init=function(e,r,n){if(typeof e!="string")throw new Error("Segment name must be of type string.");var s;r&&typeof r=="string"?s=hs.FromString(r):s=new hs;var i=Bc.randomBytes(8).toString("hex"),o=j.getCurrentTime();this.trace_id=s.toString(),this.id=i,this.start_time=o,this.name=e||"",this.in_progress=!0,this.counter=0,n&&(this.parent_id=n),j.serviceData&&this.setServiceData(j.serviceData),j.pluginData&&this.addPluginData(j.pluginData),j.origin&&(this.origin=j.origin),j.sdkData&&this.setSDKData(j.sdkData)};T.prototype.addIncomingRequestData=function(e){this.http=e};T.prototype.addAnnotation=function(e,r){if(typeof r!="boolean"&&typeof r!="string"&&!isFinite(r)){ne.getLogger().error("Failed to add annotation key: "+e+" value: "+r+" to subsegment "+this.name+". Value must be of type string, number or boolean.");return}if(typeof e!="string"){ne.getLogger().error("Failed to add annotation key: "+e+" value: "+r+" to subsegment "+this.name+". Key must be of type string.");return}this.annotations===void 0&&(this.annotations={}),this.annotations[e]=r};T.prototype.setUser=function(t){typeof t!="string"&&ne.getLogger().error("Set user: "+t+" failed. User IDs must be of type string."),this.user=t};T.prototype.addMetadata=function(t,e,r){if(typeof t!="string"){ne.getLogger().error("Failed to add metadata key: "+t+" value: "+e+" to segment "+this.name+". Key must be of type string.");return}if(r&&typeof r!="string"){ne.getLogger().error("Failed to add metadata key: "+t+" value: "+e+" to segment "+this.name+". Namespace must be of type string.");return}var n=r||"default";this.metadata||(this.metadata={}),this.metadata[n]||(this.metadata[n]={}),n!=="__proto__"&&(this.metadata[n][t]=e??"")};T.prototype.setSDKData=function(e){if(!e){ne.getLogger().error("Add SDK data: "+e+" failed.Must not be empty.");return}this.aws||(this.aws={}),this.aws.xray=e};T.prototype.setMatchedSamplingRule=function(e){this.aws&&(this.aws=JSON.parse(JSON.stringify(this.aws))),this.aws&&this.aws.xray?this.aws.xray.rule_name=e:this.aws={xray:{rule_name:e}}};T.prototype.setServiceData=function(e){if(!e){ne.getLogger().error("Add service data: "+e+" failed.Must not be empty.");return}this.service=e};T.prototype.addPluginData=function(e){this.aws===void 0&&(this.aws={}),Object.assign(this.aws,e)};T.prototype.addNewSubsegment=function(e){var r=new wt(e);return this.addSubsegment(r),r};T.prototype.addSubsegmentWithoutSampling=function(e){this.addSubsegment(e),e.notTraced=!0};T.prototype.addNewSubsegmentWithoutSampling=function(e){let r=new wt(e);return this.addSubsegment(r),r.notTraced=!0,r};T.prototype.addSubsegment=function(e){if(!(e instanceof wt))throw new Error("Cannot add subsegment: "+e+". Not a subsegment.");this.subsegments===void 0&&(this.subsegments=[]),e.segment=this,e.parent=this,e.notTraced=e.parent.notTraced,this.subsegments.push(e),e.end_time||this.incrementCounter(e.counter)};T.prototype.removeSubsegment=function(e){if(!(e instanceof wt))throw new Error("Failed to remove subsegment:"+e+' from subsegment "'+this.name+'".  Not a subsegment.');if(this.subsegments!==void 0){var r=this.subsegments.indexOf(e);r>=0&&this.subsegments.splice(r,1)}};T.prototype.addError=function(e,r){if(e==null||typeof e!="object"&&typeof e!="string"){ne.getLogger().error("Failed to add error:"+e+' to subsegment "'+this.name+'".  Not an object or string literal.');return}if(this.addFaultFlag(),this.exception){if(e===this.exception.ex){this.cause={id:this.exception.cause},delete this.exception;return}delete this.exception}this.cause===void 0&&(this.cause={working_directory:process.cwd(),exceptions:[]}),this.cause.exceptions.push(new Wc(e,r))};T.prototype.addFaultFlag=function(){this.fault=!0};T.prototype.addErrorFlag=function(){this.error=!0};T.prototype.addThrottleFlag=function(){this.throttle=!0};T.prototype.isClosed=function(){return!this.in_progress};T.prototype.incrementCounter=function(e){if(this.counter=e?this.counter+e+1:this.counter+1,this.counter>j.streamingThreshold&&this.subsegments&&this.subsegments.length>0){var r=[];this.subsegments.forEach(function(n){n.streamSubsegments()||r.push(n)}),this.subsegments=r}};T.prototype.decrementCounter=function(){this.counter--,this.counter<=0&&this.isClosed()&&this.flush()};T.prototype.close=function(t,e){this.end_time||(this.end_time=j.getCurrentTime()),t!==void 0&&this.addError(t,e),delete this.in_progress,delete this.exception,this.counter<=0&&this.flush()};T.prototype.flush=function(){if(this.notTraced!==!0){delete this.exception;var e=gs.objectWithoutProperties(this,["counter","notTraced"],!0);Gc.send(e)}};T.prototype.format=function(){var e=["segment","parent","counter"];(this.subsegments==null||this.subsegments.length===0)&&e.push("subsegments");var r=gs.objectWithoutProperties(this,e,!1);return JSON.stringify(r)};T.prototype.toString=function(){return JSON.stringify(this)};ms.exports=T});var oe=d((Sg,Ss)=>{"use strict";var Xe=Wn(),Q=A(),mr=Ge(),vs=We(),se=!0,ie="AWSXRay",_s="segment",Es=!1,L={CONTEXT_MISSING_STRATEGY:{RUNTIME_ERROR:{contextMissing:function(e){throw new Error(e)}},LOG_ERROR:{contextMissing:function(e){var r=new Error(e);Q.getLogger().error(r.stack)}},IGNORE_ERROR:{contextMissing:function(){}}},contextMissingStrategy:{},resolveManualSegmentParams:function(e){if(e&&!L.isAutomaticMode()){var r=e.XRaySegment||e.XraySegment,n=e.Segment,s=null;return r&&(r instanceof mr||r instanceof vs)?(s=r,delete e.XRaySegment,delete e.XraySegment):n&&(n instanceof mr||n instanceof vs)&&(s=n,delete e.Segment),s}},getNamespace:function(){return Xe.getNamespace(ie)||Xe.createNamespace(ie)},resolveSegment:function(e){if(se)return this.getSegment();if(e&&!se)return e;!e&&!se&&L.contextMissingStrategy.contextMissing("No sub/segment specified. A sub/segment must be provided for manual mode.")},getSegment:function(){if(se){var e=L.getNamespace(ie).get(_s);return e?e instanceof mr&&process.env.LAMBDA_TASK_ROOT&&e.facade==!0&&e.resolveLambdaTraceData():L.contextMissingStrategy.contextMissing("Failed to get the current sub/segment from the context."),e}else L.contextMissingStrategy.contextMissing("Cannot get sub/segment from context. Not supported in manual mode.")},setSegment:function(e){se?L.getNamespace(ie).set(_s,e)||Q.getLogger().warn("Failed to set the current sub/segment on the context."):L.contextMissingStrategy.contextMissing("Cannot set sub/segment on context. Not supported in manual mode.")},isAutomaticMode:function(){return se},enableAutomaticMode:function(){se=!0,L.getNamespace(ie),Q.getLogger().debug("Overriding AWS X-Ray SDK mode. Set to automatic mode.")},enableManualMode:function(){se=!1,Xe.getNamespace(ie)&&Xe.destroyNamespace(ie),Q.getLogger().debug("Overriding AWS X-Ray SDK mode. Set to manual mode.")},setContextMissingStrategy:function(e){if(Es)Q.getLogger().warn("Ignoring call to setContextMissingStrategy as AWS_XRAY_CONTEXT_MISSING is set. The current context missing strategy will not be changed.");else if(typeof e=="string"){var r=L.CONTEXT_MISSING_STRATEGY[e.toUpperCase()];if(r)L.contextMissingStrategy.contextMissing=r.contextMissing,process.env.AWS_XRAY_CONTEXT_MISSING?Q.getLogger().debug("AWS_XRAY_CONTEXT_MISSING is set. Configured context missing strategy to "+process.env.AWS_XRAY_CONTEXT_MISSING+"."):Q.getLogger().debug("Configured context missing strategy to: "+e);else throw new Error("Invalid context missing strategy: "+e+". Valid values are "+Object.keys(L.CONTEXT_MISSING_STRATEGY)+".")}else if(typeof e=="function")L.contextMissingStrategy.contextMissing=e,Q.getLogger().info("Configured custom context missing strategy to function: "+e.name);else throw new Error("Context missing strategy must be either a string or a custom function.")}};Xe.createNamespace(ie);Q.getLogger().debug("Starting the AWS X-Ray SDK in automatic mode (default).");process.env.AWS_XRAY_CONTEXT_MISSING?(L.setContextMissingStrategy(process.env.AWS_XRAY_CONTEXT_MISSING),Es=!0):(L.contextMissingStrategy.contextMissing=L.CONTEXT_MISSING_STRATEGY.LOG_ERROR.contextMissing,Q.getLogger().debug("Using default context missing strategy: LOG_ERROR"));Ss.exports=L});var _r=d((yg,ys)=>{"use strict";var{getHttpResponseData:Xc}=re();function vr(t){this.init(t)}vr.prototype.init=function(e){var r=!!e.headers["x-forwarded-for"],n;e.connection&&(n=(e.connection.secure||e.connection.encrypted?"https://":"http://")+((e.headers.host||"")+(e.url||""))),this.request={method:e.method||"",user_agent:e.headers["user-agent"]||"",client_ip:Hc(e)||"",url:n||""},r&&(this.request.x_forwarded_for=r)};var Hc=function(e){var r;return e.headers["x-forwarded-for"]?r=(e.headers["x-forwarded-for"]||"").split(",")[0]:e.connection&&e.connection.remoteAddress?r=e.connection.remoteAddress:e.socket&&e.socket.remoteAddress?r=e.socket.remoteAddress:e.connection&&e.connection.socket&&e.connection.socket.remoteAddress&&(r=e.connection.socket.remoteAddress),r};vr.prototype.close=function(e){this.response=Xc(e)};ys.exports=vr});var Rs=d((Tg,Ts)=>{"use strict";function Er(t,e){this.init(t,e)}Er.prototype.init=function(e,r){if(this.usedThisSecond=0,typeof e=="number"&&e%1===0&&e>=0)this.fixedTarget=e;else throw new Error('Error in sampling file. Rule attribute "fixed_target" must be a non-negative integer.');if(typeof r=="number"&&r>=0&&r<=1)this.fallbackRate=r;else throw new Error('Error in sampling file. Rule attribute "rate" must be a number between 0 and 1 inclusive.')};Er.prototype.isSampled=function(){var e=Math.round(new Date().getTime()/1e3);return e!==this.thisSecond&&(this.usedThisSecond=0,this.thisSecond=e),this.usedThisSecond>=this.fixedTarget?Math.random()<this.fallbackRate:(this.usedThisSecond++,!0)};Ts.exports=Er});var bs=d((Rg,Vc)=>{Vc.exports={default:{fixed_target:1,rate:.05},version:2}});var yr=d((bg,ws)=>{"use strict";var jc=require("fs"),As=Rs(),Sr=O(),Kc=bs(),xt=A(),Is={shouldSample:function(e){var r=e.host,n=e.httpMethod,s=e.urlPath,i="{ http_method: "+n+", host: "+r+", url_path: "+s+" }",o;return this.rules.some(function(a){if(a.default||r==null||Sr.wildcardMatch(a.host,r)&&(n==null||Sr.wildcardMatch(a.http_method,n))&&(s==null||Sr.wildcardMatch(a.url_path,s)))return o=a.reservoir,xt.getLogger().debug("Local sampling rule match found for "+i+". Matched "+(a.default?"default":"{ http_method: "+a.http_method+", host: "+a.host+", url_path: "+a.url_path+" }")+". Using fixed_target: "+o.fixedTarget+" and rate: "+o.fallbackRate+"."),!0}),o?o.isSampled():(xt.getLogger().debug("No sampling rule matched for "+i),!1)},setLocalRules:function(e){e?typeof e=="string"?(xt.getLogger().info("Using custom sampling rules file: "+e),this.rules=qs(JSON.parse(jc.readFileSync(e,"utf8")))):(xt.getLogger().info("Using custom sampling rules source."),this.rules=qs(e)):this.rules=Cs(Kc)}},qs=function(e){if(!e.version)throw new Error('Error in sampling file. Missing "version" attribute.');if(e.version===1||e.version===2)return Cs(e);throw new Error('Error in sampling file. Unknown version "'+e.version+'".')},Cs=function(e){var r,n=[];if(e.default){var s=[];for(var i in e.default){if(i!=="fixed_target"&&i!=="rate")throw new Error("Error in sampling file. Invalid attribute for default: "+i+'. Valid attributes for default are "fixed_target" and "rate".');if(typeof e.default[i]!="number")throw new Error("Error in sampling file. Default "+i+" must be a number.")}if(typeof e.default.fixed_target>"u"&&s.push("fixed_target"),typeof e.default.rate>"u"&&s.push("rate"),s.length!==0)throw new Error("Error in sampling file. Missing required attributes for default: "+s+".");r={default:!0,reservoir:new As(e.default.fixed_target,e.default.rate)}}else throw new Error('Error in sampling file. Expecting "default" object to be defined with attributes "fixed_target" and "rate".');return Array.isArray(e.rules)&&e.rules.forEach(function(o){var a={},u;e.version===2&&(u={host:1,http_method:1,url_path:1,fixed_target:1,rate:1}),e.version===1&&(u={service_name:1,http_method:1,url_path:1,fixed_target:1,rate:1});for(var c in o){var l=o[c];if(!u[c]&&c!="description")throw new Error("Error in sampling file. Rule "+JSON.stringify(o)+" has invalid attribute: "+c+".");if(c!="description"&&!l&&l!==0)throw new Error("Error in sampling file. Rule "+JSON.stringify(o)+' attribute "'+c+'" has invalid value: '+l+".");e.version===2&&(a[c]=l),e.version===1&&c==="service_name"?a.host=l:a[c]=l,delete u[c]}if(Object.keys(u).length!==0&&u.constructor===Object)throw new Error("Error in sampling file. Rule "+JSON.stringify(o)+" is missing required attributes: "+Object.keys(u)+".");var f=a;f.reservoir=new As(o.fixed_target,o.rate),n.push(f)}),n.push(r),n};Is.setLocalRules();ws.exports=Is});var Ns=d((Ag,xs)=>{"use strict";function ye(){this.init()}ye.prototype.init=function(){this.quota=null,this.TTL=null,this.takenThisSec=0,this.borrowedThisSec=0,this.reportInterval=1,this.reportElapsed=0};ye.prototype.borrowOrTake=function(e,r){if(this.adjustThisSec(e),this.quota>=0&&this.TTL>=e)return this.takenThisSec>=this.quota?!1:(this.takenThisSec++,"take");if(r)return this.borrowedThisSec>=1?!1:(this.borrowedThisSec++,"borrow")};ye.prototype.adjustThisSec=function(e){e!==this.thisSec&&(this.takenThisSec=0,this.borrowedThisSec=0,this.thisSec=e)};ye.prototype.loadNewQuota=function(e,r,n){e&&(this.quota=e),r&&(this.TTL=r),n&&(this.reportInterval=n/10)};ye.prototype.timeToReport=function(){return this.reportElapsed+1>=this.reportInterval?(this.reportElapsed=0,!0):(this.reportElapsed+=1,!1)};xs.exports=ye});var Ls=d((qg,Os)=>{"use strict";var He=O(),Qc=Ns();function x(t,e,r,n,s,i,o,a,u){this.init(t,e,r,n,s,i,o,a,u)}x.prototype.init=function(e,r,n,s,i,o,a,u,c){this.name=e,this.priority=r,this.rate=n,this.host=i,this.httpMethod=o,this.urlPath=a,this.serviceName=u,this.serviceType=c,this.reservoir=new Qc,this.borrow=!!s,this.resetStatistics()};x.prototype.match=function(e){var r=e.host,n=e.httpMethod,s=e.serviceName,i=e.urlPath,o=e.serviceType;return this.isDefault()||(!r||He.wildcardMatch(this.host,r))&&(!n||He.wildcardMatch(this.httpMethod,n))&&(!s||He.wildcardMatch(this.serviceName,s))&&(!i||He.wildcardMatch(this.urlPath,i))&&(!o||He.wildcardMatch(this.serviceType,o))};x.prototype.snapshotStatistics=function(){var e={requestCount:this.requestCount,borrowCount:this.borrowCount,sampledCount:this.sampledCount};return this.resetStatistics(),e};x.prototype.merge=function(e){this.reservoir=e.reservoir,this.requestCount=e.requestCount,this.borrowCount=e.borrowCount,this.sampledCount=e.sampledCount,e=null};x.prototype.isDefault=function(){return this.name==="Default"};x.prototype.incrementRequestCount=function(){this.requestCount++};x.prototype.incrementBorrowCount=function(){this.borrowCount++};x.prototype.incrementSampledCount=function(){this.sampledCount++};x.prototype.setRate=function(e){this.rate=e};x.prototype.getRate=function(){return this.rate};x.prototype.getName=function(){return this.name};x.prototype.getPriority=function(){return this.priority};x.prototype.getReservoir=function(){return this.reservoir};x.prototype.resetStatistics=function(){this.requestCount=0,this.borrowCount=0,this.sampledCount=0};x.prototype.canBorrow=function(){return this.borrow};x.prototype.everMatched=function(){return this.requestCount>0};x.prototype.timeToReport=function(){return this.reservoir.timeToReport()};Os.exports=x});var Tr=d((Ig,ks)=>{"use strict";var Yc=require("crypto"),zc=A(),Jc=Ls(),Nt=bt(),Zc=require("util"),el=require("http"),$s={clientId:Yc.randomBytes(12).toString("hex"),samplingRulesPath:"/GetSamplingRules",samplingTargetsPath:"/SamplingTargets",logger:zc,httpClient:el,fetchSamplingRules:function(e){let r="{}",n=Ds(this.samplingRulesPath,r.length),i=(this.httpClient.__request?this.httpClient.__request:this.httpClient.request)(n,o=>{var a="";o.on("data",u=>{a+=u}),o.on("error",u=>{e(u)}),o.on("end",()=>{var u;try{u=JSON.parse(a)}catch(l){e(l);return}if(!u){e(new Error("AWS X-Ray GetSamplingRules API returned empty response"));return}var c=rl(u);e(null,c)})});i.on("error",()=>{e(new Error(`Failed to connect to X-Ray daemon at ${n.hostname}:${n.port} to get sampling rules.`))}),i.write(r),i.end()},fetchTargets:function(e,r){let n=JSON.stringify(tl(e)),s=Ds(this.samplingTargetsPath,n.length),o=(this.httpClient.__request?this.httpClient.__request:this.httpClient.request)(s,a=>{var u="";a.on("data",c=>{u+=c}),a.on("error",c=>{r(c)}),a.on("end",()=>{var c;try{c=JSON.parse(u)}catch(m){r(m);return}if(!c||typeof c.LastRuleModification!="number"){r(new Error("AWS X-Ray SamplingTargets API returned invalid response"));return}var l=nl(c),f=Ps(c.LastRuleModification);r(null,l,f)})});o.on("error",()=>{r(new Error(`Failed to connect to X-Ray daemon at ${s.hostname}:${s.port} to get sampling targets.`))}),o.write(n),o.end()}},tl=function(e){var r=[],n=Math.floor(new Date().getTime()/1e3);return e.forEach(function(s){var i=s.snapshotStatistics(),o={RuleName:s.getName(),ClientID:$s.clientId,RequestCount:i.requestCount,BorrowCount:i.borrowCount,SampledCount:i.sampledCount,Timestamp:n};r.push(o)}),{SamplingStatisticsDocuments:r}},rl=function(e){var r=[],n=e.SamplingRuleRecords||[];return n.forEach(function(s){if(s=s.SamplingRule,sl(s)){var i=new Jc(s.RuleName,s.Priority,s.FixedRate,s.ReservoirSize,s.Host,s.HTTPMethod,s.URLPath,s.ServiceName,s.ServiceType);r.push(i)}}),r},nl=function(e){var r=e.SamplingTargetDocuments||[],n={};return r.forEach(function(s){var i={rate:s.FixedRate,quota:s.ReservoirQuota,TTL:Ps(s.ReservoirQuotaTTL),interval:s.Interval};n[s.RuleName]=i}),n},sl=function(e){return e.Version===1&&e.ResourceARN==="*"&&e.Attributes&&Object.keys(e.Attributes).length===0&&e.ServiceType&&e.RuleName&&e.Priority&&typeof e.FixedRate=="number"},Ps=function(e){return new Date(e).getTime()/1e3},Ds=function(e,r){return{hostname:Nt.tcp_ip,port:Nt.tcp_port,method:"POST",path:e,headers:{"Content-Type":"application/json","Content-Length":r,Host:Zc.format("%s:%d",Nt.tcp_ip,Nt.tcp_port)}}};ks.exports=$s});var Ot=d((Cg,Ms)=>{"use strict";var il=3600,Rr={rules:[],lastUpdated:null,getMatchedRule:function(e,r){if(ol(r))return null;var n;return this.rules.forEach(function(s){!n&&s.match(e)&&(n=s),s.isDefault()&&!n&&(n=s)}),n},loadRules:function(e){var r={};this.rules.forEach(function(n){r[n.getName()]=n}),this.rules=e,this.rules.forEach(function(n){var s=r[n.getName()];s&&n.merge(s)}),this.rules.sort(function(n,s){var i=n.getPriority()-s.getPriority();return i!==0?i:n.getName()>s.getName()?1:-1})},loadTargets:function(e){this.rules.forEach(function(r){var n=e[r.getName()];n&&(r.getReservoir().loadNewQuota(n.quota,n.TTL,n.interval),r.setRate(n.rate))})},getRules:function(){return this.rules},timestamp:function(e){this.lastUpdated=e},getLastUpdated:function(){return this.lastUpdated}},ol=function(e){return Rr.getLastUpdated()?e>Rr.getLastUpdated()+il:!0};Ms.exports=Rr});var Ar=d((wg,Ws)=>{"use strict";var br=A(),al=Tr(),Fs=Ot(),ul=5*60*1e3,cl={start:function(){this.poller&&clearInterval(this.poller),Us(!1),this.poller=setInterval(Us,ul),this.poller.unref()}},Us=function(e){if(e=typeof e>"u"?!0:e,e){var r=dl();setTimeout(Bs,r)}else Bs()},Bs=function(){try{ll()}catch(e){br.getLogger().warn("Encountered unexpected exception when fetching sampling rules: "+e)}},ll=function(){var e=Math.floor(new Date().getTime()/1e3);al.fetchSamplingRules(function(r,n){r?br.getLogger().warn("Failed to retrieve sampling rules from X-Ray service:",r):n.length!==0&&(Fs.loadRules(n),Fs.timestamp(e),br.getLogger().info("Successfully refreshed centralized sampling rule cache."))})},dl=function(){return Math.random()*5};Ws.exports=cl});var Vs=d((xg,Hs)=>{"use strict";var fl=Ar(),pl=Tr(),qr=Ot(),Lt=A(),Gs=10*1e3,Xs={interval:Gs,start:function(){this.poller=setInterval(hl,Gs+vl()),this.poller.unref()}},hl=function(){try{gl()}catch(e){Lt.getLogger().warn("Encountered unexpected exception when fetching sampling targets: "+e)}},gl=function(){var e=ml();e&&e.length>0&&pl.fetchTargets(e,function(r,n,s){if(r){Lt.getLogger().warn("Failed to retrieve sampling targets from X-Ray service:",r);return}qr.loadTargets(n),s>qr.getLastUpdated()&&(Lt.getLogger().info("Performing out-of-band sampling rule polling to fetch updated rules."),fl.start()),Lt.getLogger().info("Successfully reported rule statistics to get new sampling quota.")})},ml=function(){var e=qr.getRules(),r=[];return e.forEach(function(n){n.everMatched()&&n.timeToReport()&&r.push(n)}),r},vl=function(){return Math.random()/Xs.interval};Hs.exports=Xs});var Ks=d((Ng,js)=>{"use strict";var Ir=A(),_l=require("util"),El=re(),Sl={localSampler:yr(),rulePoller:Ar(),targetPoller:Vs(),ruleCache:Ot(),started:!1,shouldSample:function(e){try{this.started||this.start(),e.serviceType||(e.serviceType=El.origin);var r=Math.floor(new Date().getTime()/1e3),n=this.ruleCache.getMatchedRule(e,r);return n?(Ir.getLogger().debug(_l.format("Rule %s is matched.",n.getName())),yl(n,r)):(Ir.getLogger().info("No effective centralized sampling rule match. Fallback to local rules."),this.localSampler.shouldSample(e))}catch(s){Ir.getLogger().error("Unhandled exception by the SDK during making sampling decisions: "+s)}},setLocalRules:function(e){this.localSampler.setLocalRules(e)},start:function(){this.started||(this.rulePoller.start(),this.targetPoller.start(),this.started=!0)}},yl=function(e,r){e.incrementRequestCount();var n=e.getReservoir(),s=!0,i=n.borrowOrTake(r,e.canBorrow());return i==="borrow"?e.incrementBorrowCount():i==="take"||Math.random()<=e.getRate()?e.incrementSampledCount():s=!1,s?e.getName():!1};js.exports=Sl});var wr=d((Og,Qs)=>{"use strict";var Tl=Ge(),Rl=_r(),bl=A(),Al=O(),ql=O().wildcardMatch,Il=O().processTraceData,Cr="x-amzn-trace-id",Cl=!!process.env.AWS_XRAY_TRACING_NAME,wl={defaultName:process.env.AWS_XRAY_TRACING_NAME,dynamicNaming:!1,hostPattern:null,sampler:Ks(),enableDynamicNaming:function(t){if(this.dynamicNaming=!0,t&&typeof t!="string")throw new Error("Host pattern must be a string.");this.hostPattern=t||null},processHeaders:function(e){var r={};return e&&e.headers&&e.headers[Cr]&&(r=Il(e.headers[Cr])),r},resolveName:function(e){var r;return this.dynamicNaming&&e?r=this.hostPattern?ql(this.hostPattern,e)?e:this.defaultName:e:r=this.defaultName,r},resolveSampling:function(e,r,n){var s;if(e.sampled==="1")s=!0;else if(e.sampled==="0")s=!1;else{var i={host:n.req.headers.host,httpMethod:n.req.method,urlPath:n.req.url,serviceName:r.name};s=this.sampler.shouldSample(i),(s instanceof String||typeof s=="string")&&(r.setMatchedSamplingRule(s),s=!0)}e.sampled==="?"&&(n.header[Cr]="Root="+e.root+";Sampled="+(s?"1":"0")),s||(r.notTraced=!0)},setDefaultName:function(e){Cl||(this.defaultName=e)},disableCentralizedSampling:function(){this.sampler=yr()},setSamplingRules:function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local sampling rules file, or supply an object containing the rules.");this.sampler.setLocalRules(e)},middlewareLog:function(e,r,n){bl.getLogger().debug(e+": { url: "+r+", name: "+n.name+", trace_id: "+n.trace_id+", id: "+n.id+", sampled: "+!n.notTraced+" }")},traceRequestResponseCycle:function(e,r){var n=this.processHeaders(e),s=this.resolveName(e.headers.host),i=new Tl(s,n.root,n.parent),o=Object.assign({},r,{req:e});this.resolveSampling(n,i,o),i.addIncomingRequestData(new Rl(e)),this.middlewareLog("Starting middleware segment",e.url,i);var a=this.middlewareLog,u=!1,c=function(){if(u)return;u=!0,r.statusCode===429&&i.addThrottleFlag();let l=Al.getCauseTypeFromHttpStatus(r.statusCode);l&&(i[l]=!0),i.http.close(r),i.close(),a("Closed middleware segment successfully",e.url,i)};return r.on("finish",c),r.on("close",c),i}};Qs.exports=wl});var Js=d((Lg,zs)=>{"use strict";var Dt=oe(),xl=wr(),xr=O().LambdaUtils,Nl=Ge(),Ol=qt(),Ll=re(),Or=A(),Ys=Ct(),Nr=null;zs.exports.init=function(){Dt.enableManualMode=function(){Or.getLogger().warn("AWS Lambda does not support AWS X-Ray manual mode.")},Ol.disableReusableSocket(),Ll.setStreamingThreshold(0),Or.getLogger().info("Disabling centralized sampling in Lambda environment."),xl.disableCentralizedSampling();var e=Dt.getNamespace();e.enter(e.createContext()),Dt.setSegment(Dl())};var Dl=function(){var e=new Nl("facade"),r=["addNewSubsegment","addSubsegment","removeSubsegment","toString","addSubsegmentWithoutSampling","addNewSubsegmentWithoutSampling"],n=["incrementCounter","decrementCounter","isClosed","close","format","flush"],s=process.env._X_AMZN_TRACE_ID;for(var i in e)typeof e[i]=="function"&&r.indexOf(i)===-1&&(n.indexOf(i)===-1?e[i]=function(){var o=i;return function(){Or.getLogger().warn('Function "'+o+'" cannot be called on an AWS Lambda segment. Please use a subsegment to record data.')}}():e[i]=function(){});return e.trace_id=Ys.Invalid().toString(),e.isClosed=function(){return!0},e.in_progress=!1,e.counter=1,e.notTraced=!0,e.facade=!0,e.reset=function(){this.trace_id=Ys.Invalid().toString(),this.id="00000000",delete this.subsegments,this.notTraced=!0},e.resolveLambdaTraceData=function(){var a=process.env._X_AMZN_TRACE_ID;a?a!=Nr&&(this.reset(),xr.populateTraceData(e,a)&&(Nr=a)):(this.reset(),Dt.contextMissingStrategy.contextMissing("Missing AWS Lambda trace data for X-Ray. Ensure Active Tracing is enabled and no subsegments are created outside the function handler."))},xr.validTraceData(s)&&xr.populateTraceData(e,s)&&(Nr=s),e}});var Zs=d((Dg,$l)=>{$l.exports={name:"aws-xray-sdk-core",version:"3.5.0",description:"AWS X-Ray SDK for Javascript",author:"Amazon Web Services",contributors:["Sandra McMullen <mcmuls@amazon.com>","William Armiros <armiros@amazon.com>","Moritz Onken <onken@netcubed.de>"],files:["dist/lib/**/*","LICENSE","README.md"],main:"dist/lib/index.js",types:"dist/lib/index.d.ts",engines:{node:">= 14.x"},directories:{test:"test"},"//":"@types/cls-hooked is exposed in API so must be in dependencies, not devDependencies",dependencies:{"@aws-sdk/service-error-classification":"^3.4.1","@aws-sdk/types":"^3.4.1","@types/cls-hooked":"^4.3.3","atomic-batcher":"^1.0.2","cls-hooked":"^4.2.2",semver:"^7.3.8"},scripts:{prepare:"npm run compile",compile:"tsc && npm run copy-lib && npm run copy-test","copy-lib":"find lib -type f \\( -name '*.d.ts' -o -name '*.json' \\) | xargs -I % ../../scripts/cp-with-structure.sh % dist","copy-test":"find test -name '*.json' | xargs -I % ../../scripts/cp-with-structure.sh % dist",lint:"eslint .","lint:fix":"eslint . --fix",test:"npm run compile && mocha --recursive ./dist/test/ -R spec && tsd && mocha --recursive ./dist/test_async/ -R spec","test-d":"tsd","test-async":"npm run compile && mocha --recursive ./dist/test_async/ -R spec",clean:"rm -rf dist && rm -rf node_modules",testcov:"nyc npm run test",reportcov:"nyc report --reporter=text-lcov > coverage.lcov && codecov"},keywords:["amazon","api","aws","core","xray","x-ray","x ray"],license:"Apache-2.0",repository:"https://github.com/aws/aws-xray-sdk-node/tree/master/packages/core",gitHead:"0579d9c75e08f8747f9eb87596bea58a7d7e9e25"}});var ri=d(($g,ti)=>{"use strict";var Lr=require("http"),ei={METADATA_TIMEOUT:1e3,getPluginMetadata:function(t,e){var s=5,i=function(){var o=Lr.__request?Lr.__request:Lr.request,a=o(t,function(u){var c="";u.on("data",function(l){c+=l}),u.on("end",function(){if(this.statusCode===200||this.statusCode===300){try{c=JSON.parse(c)}catch(l){e(l);return}e(null,c)}else s>0&&Math.floor(this.statusCode/100)===5?(s--,setTimeout(i,250)):e(new Error(`Failed to retrieve metadata with options: ${t}`))})});a.on("error",function(u){e(u)}),a.on("timeout",function(){a.abort()}),a.setTimeout(ei.METADATA_TIMEOUT),a.end()};i()}};ti.exports=ei});var ai=d((Pg,oi)=>{"use strict";var si=ri(),ni=A(),Dr=require("http"),Pl={getData:function(t){let e="/latest/dynamic/instance-identity/document";function r(n){let s=ii(e,"GET",n?{"X-aws-ec2-metadata-token":n}:{});si.getPluginMetadata(s,function(i,o){if(i||!o){ni.getLogger().error("Error loading EC2 plugin metadata: ",i?i.toString():"Could not retrieve data from IMDS."),t();return}let a={ec2:{instance_id:o.instanceId,availability_zone:o.availabilityZone,instance_size:o.instanceType,ami_id:o.imageId}};t(a)})}kl(function(n){n===null&&ni.getLogger().debug("EC2Plugin failed to get token from IMDSv2. Falling back to IMDSv1."),r(n)})},originName:"AWS::EC2::Instance"};function kl(t){let e=Dr.__request?Dr.__request:Dr.request,s=ii("/latest/api/token","PUT",{"X-aws-ec2-metadata-token-ttl-seconds":60}),i=e(s,function(o){let a="";o.on("data",function(u){a+=u}),o.on("end",function(){this.statusCode===200||this.statusCode===300?t(a):t(null)})});i.on("error",function(){t(null)}),i.on("timeout",function(){i.abort(),t(null)}),i.setTimeout(si.METADATA_TIMEOUT),i.end()}function ii(t,e,r){return e||(e="GET"),r||(r={}),{host:"169.254.169.254",path:t,method:e,headers:r}}oi.exports=Pl});var ci=d((kg,ui)=>{"use strict";var Ml=require("os"),Fl={getData:function(t){t({ecs:{container:Ml.hostname()}})},originName:"AWS::ECS::Container"};ui.exports=Fl});var di=d((Mg,li)=>{"use strict";var Ul=require("fs"),Bl=A(),Wl="/var/elasticbeanstalk/xray/environment.conf",Gl={getData:function(t){Ul.readFile(Wl,"utf8",function(e,r){if(e)Bl.getLogger().error("Error loading Elastic Beanstalk plugin:",e.stack),t();else{var n=JSON.parse(r),s={elastic_beanstalk:{environment:n.environment_name,version_label:n.version_label,deployment_id:n.deployment_id}};t(s)}})},originName:"AWS::ElasticBeanstalk::Environment"};li.exports=Gl});var fi=d((Fg,Xl)=>{Xl.exports={services:{dynamodb:{operations:{batchGetItem:{request_descriptors:{RequestItems:{get_keys:!0,rename_to:"table_names"}},response_parameters:["ConsumedCapacity"]},batchWriteItem:{request_descriptors:{RequestItems:{get_keys:!0,rename_to:"table_names"}},response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},createTable:{request_parameters:["GlobalSecondaryIndexes","LocalSecondaryIndexes","ProvisionedThroughput","TableName"]},deleteItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},deleteTable:{request_parameters:["TableName"]},describeTable:{request_parameters:["TableName"]},getItem:{request_parameters:["ConsistentRead","ProjectionExpression","TableName"],response_parameters:["ConsumedCapacity"]},listTables:{request_parameters:["ExclusiveStartTableName","Limit"],response_descriptors:{TableNames:{list:!0,get_count:!0,rename_to:"table_count"}}},putItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},query:{request_parameters:["AttributesToGet","ConsistentRead","IndexName","Limit","ProjectionExpression","ScanIndexForward","Select","TableName"],response_parameters:["ConsumedCapacity"]},scan:{request_parameters:["AttributesToGet","ConsistentRead","IndexName","Limit","ProjectionExpression","Segment","Select","TableName","TotalSegments"],response_parameters:["ConsumedCapacity","Count","ScannedCount"]},updateItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},updateTable:{request_parameters:["AttributeDefinitions","GlobalSecondaryIndexUpdates","ProvisionedThroughput","TableName"]}}},sqs:{operations:{addPermission:{request_parameters:["Label","QueueUrl"]},changeMessageVisibility:{request_parameters:["QueueUrl","VisibilityTimeout"]},changeMessageVisibilityBatch:{request_parameters:["QueueUrl"],response_parameters:["Failed"]},createQueue:{request_parameters:["Attributes","QueueName"]},deleteMessage:{request_parameters:["QueueUrl"]},deleteMessageBatch:{request_parameters:["QueueUrl"],response_parameters:["Failed"]},deleteQueue:{request_parameters:["QueueUrl"]},getQueueAttributes:{request_parameters:["QueueUrl"],response_parameters:["Attributes"]},getQueueUrl:{request_parameters:["QueueName","QueueOwnerAWSAccountId"],response_parameters:["QueueUrl"]},listDeadLetterSourceQueues:{request_parameters:["QueueUrl"],response_parameters:["QueueUrls"]},listQueues:{request_parameters:["QueueNamePrefix"],response_descriptors:{QueueUrls:{list:!0,get_count:!0,rename_to:"queue_count"}}},purgeQueue:{request_parameters:["QueueUrl"]},receiveMessage:{request_parameters:["AttributeNames","MaxNumberOfMessages","MessageAttributeNames","QueueUrl","VisibilityTimeout","WaitTimeSeconds"],response_descriptors:{Messages:{list:!0,get_count:!0,rename_to:"message_count"}}},removePermission:{request_parameters:["QueueUrl"]},sendMessage:{request_parameters:["DelaySeconds","QueueUrl"],request_descriptors:{MessageAttributes:{get_keys:!0,rename_to:"message_attribute_names"}},response_parameters:["MessageId"]},sendMessageBatch:{request_parameters:["QueueUrl"],request_descriptors:{Entries:{list:!0,get_count:!0,rename_to:"message_count"}},response_descriptors:{Failed:{list:!0,get_count:!0,rename_to:"failed_count"},Successful:{list:!0,get_count:!0,rename_to:"successful_count"}}},setQueueAttributes:{request_parameters:["QueueUrl"],request_descriptors:{Attributes:{get_keys:!0,rename_to:"attribute_names"}}}}},sns:{operations:{publish:{request_parameters:["TopicArn"]},publishBatch:{request_parameters:["TopicArn"]}}},lambda:{operations:{invoke:{request_parameters:["FunctionName","InvocationType","LogType","Qualifier"],response_parameters:["FunctionError","StatusCode"]},invokeAsync:{request_parameters:["FunctionName"],response_parameters:["Status"]}}},s3:{operations:{abortMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},completeMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},copyObject:{request_parameters:["CopySource","Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},createBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},createMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObjects:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAccelerateConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAcl:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLifecycleConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLocation:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLogging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketNotification:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketNotificationConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketRequestPayment:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketVersioning:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectAcl:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectTorrent:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},headBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},headObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketAnalyticsConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketInventoryConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketMetricsConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listMultipartUploads:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjectVersions:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjects:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjectsV2:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listParts:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAccelerateConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAcl:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLifecycleConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLogging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketNotification:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketNotificationConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketRequestPayment:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketVersioning:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObject:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObjectAcl:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},restoreObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},uploadPart:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},uploadPartCopy:{request_parameters:["CopySource","Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}}}},sagemakerruntime:{operations:{invokeEndpoint:{request_parameters:["EndpointName"]}}}}}});var _i=d((Ug,vi)=>{"use strict";var gi=require("fs"),Te=A(),Hl=fi(),$t={REQ_DESC:"request_descriptors",REQ_PARAMS:"request_parameters",RES_DESC:"response_descriptors",RES_PARAMS:"response_parameters"};function kt(t){this.init(t)}kt.prototype.init=function(e){e?typeof e=="string"?(Te.getLogger().info("Using custom AWS whitelist file: "+e),this.services=Pt(JSON.parse(gi.readFileSync(e,"utf8")))):(Te.getLogger().info("Using custom AWS whitelist source."),this.services=Pt(e)):this.services=Hl.services};kt.prototype.append=function(e){var r={};typeof e=="string"?(Te.getLogger().info("Appending AWS whitelist with custom file: "+e),r=Pt(JSON.parse(gi.readFileSync(e,"utf8")))):(Te.getLogger().info("Appending AWS whitelist with a custom source."),r=Pt(e));for(var n in r)this.services[n]=r[n]};kt.prototype.capture=function(e,r){var n=r.request.operation,s=this.services[e]!==void 0?this.services[e].operations[n]:null;if(s===null){Te.getLogger().debug('Call "'+e+"."+n+'" is not whitelisted for additional data capturing. Ignoring.');return}var i={};for(var o in s){var a=s[o];o===$t.REQ_PARAMS?pi(a,r.request.params,i):o===$t.REQ_DESC?hi(a,r.request.params,i):o===$t.RES_PARAMS?r.data&&pi(a,r.data,i):o===$t.RES_DESC?r.data&&hi(a,r.data,i):Te.getLogger().error('Unknown parameter type "'+o+'". Must be "request_descriptors", "response_descriptors", "request_parameters" or "response_parameters".')}return i};function pi(t,e,r){t.forEach(function(n){if(typeof e[n]<"u"){var s=mi(n);this[s]=e[n]}},r)}function hi(t,e,r){for(var n in t){var s=t[n];if(typeof e[n]<"u"){var i;if(s.list&&s.get_count?i=e[n]?e[n].length:0:i=s.get_keys===!0?Object.keys(e[n]):e[n],typeof s.rename_to=="string")r[s.rename_to]=i;else{var o=mi(n);r[o]=i}}}}function mi(t){return t==="IPAddress"?"ip_address":t.split(/(?=[A-Z])/).join("_").toLowerCase()}function Pt(t){var e=t;if(e.services===void 0)throw new Error('Document formatting is incorrect. Expecting "services" param.');return e.services}vi.exports=kt});var Ve=d((Bg,Mt)=>{"use strict";var Ei=_i(),$r=new Ei;function Pr(t,e){this.init(t,e)}Pr.prototype.init=function(e,r){this.operation=Kl(e.request.operation)||"",e&&e.request&&e.request.httpRequest&&e.request.httpRequest.region&&(this.region=e.request.httpRequest.region),e&&e.requestId&&(this.request_id=e.requestId),this.retries=e.retryCount||0,e.extendedRequestId&&r&&r.toLowerCase()==="s3"&&(this.id_2=e.extendedRequestId),r&&this.addData($r.capture(r.toLowerCase(),e))};Pr.prototype.addData=function(e){for(var r in e)this[r]=e[r]};var Vl=function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local whitelist file, or supply a whitelist source object.");$r=new Ei(e)},jl=function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local whitelist file, or supply a whitelist source object.");$r.append(e)};function Kl(t){if(t)return t.charAt(0).toUpperCase()+t.slice(1)}Mt.exports=Pr;Mt.exports.appendAWSWhitelist=jl;Mt.exports.setAWSWhitelist=Vl});var Ut=d((Wg,Ft)=>{"use strict";var de=oe(),je=A(),Si=function(e,r,n){kr(e,r);var s,i,o=de.resolveSegment(n);if(!o)return je.getLogger().warn("Failed to capture function."),r();s=o.addNewSubsegment(e),i=yi(r,s);try{let a=i(s);return s.close(),a}catch(a){throw s.close(a),a}},Ql=function(e,r,n){kr(e,r);var s,i,o=de.resolveSegment(n);if(!o)return je.getLogger().warn("Failed to capture async function."),r();s=o.addNewSubsegment(e),i=yi(r,s);try{return i(s)}catch(a){throw s.close(a),a}},Yl=function(e,r,n){kr(e,r);var s=de.resolveSegment(n);return s?(s.incrementCounter(),function(){var i=de.resolveSegment(n),o=Array.prototype.slice.call(arguments);Si(e,r.bind.apply(r,[null].concat(o)),i),s.decrementCounter()}.bind(this)):(je.getLogger().warn("Failed to capture callback function."),r)};function yi(t,e){var r;if(de.isAutomaticMode()){var n=de.getNamespace(),s=function(){var i;return n.run(function(){de.setSegment(e),i=t(e)}),i};r=s}else r=t;return r}function kr(t,e){var r;if(!t||typeof t!="string")throw r='Param "name" must be a non-empty string.',je.getLogger().error(r),new Error(r);if(typeof e!="function")throw r='Param "fcn" must be a function.',je.getLogger().error(r),new Error(r)}Ft.exports.captureFunc=Si;Ft.exports.captureAsyncFunc=Ql;Ft.exports.captureCallbackFunc=Yl});var Ke=d((Gg,Ti)=>{var zl="2.0.0",Jl=Number.MAX_SAFE_INTEGER||9007199254740991,Zl=16,ed=["major","premajor","minor","preminor","patch","prepatch","prerelease"];Ti.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:Zl,MAX_SAFE_INTEGER:Jl,RELEASE_TYPES:ed,SEMVER_SPEC_VERSION:zl,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var Qe=d((Xg,Ri)=>{var td=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{};Ri.exports=td});var Re=d((ae,bi)=>{var{MAX_SAFE_COMPONENT_LENGTH:Mr}=Ke(),rd=Qe();ae=bi.exports={};var nd=ae.re=[],h=ae.src=[],g=ae.t={},sd=0,v=(t,e,r)=>{let n=sd++;rd(t,n,e),g[t]=n,h[n]=e,nd[n]=new RegExp(e,r?"g":void 0)};v("NUMERICIDENTIFIER","0|[1-9]\\d*");v("NUMERICIDENTIFIERLOOSE","[0-9]+");v("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*");v("MAINVERSION",`(${h[g.NUMERICIDENTIFIER]})\\.(${h[g.NUMERICIDENTIFIER]})\\.(${h[g.NUMERICIDENTIFIER]})`);v("MAINVERSIONLOOSE",`(${h[g.NUMERICIDENTIFIERLOOSE]})\\.(${h[g.NUMERICIDENTIFIERLOOSE]})\\.(${h[g.NUMERICIDENTIFIERLOOSE]})`);v("PRERELEASEIDENTIFIER",`(?:${h[g.NUMERICIDENTIFIER]}|${h[g.NONNUMERICIDENTIFIER]})`);v("PRERELEASEIDENTIFIERLOOSE",`(?:${h[g.NUMERICIDENTIFIERLOOSE]}|${h[g.NONNUMERICIDENTIFIER]})`);v("PRERELEASE",`(?:-(${h[g.PRERELEASEIDENTIFIER]}(?:\\.${h[g.PRERELEASEIDENTIFIER]})*))`);v("PRERELEASELOOSE",`(?:-?(${h[g.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${h[g.PRERELEASEIDENTIFIERLOOSE]})*))`);v("BUILDIDENTIFIER","[0-9A-Za-z-]+");v("BUILD",`(?:\\+(${h[g.BUILDIDENTIFIER]}(?:\\.${h[g.BUILDIDENTIFIER]})*))`);v("FULLPLAIN",`v?${h[g.MAINVERSION]}${h[g.PRERELEASE]}?${h[g.BUILD]}?`);v("FULL",`^${h[g.FULLPLAIN]}$`);v("LOOSEPLAIN",`[v=\\s]*${h[g.MAINVERSIONLOOSE]}${h[g.PRERELEASELOOSE]}?${h[g.BUILD]}?`);v("LOOSE",`^${h[g.LOOSEPLAIN]}$`);v("GTLT","((?:<|>)?=?)");v("XRANGEIDENTIFIERLOOSE",`${h[g.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);v("XRANGEIDENTIFIER",`${h[g.NUMERICIDENTIFIER]}|x|X|\\*`);v("XRANGEPLAIN",`[v=\\s]*(${h[g.XRANGEIDENTIFIER]})(?:\\.(${h[g.XRANGEIDENTIFIER]})(?:\\.(${h[g.XRANGEIDENTIFIER]})(?:${h[g.PRERELEASE]})?${h[g.BUILD]}?)?)?`);v("XRANGEPLAINLOOSE",`[v=\\s]*(${h[g.XRANGEIDENTIFIERLOOSE]})(?:\\.(${h[g.XRANGEIDENTIFIERLOOSE]})(?:\\.(${h[g.XRANGEIDENTIFIERLOOSE]})(?:${h[g.PRERELEASELOOSE]})?${h[g.BUILD]}?)?)?`);v("XRANGE",`^${h[g.GTLT]}\\s*${h[g.XRANGEPLAIN]}$`);v("XRANGELOOSE",`^${h[g.GTLT]}\\s*${h[g.XRANGEPLAINLOOSE]}$`);v("COERCE",`(^|[^\\d])(\\d{1,${Mr}})(?:\\.(\\d{1,${Mr}}))?(?:\\.(\\d{1,${Mr}}))?(?:$|[^\\d])`);v("COERCERTL",h[g.COERCE],!0);v("LONETILDE","(?:~>?)");v("TILDETRIM",`(\\s*)${h[g.LONETILDE]}\\s+`,!0);ae.tildeTrimReplace="$1~";v("TILDE",`^${h[g.LONETILDE]}${h[g.XRANGEPLAIN]}$`);v("TILDELOOSE",`^${h[g.LONETILDE]}${h[g.XRANGEPLAINLOOSE]}$`);v("LONECARET","(?:\\^)");v("CARETTRIM",`(\\s*)${h[g.LONECARET]}\\s+`,!0);ae.caretTrimReplace="$1^";v("CARET",`^${h[g.LONECARET]}${h[g.XRANGEPLAIN]}$`);v("CARETLOOSE",`^${h[g.LONECARET]}${h[g.XRANGEPLAINLOOSE]}$`);v("COMPARATORLOOSE",`^${h[g.GTLT]}\\s*(${h[g.LOOSEPLAIN]})$|^$`);v("COMPARATOR",`^${h[g.GTLT]}\\s*(${h[g.FULLPLAIN]})$|^$`);v("COMPARATORTRIM",`(\\s*)${h[g.GTLT]}\\s*(${h[g.LOOSEPLAIN]}|${h[g.XRANGEPLAIN]})`,!0);ae.comparatorTrimReplace="$1$2$3";v("HYPHENRANGE",`^\\s*(${h[g.XRANGEPLAIN]})\\s+-\\s+(${h[g.XRANGEPLAIN]})\\s*$`);v("HYPHENRANGELOOSE",`^\\s*(${h[g.XRANGEPLAINLOOSE]})\\s+-\\s+(${h[g.XRANGEPLAINLOOSE]})\\s*$`);v("STAR","(<|>)?=?\\s*\\*");v("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");v("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var Bt=d((Hg,Ai)=>{var id=Object.freeze({loose:!0}),od=Object.freeze({}),ad=t=>t?typeof t!="object"?id:t:od;Ai.exports=ad});var Fr=d((Vg,Ci)=>{var qi=/^[0-9]+$/,Ii=(t,e)=>{let r=qi.test(t),n=qi.test(e);return r&&n&&(t=+t,e=+e),t===e?0:r&&!n?-1:n&&!r?1:t<e?-1:1},ud=(t,e)=>Ii(e,t);Ci.exports={compareIdentifiers:Ii,rcompareIdentifiers:ud}});var D=d((jg,Oi)=>{var Wt=Qe(),{MAX_LENGTH:wi,MAX_SAFE_INTEGER:Gt}=Ke(),{re:xi,t:Ni}=Re(),cd=Bt(),{compareIdentifiers:be}=Fr(),U=class{constructor(e,r){if(r=cd(r),e instanceof U){if(e.loose===!!r.loose&&e.includePrerelease===!!r.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>wi)throw new TypeError(`version is longer than ${wi} characters`);Wt("SemVer",e,r),this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease;let n=e.trim().match(r.loose?xi[Ni.LOOSE]:xi[Ni.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>Gt||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Gt||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Gt||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(s=>{if(/^[0-9]+$/.test(s)){let i=+s;if(i>=0&&i<Gt)return i}return s}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Wt("SemVer.compare",this.version,this.options,e),!(e instanceof U)){if(typeof e=="string"&&e===this.version)return 0;e=new U(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof U||(e=new U(e,this.options)),be(this.major,e.major)||be(this.minor,e.minor)||be(this.patch,e.patch)}comparePre(e){if(e instanceof U||(e=new U(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let r=0;do{let n=this.prerelease[r],s=e.prerelease[r];if(Wt("prerelease compare",r,n,s),n===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(n===void 0)return-1;if(n===s)continue;return be(n,s)}while(++r)}compareBuild(e){e instanceof U||(e=new U(e,this.options));let r=0;do{let n=this.build[r],s=e.build[r];if(Wt("prerelease compare",r,n,s),n===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(n===void 0)return-1;if(n===s)continue;return be(n,s)}while(++r)}inc(e,r,n){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",r,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",r,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",r,n),this.inc("pre",r,n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",r,n),this.inc("pre",r,n);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let s=Number(n)?1:0;if(!r&&n===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[s];else{let i=this.prerelease.length;for(;--i>=0;)typeof this.prerelease[i]=="number"&&(this.prerelease[i]++,i=-2);if(i===-1){if(r===this.prerelease.join(".")&&n===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(s)}}if(r){let i=[r,s];n===!1&&(i=[r]),be(this.prerelease[0],r)===0?isNaN(this.prerelease[1])&&(this.prerelease=i):this.prerelease=i}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.format(),this.raw=this.version,this}};Oi.exports=U});var fe=d((Kg,Di)=>{var Li=D(),ld=(t,e,r=!1)=>{if(t instanceof Li)return t;try{return new Li(t,e)}catch(n){if(!r)return null;throw n}};Di.exports=ld});var Pi=d((Qg,$i)=>{var dd=fe(),fd=(t,e)=>{let r=dd(t,e);return r?r.version:null};$i.exports=fd});var Mi=d((Yg,ki)=>{var pd=fe(),hd=(t,e)=>{let r=pd(t.trim().replace(/^[=v]+/,""),e);return r?r.version:null};ki.exports=hd});var Bi=d((zg,Ui)=>{var Fi=D(),gd=(t,e,r,n,s)=>{typeof r=="string"&&(s=n,n=r,r=void 0);try{return new Fi(t instanceof Fi?t.version:t,r).inc(e,n,s).version}catch{return null}};Ui.exports=gd});var Xi=d((Jg,Gi)=>{var Wi=fe(),md=(t,e)=>{let r=Wi(t,null,!0),n=Wi(e,null,!0),s=r.compare(n);if(s===0)return null;let i=s>0,o=i?r:n,a=i?n:r,u=!!o.prerelease.length,c=u?"pre":"";return r.major!==n.major?c+"major":r.minor!==n.minor?c+"minor":r.patch!==n.patch?c+"patch":u?"prerelease":a.patch?"patch":a.minor?"minor":"major"};Gi.exports=md});var Vi=d((Zg,Hi)=>{var vd=D(),_d=(t,e)=>new vd(t,e).major;Hi.exports=_d});var Ki=d((em,ji)=>{var Ed=D(),Sd=(t,e)=>new Ed(t,e).minor;ji.exports=Sd});var Yi=d((tm,Qi)=>{var yd=D(),Td=(t,e)=>new yd(t,e).patch;Qi.exports=Td});var Ji=d((rm,zi)=>{var Rd=fe(),bd=(t,e)=>{let r=Rd(t,e);return r&&r.prerelease.length?r.prerelease:null};zi.exports=bd});var G=d((nm,eo)=>{var Zi=D(),Ad=(t,e,r)=>new Zi(t,r).compare(new Zi(e,r));eo.exports=Ad});var ro=d((sm,to)=>{var qd=G(),Id=(t,e,r)=>qd(e,t,r);to.exports=Id});var so=d((im,no)=>{var Cd=G(),wd=(t,e)=>Cd(t,e,!0);no.exports=wd});var Xt=d((om,oo)=>{var io=D(),xd=(t,e,r)=>{let n=new io(t,r),s=new io(e,r);return n.compare(s)||n.compareBuild(s)};oo.exports=xd});var uo=d((am,ao)=>{var Nd=Xt(),Od=(t,e)=>t.sort((r,n)=>Nd(r,n,e));ao.exports=Od});var lo=d((um,co)=>{var Ld=Xt(),Dd=(t,e)=>t.sort((r,n)=>Ld(n,r,e));co.exports=Dd});var Ye=d((cm,fo)=>{var $d=G(),Pd=(t,e,r)=>$d(t,e,r)>0;fo.exports=Pd});var Ht=d((lm,po)=>{var kd=G(),Md=(t,e,r)=>kd(t,e,r)<0;po.exports=Md});var Ur=d((dm,ho)=>{var Fd=G(),Ud=(t,e,r)=>Fd(t,e,r)===0;ho.exports=Ud});var Br=d((fm,go)=>{var Bd=G(),Wd=(t,e,r)=>Bd(t,e,r)!==0;go.exports=Wd});var Vt=d((pm,mo)=>{var Gd=G(),Xd=(t,e,r)=>Gd(t,e,r)>=0;mo.exports=Xd});var jt=d((hm,vo)=>{var Hd=G(),Vd=(t,e,r)=>Hd(t,e,r)<=0;vo.exports=Vd});var Wr=d((gm,_o)=>{var jd=Ur(),Kd=Br(),Qd=Ye(),Yd=Vt(),zd=Ht(),Jd=jt(),Zd=(t,e,r,n)=>{switch(e){case"===":return typeof t=="object"&&(t=t.version),typeof r=="object"&&(r=r.version),t===r;case"!==":return typeof t=="object"&&(t=t.version),typeof r=="object"&&(r=r.version),t!==r;case"":case"=":case"==":return jd(t,r,n);case"!=":return Kd(t,r,n);case">":return Qd(t,r,n);case">=":return Yd(t,r,n);case"<":return zd(t,r,n);case"<=":return Jd(t,r,n);default:throw new TypeError(`Invalid operator: ${e}`)}};_o.exports=Zd});var So=d((mm,Eo)=>{var ef=D(),tf=fe(),{re:Kt,t:Qt}=Re(),rf=(t,e)=>{if(t instanceof ef)return t;if(typeof t=="number"&&(t=String(t)),typeof t!="string")return null;e=e||{};let r=null;if(!e.rtl)r=t.match(Kt[Qt.COERCE]);else{let n;for(;(n=Kt[Qt.COERCERTL].exec(t))&&(!r||r.index+r[0].length!==t.length);)(!r||n.index+n[0].length!==r.index+r[0].length)&&(r=n),Kt[Qt.COERCERTL].lastIndex=n.index+n[1].length+n[2].length;Kt[Qt.COERCERTL].lastIndex=-1}return r===null?null:tf(`${r[2]}.${r[3]||"0"}.${r[4]||"0"}`,e)};Eo.exports=rf});var To=d((vm,yo)=>{"use strict";yo.exports=function(t){t.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}});var bo=d((_m,Ro)=>{"use strict";Ro.exports=_;_.Node=pe;_.create=_;function _(t){var e=this;if(e instanceof _||(e=new _),e.tail=null,e.head=null,e.length=0,t&&typeof t.forEach=="function")t.forEach(function(s){e.push(s)});else if(arguments.length>0)for(var r=0,n=arguments.length;r<n;r++)e.push(arguments[r]);return e}_.prototype.removeNode=function(t){if(t.list!==this)throw new Error("removing node which does not belong to this list");var e=t.next,r=t.prev;return e&&(e.prev=r),r&&(r.next=e),t===this.head&&(this.head=e),t===this.tail&&(this.tail=r),t.list.length--,t.next=null,t.prev=null,t.list=null,e};_.prototype.unshiftNode=function(t){if(t!==this.head){t.list&&t.list.removeNode(t);var e=this.head;t.list=this,t.next=e,e&&(e.prev=t),this.head=t,this.tail||(this.tail=t),this.length++}};_.prototype.pushNode=function(t){if(t!==this.tail){t.list&&t.list.removeNode(t);var e=this.tail;t.list=this,t.prev=e,e&&(e.next=t),this.tail=t,this.head||(this.head=t),this.length++}};_.prototype.push=function(){for(var t=0,e=arguments.length;t<e;t++)sf(this,arguments[t]);return this.length};_.prototype.unshift=function(){for(var t=0,e=arguments.length;t<e;t++)of(this,arguments[t]);return this.length};_.prototype.pop=function(){if(this.tail){var t=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,t}};_.prototype.shift=function(){if(this.head){var t=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,t}};_.prototype.forEach=function(t,e){e=e||this;for(var r=this.head,n=0;r!==null;n++)t.call(e,r.value,n,this),r=r.next};_.prototype.forEachReverse=function(t,e){e=e||this;for(var r=this.tail,n=this.length-1;r!==null;n--)t.call(e,r.value,n,this),r=r.prev};_.prototype.get=function(t){for(var e=0,r=this.head;r!==null&&e<t;e++)r=r.next;if(e===t&&r!==null)return r.value};_.prototype.getReverse=function(t){for(var e=0,r=this.tail;r!==null&&e<t;e++)r=r.prev;if(e===t&&r!==null)return r.value};_.prototype.map=function(t,e){e=e||this;for(var r=new _,n=this.head;n!==null;)r.push(t.call(e,n.value,this)),n=n.next;return r};_.prototype.mapReverse=function(t,e){e=e||this;for(var r=new _,n=this.tail;n!==null;)r.push(t.call(e,n.value,this)),n=n.prev;return r};_.prototype.reduce=function(t,e){var r,n=this.head;if(arguments.length>1)r=e;else if(this.head)n=this.head.next,r=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var s=0;n!==null;s++)r=t(r,n.value,s),n=n.next;return r};_.prototype.reduceReverse=function(t,e){var r,n=this.tail;if(arguments.length>1)r=e;else if(this.tail)n=this.tail.prev,r=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var s=this.length-1;n!==null;s--)r=t(r,n.value,s),n=n.prev;return r};_.prototype.toArray=function(){for(var t=new Array(this.length),e=0,r=this.head;r!==null;e++)t[e]=r.value,r=r.next;return t};_.prototype.toArrayReverse=function(){for(var t=new Array(this.length),e=0,r=this.tail;r!==null;e++)t[e]=r.value,r=r.prev;return t};_.prototype.slice=function(t,e){e=e||this.length,e<0&&(e+=this.length),t=t||0,t<0&&(t+=this.length);var r=new _;if(e<t||e<0)return r;t<0&&(t=0),e>this.length&&(e=this.length);for(var n=0,s=this.head;s!==null&&n<t;n++)s=s.next;for(;s!==null&&n<e;n++,s=s.next)r.push(s.value);return r};_.prototype.sliceReverse=function(t,e){e=e||this.length,e<0&&(e+=this.length),t=t||0,t<0&&(t+=this.length);var r=new _;if(e<t||e<0)return r;t<0&&(t=0),e>this.length&&(e=this.length);for(var n=this.length,s=this.tail;s!==null&&n>e;n--)s=s.prev;for(;s!==null&&n>t;n--,s=s.prev)r.push(s.value);return r};_.prototype.splice=function(t,e,...r){t>this.length&&(t=this.length-1),t<0&&(t=this.length+t);for(var n=0,s=this.head;s!==null&&n<t;n++)s=s.next;for(var i=[],n=0;s&&n<e;n++)i.push(s.value),s=this.removeNode(s);s===null&&(s=this.tail),s!==this.head&&s!==this.tail&&(s=s.prev);for(var n=0;n<r.length;n++)s=nf(this,s,r[n]);return i};_.prototype.reverse=function(){for(var t=this.head,e=this.tail,r=t;r!==null;r=r.prev){var n=r.prev;r.prev=r.next,r.next=n}return this.head=e,this.tail=t,this};function nf(t,e,r){var n=e===t.head?new pe(r,null,e,t):new pe(r,e,e.next,t);return n.next===null&&(t.tail=n),n.prev===null&&(t.head=n),t.length++,n}function sf(t,e){t.tail=new pe(e,t.tail,null,t),t.head||(t.head=t.tail),t.length++}function of(t,e){t.head=new pe(e,null,t.head,t),t.tail||(t.tail=t.head),t.length++}function pe(t,e,r,n){if(!(this instanceof pe))return new pe(t,e,r,n);this.list=n,this.value=t,e?(e.next=this,this.prev=e):this.prev=null,r?(r.prev=this,this.next=r):this.next=null}try{To()(_)}catch{}});var wo=d((Em,Co)=>{"use strict";var af=bo(),he=Symbol("max"),ee=Symbol("length"),Ae=Symbol("lengthCalculator"),Je=Symbol("allowStale"),ge=Symbol("maxAge"),Z=Symbol("dispose"),Ao=Symbol("noDisposeOnSet"),N=Symbol("lruList"),K=Symbol("cache"),Io=Symbol("updateAgeOnGet"),Gr=()=>1,Hr=class{constructor(e){if(typeof e=="number"&&(e={max:e}),e||(e={}),e.max&&(typeof e.max!="number"||e.max<0))throw new TypeError("max must be a non-negative number");let r=this[he]=e.max||1/0,n=e.length||Gr;if(this[Ae]=typeof n!="function"?Gr:n,this[Je]=e.stale||!1,e.maxAge&&typeof e.maxAge!="number")throw new TypeError("maxAge must be a number");this[ge]=e.maxAge||0,this[Z]=e.dispose,this[Ao]=e.noDisposeOnSet||!1,this[Io]=e.updateAgeOnGet||!1,this.reset()}set max(e){if(typeof e!="number"||e<0)throw new TypeError("max must be a non-negative number");this[he]=e||1/0,ze(this)}get max(){return this[he]}set allowStale(e){this[Je]=!!e}get allowStale(){return this[Je]}set maxAge(e){if(typeof e!="number")throw new TypeError("maxAge must be a non-negative number");this[ge]=e,ze(this)}get maxAge(){return this[ge]}set lengthCalculator(e){typeof e!="function"&&(e=Gr),e!==this[Ae]&&(this[Ae]=e,this[ee]=0,this[N].forEach(r=>{r.length=this[Ae](r.value,r.key),this[ee]+=r.length})),ze(this)}get lengthCalculator(){return this[Ae]}get length(){return this[ee]}get itemCount(){return this[N].length}rforEach(e,r){r=r||this;for(let n=this[N].tail;n!==null;){let s=n.prev;qo(this,e,n,r),n=s}}forEach(e,r){r=r||this;for(let n=this[N].head;n!==null;){let s=n.next;qo(this,e,n,r),n=s}}keys(){return this[N].toArray().map(e=>e.key)}values(){return this[N].toArray().map(e=>e.value)}reset(){this[Z]&&this[N]&&this[N].length&&this[N].forEach(e=>this[Z](e.key,e.value)),this[K]=new Map,this[N]=new af,this[ee]=0}dump(){return this[N].map(e=>Yt(this,e)?!1:{k:e.key,v:e.value,e:e.now+(e.maxAge||0)}).toArray().filter(e=>e)}dumpLru(){return this[N]}set(e,r,n){if(n=n||this[ge],n&&typeof n!="number")throw new TypeError("maxAge must be a number");let s=n?Date.now():0,i=this[Ae](r,e);if(this[K].has(e)){if(i>this[he])return qe(this,this[K].get(e)),!1;let u=this[K].get(e).value;return this[Z]&&(this[Ao]||this[Z](e,u.value)),u.now=s,u.maxAge=n,u.value=r,this[ee]+=i-u.length,u.length=i,this.get(e),ze(this),!0}let o=new Vr(e,r,i,s,n);return o.length>this[he]?(this[Z]&&this[Z](e,r),!1):(this[ee]+=o.length,this[N].unshift(o),this[K].set(e,this[N].head),ze(this),!0)}has(e){if(!this[K].has(e))return!1;let r=this[K].get(e).value;return!Yt(this,r)}get(e){return Xr(this,e,!0)}peek(e){return Xr(this,e,!1)}pop(){let e=this[N].tail;return e?(qe(this,e),e.value):null}del(e){qe(this,this[K].get(e))}load(e){this.reset();let r=Date.now();for(let n=e.length-1;n>=0;n--){let s=e[n],i=s.e||0;if(i===0)this.set(s.k,s.v);else{let o=i-r;o>0&&this.set(s.k,s.v,o)}}}prune(){this[K].forEach((e,r)=>Xr(this,r,!1))}},Xr=(t,e,r)=>{let n=t[K].get(e);if(n){let s=n.value;if(Yt(t,s)){if(qe(t,n),!t[Je])return}else r&&(t[Io]&&(n.value.now=Date.now()),t[N].unshiftNode(n));return s.value}},Yt=(t,e)=>{if(!e||!e.maxAge&&!t[ge])return!1;let r=Date.now()-e.now;return e.maxAge?r>e.maxAge:t[ge]&&r>t[ge]},ze=t=>{if(t[ee]>t[he])for(let e=t[N].tail;t[ee]>t[he]&&e!==null;){let r=e.prev;qe(t,e),e=r}},qe=(t,e)=>{if(e){let r=e.value;t[Z]&&t[Z](r.key,r.value),t[ee]-=r.length,t[K].delete(r.key),t[N].removeNode(e)}},Vr=class{constructor(e,r,n,s,i){this.key=e,this.value=r,this.length=n,this.now=s,this.maxAge=i||0}},qo=(t,e,r,n)=>{let s=r.value;Yt(t,s)&&(qe(t,r),t[Je]||(s=void 0)),s&&e.call(n,s.value,s.key,t)};Co.exports=Hr});var X=d((Sm,Lo)=>{var me=class{constructor(e,r){if(r=cf(r),e instanceof me)return e.loose===!!r.loose&&e.includePrerelease===!!r.includePrerelease?e:new me(e.raw,r);if(e instanceof jr)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease,this.raw=e,this.set=e.split("||").map(n=>this.parseRange(n.trim())).filter(n=>n.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${e}`);if(this.set.length>1){let n=this.set[0];if(this.set=this.set.filter(s=>!No(s[0])),this.set.length===0)this.set=[n];else if(this.set.length>1){for(let s of this.set)if(s.length===1&&mf(s[0])){this.set=[s];break}}}this.format()}format(){return this.range=this.set.map(e=>e.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(e){e=e.trim();let n=((this.options.includePrerelease&&hf)|(this.options.loose&&gf))+":"+e,s=xo.get(n);if(s)return s;let i=this.options.loose,o=i?F[P.HYPHENRANGELOOSE]:F[P.HYPHENRANGE];e=e.replace(o,qf(this.options.includePrerelease)),I("hyphen replace",e),e=e.replace(F[P.COMPARATORTRIM],df),I("comparator trim",e),e=e.replace(F[P.TILDETRIM],ff),e=e.replace(F[P.CARETTRIM],pf),e=e.split(/\s+/).join(" ");let a=e.split(" ").map(f=>vf(f,this.options)).join(" ").split(/\s+/).map(f=>Af(f,this.options));i&&(a=a.filter(f=>(I("loose invalid filter",f,this.options),!!f.match(F[P.COMPARATORLOOSE])))),I("range list",a);let u=new Map,c=a.map(f=>new jr(f,this.options));for(let f of c){if(No(f))return[f];u.set(f.value,f)}u.size>1&&u.has("")&&u.delete("");let l=[...u.values()];return xo.set(n,l),l}intersects(e,r){if(!(e instanceof me))throw new TypeError("a Range is required");return this.set.some(n=>Oo(n,r)&&e.set.some(s=>Oo(s,r)&&n.every(i=>s.every(o=>i.intersects(o,r)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new lf(e,this.options)}catch{return!1}for(let r=0;r<this.set.length;r++)if(If(this.set[r],e,this.options))return!0;return!1}};Lo.exports=me;var uf=wo(),xo=new uf({max:1e3}),cf=Bt(),jr=Ze(),I=Qe(),lf=D(),{re:F,t:P,comparatorTrimReplace:df,tildeTrimReplace:ff,caretTrimReplace:pf}=Re(),{FLAG_INCLUDE_PRERELEASE:hf,FLAG_LOOSE:gf}=Ke(),No=t=>t.value==="<0.0.0-0",mf=t=>t.value==="",Oo=(t,e)=>{let r=!0,n=t.slice(),s=n.pop();for(;r&&n.length;)r=n.every(i=>s.intersects(i,e)),s=n.pop();return r},vf=(t,e)=>(I("comp",t,e),t=Sf(t,e),I("caret",t),t=_f(t,e),I("tildes",t),t=Tf(t,e),I("xrange",t),t=bf(t,e),I("stars",t),t),k=t=>!t||t.toLowerCase()==="x"||t==="*",_f=(t,e)=>t.trim().split(/\s+/).map(r=>Ef(r,e)).join(" "),Ef=(t,e)=>{let r=e.loose?F[P.TILDELOOSE]:F[P.TILDE];return t.replace(r,(n,s,i,o,a)=>{I("tilde",t,n,s,i,o,a);let u;return k(s)?u="":k(i)?u=`>=${s}.0.0 <${+s+1}.0.0-0`:k(o)?u=`>=${s}.${i}.0 <${s}.${+i+1}.0-0`:a?(I("replaceTilde pr",a),u=`>=${s}.${i}.${o}-${a} <${s}.${+i+1}.0-0`):u=`>=${s}.${i}.${o} <${s}.${+i+1}.0-0`,I("tilde return",u),u})},Sf=(t,e)=>t.trim().split(/\s+/).map(r=>yf(r,e)).join(" "),yf=(t,e)=>{I("caret",t,e);let r=e.loose?F[P.CARETLOOSE]:F[P.CARET],n=e.includePrerelease?"-0":"";return t.replace(r,(s,i,o,a,u)=>{I("caret",t,s,i,o,a,u);let c;return k(i)?c="":k(o)?c=`>=${i}.0.0${n} <${+i+1}.0.0-0`:k(a)?i==="0"?c=`>=${i}.${o}.0${n} <${i}.${+o+1}.0-0`:c=`>=${i}.${o}.0${n} <${+i+1}.0.0-0`:u?(I("replaceCaret pr",u),i==="0"?o==="0"?c=`>=${i}.${o}.${a}-${u} <${i}.${o}.${+a+1}-0`:c=`>=${i}.${o}.${a}-${u} <${i}.${+o+1}.0-0`:c=`>=${i}.${o}.${a}-${u} <${+i+1}.0.0-0`):(I("no pr"),i==="0"?o==="0"?c=`>=${i}.${o}.${a}${n} <${i}.${o}.${+a+1}-0`:c=`>=${i}.${o}.${a}${n} <${i}.${+o+1}.0-0`:c=`>=${i}.${o}.${a} <${+i+1}.0.0-0`),I("caret return",c),c})},Tf=(t,e)=>(I("replaceXRanges",t,e),t.split(/\s+/).map(r=>Rf(r,e)).join(" ")),Rf=(t,e)=>{t=t.trim();let r=e.loose?F[P.XRANGELOOSE]:F[P.XRANGE];return t.replace(r,(n,s,i,o,a,u)=>{I("xRange",t,n,s,i,o,a,u);let c=k(i),l=c||k(o),f=l||k(a),m=f;return s==="="&&m&&(s=""),u=e.includePrerelease?"-0":"",c?s===">"||s==="<"?n="<0.0.0-0":n="*":s&&m?(l&&(o=0),a=0,s===">"?(s=">=",l?(i=+i+1,o=0,a=0):(o=+o+1,a=0)):s==="<="&&(s="<",l?i=+i+1:o=+o+1),s==="<"&&(u="-0"),n=`${s+i}.${o}.${a}${u}`):l?n=`>=${i}.0.0${u} <${+i+1}.0.0-0`:f&&(n=`>=${i}.${o}.0${u} <${i}.${+o+1}.0-0`),I("xRange return",n),n})},bf=(t,e)=>(I("replaceStars",t,e),t.trim().replace(F[P.STAR],"")),Af=(t,e)=>(I("replaceGTE0",t,e),t.trim().replace(F[e.includePrerelease?P.GTE0PRE:P.GTE0],"")),qf=t=>(e,r,n,s,i,o,a,u,c,l,f,m,p)=>(k(n)?r="":k(s)?r=`>=${n}.0.0${t?"-0":""}`:k(i)?r=`>=${n}.${s}.0${t?"-0":""}`:o?r=`>=${r}`:r=`>=${r}${t?"-0":""}`,k(c)?u="":k(l)?u=`<${+c+1}.0.0-0`:k(f)?u=`<${c}.${+l+1}.0-0`:m?u=`<=${c}.${l}.${f}-${m}`:t?u=`<${c}.${l}.${+f+1}-0`:u=`<=${u}`,`${r} ${u}`.trim()),If=(t,e,r)=>{for(let n=0;n<t.length;n++)if(!t[n].test(e))return!1;if(e.prerelease.length&&!r.includePrerelease){for(let n=0;n<t.length;n++)if(I(t[n].semver),t[n].semver!==jr.ANY&&t[n].semver.prerelease.length>0){let s=t[n].semver;if(s.major===e.major&&s.minor===e.minor&&s.patch===e.patch)return!0}return!1}return!0}});var Ze=d((ym,Fo)=>{var et=Symbol("SemVer ANY"),Ie=class{static get ANY(){return et}constructor(e,r){if(r=Do(r),e instanceof Ie){if(e.loose===!!r.loose)return e;e=e.value}Qr("comparator",e,r),this.options=r,this.loose=!!r.loose,this.parse(e),this.semver===et?this.value="":this.value=this.operator+this.semver.version,Qr("comp",this)}parse(e){let r=this.options.loose?$o[Po.COMPARATORLOOSE]:$o[Po.COMPARATOR],n=e.match(r);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=n[1]!==void 0?n[1]:"",this.operator==="="&&(this.operator=""),n[2]?this.semver=new ko(n[2],this.options.loose):this.semver=et}toString(){return this.value}test(e){if(Qr("Comparator.test",e,this.options.loose),this.semver===et||e===et)return!0;if(typeof e=="string")try{e=new ko(e,this.options)}catch{return!1}return Kr(e,this.operator,this.semver,this.options)}intersects(e,r){if(!(e instanceof Ie))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new Mo(e.value,r).test(this.value):e.operator===""?e.value===""?!0:new Mo(this.value,r).test(e.semver):(r=Do(r),r.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!r.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||Kr(this.semver,"<",e.semver,r)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||Kr(this.semver,">",e.semver,r)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};Fo.exports=Ie;var Do=Bt(),{re:$o,t:Po}=Re(),Kr=Wr(),Qr=Qe(),ko=D(),Mo=X()});var tt=d((Tm,Uo)=>{var Cf=X(),wf=(t,e,r)=>{try{e=new Cf(e,r)}catch{return!1}return e.test(t)};Uo.exports=wf});var Wo=d((Rm,Bo)=>{var xf=X(),Nf=(t,e)=>new xf(t,e).set.map(r=>r.map(n=>n.value).join(" ").trim().split(" "));Bo.exports=Nf});var Xo=d((bm,Go)=>{var Of=D(),Lf=X(),Df=(t,e,r)=>{let n=null,s=null,i=null;try{i=new Lf(e,r)}catch{return null}return t.forEach(o=>{i.test(o)&&(!n||s.compare(o)===-1)&&(n=o,s=new Of(n,r))}),n};Go.exports=Df});var Vo=d((Am,Ho)=>{var $f=D(),Pf=X(),kf=(t,e,r)=>{let n=null,s=null,i=null;try{i=new Pf(e,r)}catch{return null}return t.forEach(o=>{i.test(o)&&(!n||s.compare(o)===1)&&(n=o,s=new $f(n,r))}),n};Ho.exports=kf});var Qo=d((qm,Ko)=>{var Yr=D(),Mf=X(),jo=Ye(),Ff=(t,e)=>{t=new Mf(t,e);let r=new Yr("0.0.0");if(t.test(r)||(r=new Yr("0.0.0-0"),t.test(r)))return r;r=null;for(let n=0;n<t.set.length;++n){let s=t.set[n],i=null;s.forEach(o=>{let a=new Yr(o.semver.version);switch(o.operator){case">":a.prerelease.length===0?a.patch++:a.prerelease.push(0),a.raw=a.format();case"":case">=":(!i||jo(a,i))&&(i=a);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${o.operator}`)}}),i&&(!r||jo(r,i))&&(r=i)}return r&&t.test(r)?r:null};Ko.exports=Ff});var zo=d((Im,Yo)=>{var Uf=X(),Bf=(t,e)=>{try{return new Uf(t,e).range||"*"}catch{return null}};Yo.exports=Bf});var zt=d((Cm,ta)=>{var Wf=D(),ea=Ze(),{ANY:Gf}=ea,Xf=X(),Hf=tt(),Jo=Ye(),Zo=Ht(),Vf=jt(),jf=Vt(),Kf=(t,e,r,n)=>{t=new Wf(t,n),e=new Xf(e,n);let s,i,o,a,u;switch(r){case">":s=Jo,i=Vf,o=Zo,a=">",u=">=";break;case"<":s=Zo,i=jf,o=Jo,a="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Hf(t,e,n))return!1;for(let c=0;c<e.set.length;++c){let l=e.set[c],f=null,m=null;if(l.forEach(p=>{p.semver===Gf&&(p=new ea(">=0.0.0")),f=f||p,m=m||p,s(p.semver,f.semver,n)?f=p:o(p.semver,m.semver,n)&&(m=p)}),f.operator===a||f.operator===u||(!m.operator||m.operator===a)&&i(t,m.semver))return!1;if(m.operator===u&&o(t,m.semver))return!1}return!0};ta.exports=Kf});var na=d((wm,ra)=>{var Qf=zt(),Yf=(t,e,r)=>Qf(t,e,">",r);ra.exports=Yf});var ia=d((xm,sa)=>{var zf=zt(),Jf=(t,e,r)=>zf(t,e,"<",r);sa.exports=Jf});var ua=d((Nm,aa)=>{var oa=X(),Zf=(t,e,r)=>(t=new oa(t,r),e=new oa(e,r),t.intersects(e,r));aa.exports=Zf});var la=d((Om,ca)=>{var ep=tt(),tp=G();ca.exports=(t,e,r)=>{let n=[],s=null,i=null,o=t.sort((l,f)=>tp(l,f,r));for(let l of o)ep(l,e,r)?(i=l,s||(s=l)):(i&&n.push([s,i]),i=null,s=null);s&&n.push([s,null]);let a=[];for(let[l,f]of n)l===f?a.push(l):!f&&l===o[0]?a.push("*"):f?l===o[0]?a.push(`<=${f}`):a.push(`${l} - ${f}`):a.push(`>=${l}`);let u=a.join(" || "),c=typeof e.raw=="string"?e.raw:String(e);return u.length<c.length?u:e}});var ma=d((Lm,ga)=>{var da=X(),Jr=Ze(),{ANY:zr}=Jr,rt=tt(),Zr=G(),rp=(t,e,r={})=>{if(t===e)return!0;t=new da(t,r),e=new da(e,r);let n=!1;e:for(let s of t.set){for(let i of e.set){let o=sp(s,i,r);if(n=n||o!==null,o)continue e}if(n)return!1}return!0},np=[new Jr(">=0.0.0-0")],fa=[new Jr(">=0.0.0")],sp=(t,e,r)=>{if(t===e)return!0;if(t.length===1&&t[0].semver===zr){if(e.length===1&&e[0].semver===zr)return!0;r.includePrerelease?t=np:t=fa}if(e.length===1&&e[0].semver===zr){if(r.includePrerelease)return!0;e=fa}let n=new Set,s,i;for(let p of t)p.operator===">"||p.operator===">="?s=pa(s,p,r):p.operator==="<"||p.operator==="<="?i=ha(i,p,r):n.add(p.semver);if(n.size>1)return null;let o;if(s&&i){if(o=Zr(s.semver,i.semver,r),o>0)return null;if(o===0&&(s.operator!==">="||i.operator!=="<="))return null}for(let p of n){if(s&&!rt(p,String(s),r)||i&&!rt(p,String(i),r))return null;for(let M of e)if(!rt(p,String(M),r))return!1;return!0}let a,u,c,l,f=i&&!r.includePrerelease&&i.semver.prerelease.length?i.semver:!1,m=s&&!r.includePrerelease&&s.semver.prerelease.length?s.semver:!1;f&&f.prerelease.length===1&&i.operator==="<"&&f.prerelease[0]===0&&(f=!1);for(let p of e){if(l=l||p.operator===">"||p.operator===">=",c=c||p.operator==="<"||p.operator==="<=",s){if(m&&p.semver.prerelease&&p.semver.prerelease.length&&p.semver.major===m.major&&p.semver.minor===m.minor&&p.semver.patch===m.patch&&(m=!1),p.operator===">"||p.operator===">="){if(a=pa(s,p,r),a===p&&a!==s)return!1}else if(s.operator===">="&&!rt(s.semver,String(p),r))return!1}if(i){if(f&&p.semver.prerelease&&p.semver.prerelease.length&&p.semver.major===f.major&&p.semver.minor===f.minor&&p.semver.patch===f.patch&&(f=!1),p.operator==="<"||p.operator==="<="){if(u=ha(i,p,r),u===p&&u!==i)return!1}else if(i.operator==="<="&&!rt(i.semver,String(p),r))return!1}if(!p.operator&&(i||s)&&o!==0)return!1}return!(s&&c&&!i&&o!==0||i&&l&&!s&&o!==0||m||f)},pa=(t,e,r)=>{if(!t)return e;let n=Zr(t.semver,e.semver,r);return n>0?t:n<0||e.operator===">"&&t.operator===">="?e:t},ha=(t,e,r)=>{if(!t)return e;let n=Zr(t.semver,e.semver,r);return n<0?t:n>0||e.operator==="<"&&t.operator==="<="?e:t};ga.exports=rp});var Sa=d((Dm,Ea)=>{var en=Re(),va=Ke(),ip=D(),_a=Fr(),op=fe(),ap=Pi(),up=Mi(),cp=Bi(),lp=Xi(),dp=Vi(),fp=Ki(),pp=Yi(),hp=Ji(),gp=G(),mp=ro(),vp=so(),_p=Xt(),Ep=uo(),Sp=lo(),yp=Ye(),Tp=Ht(),Rp=Ur(),bp=Br(),Ap=Vt(),qp=jt(),Ip=Wr(),Cp=So(),wp=Ze(),xp=X(),Np=tt(),Op=Wo(),Lp=Xo(),Dp=Vo(),$p=Qo(),Pp=zo(),kp=zt(),Mp=na(),Fp=ia(),Up=ua(),Bp=la(),Wp=ma();Ea.exports={parse:op,valid:ap,clean:up,inc:cp,diff:lp,major:dp,minor:fp,patch:pp,prerelease:hp,compare:gp,rcompare:mp,compareLoose:vp,compareBuild:_p,sort:Ep,rsort:Sp,gt:yp,lt:Tp,eq:Rp,neq:bp,gte:Ap,lte:qp,cmp:Ip,coerce:Cp,Comparator:wp,Range:xp,satisfies:Np,toComparators:Op,maxSatisfying:Lp,minSatisfying:Dp,minVersion:$p,validRange:Pp,outside:kp,gtr:Mp,ltr:Fp,intersects:Up,simplifyRange:Bp,subset:Wp,SemVer:ip,re:en.re,src:en.src,tokens:en.t,SEMVER_SPEC_VERSION:va.SEMVER_SPEC_VERSION,RELEASE_TYPES:va.RELEASE_TYPES,compareIdentifiers:_a.compareIdentifiers,rcompareIdentifiers:_a.rcompareIdentifiers}});var rn=d(($m,tn)=>{"use strict";var Gp=Sa(),Xp=Ve(),Ce=oe(),ya=O(),Ta=A(),Ra="2.7.15",Hp=function(){return!1},Vp=function(e){if(!Gp.gte(e.VERSION,Ra))throw new Error("AWS SDK version "+Ra+" or greater required.");for(var r in e)if(e[r].serviceIdentifier){var n=e[r];n.prototype.customizeRequests(ba)}return e},jp=function(e){return e.customizeRequests(ba),e};function ba(t){var e=Ce.resolveSegment(Ce.resolveManualSegmentParams(t.params));if(!e){var r=this.serviceIdentifier+"."+t.operation;return Ce.isAutomaticMode()?Ta.getLogger().info("Call "+r+" is missing the sub/segment context for automatic mode. Ignoring."):Ta.getLogger().info("Call "+r+' requires a segment object on the request params as "XRaySegment" for tracing in manual mode. Ignoring.'),t}var n=this.throttledError||Hp,s=new Error().stack;let i;e.notTraced?i=e.addNewSubsegmentWithoutSampling(this.serviceIdentifier):i=e.addNewSubsegment(this.serviceIdentifier);var o=e.segment?e.segment.trace_id:e.trace_id;let a=e.segment?e.segment.additionalTraceData:e.additionalTraceData;var u=function(l){let f="Root="+o+";Parent="+i.id+";Sampled="+(i.notTraced?"0":"1");if(a!=null)for(let[m,p]of Object.entries(a))f+=";"+m+"="+p;l.httpRequest.headers["X-Amzn-Trace-Id"]=f},c=function(l){i.addAttribute("namespace","aws"),i.addAttribute("aws",new Xp(l,i.name));var f=l.httpResponse;if(f&&(i.addAttribute("http",new Aa(f)),(f.statusCode===429||l.error&&n(l.error))&&i.addThrottleFlag()),l.error){var m={message:l.error.message,name:l.error.code,stack:s};f&&f.statusCode?(ya.getCauseTypeFromHttpStatus(f.statusCode)=="error"&&i.addErrorFlag(),i.close(m,!0)):i.close(m)}else{if(f&&f.statusCode){var p=ya.getCauseTypeFromHttpStatus(f.statusCode);p&&(i[p]=!0)}i.close()}};t.on("beforePresign",function(l){e.removeSubsegment(i),e.decrementCounter(),l.removeListener("build",u),l.removeListener("complete",c)}),t.on("build",u).on("complete",c),t.__send||(t.__send=t.send,t.send=function(l){if(Ce.isAutomaticMode()){var f=Ce.getNamespace();f.run(function(){Ce.setSegment(i),t.__send(l)})}else t.__send(l)})}function Aa(t){this.init(t)}Aa.prototype.init=function(e){this.response={status:e.statusCode||""},e.headers&&e.headers["content-length"]&&(this.response.content_length=e.headers["content-length"])};tn.exports.captureAWSClient=jp;tn.exports.captureAWS=Vp});var qa=d(H=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0});H.NODEJS_TIMEOUT_ERROR_CODES=H.TRANSIENT_ERROR_STATUS_CODES=H.TRANSIENT_ERROR_CODES=H.THROTTLING_ERROR_CODES=H.CLOCK_SKEW_ERROR_CODES=void 0;H.CLOCK_SKEW_ERROR_CODES=["AuthFailure","InvalidSignatureException","RequestExpired","RequestInTheFuture","RequestTimeTooSkewed","SignatureDoesNotMatch"];H.THROTTLING_ERROR_CODES=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException","TransactionInProgressException"];H.TRANSIENT_ERROR_CODES=["AbortError","TimeoutError","RequestTimeout","RequestTimeoutException"];H.TRANSIENT_ERROR_STATUS_CODES=[500,502,503,504];H.NODEJS_TIMEOUT_ERROR_CODES=["ECONNRESET","ECONNREFUSED","EPIPE","ETIMEDOUT"]});var Ia=d(B=>{"use strict";Object.defineProperty(B,"__esModule",{value:!0});B.isServerError=B.isTransientError=B.isThrottlingError=B.isClockSkewError=B.isRetryableByTrait=void 0;var nt=qa(),Kp=t=>t.$retryable!==void 0;B.isRetryableByTrait=Kp;var Qp=t=>nt.CLOCK_SKEW_ERROR_CODES.includes(t.name);B.isClockSkewError=Qp;var Yp=t=>{var e,r;return((e=t.$metadata)===null||e===void 0?void 0:e.httpStatusCode)===429||nt.THROTTLING_ERROR_CODES.includes(t.name)||((r=t.$retryable)===null||r===void 0?void 0:r.throttling)==!0};B.isThrottlingError=Yp;var zp=t=>{var e;return nt.TRANSIENT_ERROR_CODES.includes(t.name)||nt.NODEJS_TIMEOUT_ERROR_CODES.includes((t==null?void 0:t.code)||"")||nt.TRANSIENT_ERROR_STATUS_CODES.includes(((e=t.$metadata)===null||e===void 0?void 0:e.httpStatusCode)||0)};B.isTransientError=zp;var Jp=t=>{var e;if(((e=t.$metadata)===null||e===void 0?void 0:e.httpStatusCode)!==void 0){let r=t.$metadata.httpStatusCode;return 500<=r&&r<=599&&!(0,B.isTransientError)(t)}return!1};B.isServerError=Jp});var La=d(we=>{"use strict";var Na=we&&we.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(we,"__esModule",{value:!0});we.captureAWSClient=void 0;var Zp=Ia(),eh=Na(Ve()),th=require("querystring"),rh=Na(We()),nn=oe(),Ca=A(),{safeParseInt:Jt}=O(),nh=O(),Oa="XRaySDKInstrumentation",wa=async(t,e,r,n,s)=>{var i,o,a;let{extendedRequestId:u,requestId:c,httpStatusCode:l,attempts:f}=((i=n==null?void 0:n.output)===null||i===void 0?void 0:i.$metadata)||(s==null?void 0:s.$metadata),m=new eh.default({extendedRequestId:u,requestId:c,retryCount:f,request:{operation:e,httpRequest:{region:r,statusCode:l}}},t),p={};return l&&(p.response={},p.response.status=l),!((o=n==null?void 0:n.response)===null||o===void 0)&&o.headers&&((a=n==null?void 0:n.response)===null||a===void 0?void 0:a.headers["content-length"])!==void 0&&(p.response||(p.response={}),p.response.content_length=Jt(n.response.headers["content-length"])),[m,p]};function xa(t,e,r){var n,s,i;(r&&(0,Zp.isThrottlingError)(r)||Jt((n=t.response)===null||n===void 0?void 0:n.status)===429||Jt((s=r==null?void 0:r.$metadata)===null||s===void 0?void 0:s.httpStatusCode)===429)&&e.addThrottleFlag();let o=(0,nh.getCauseTypeFromHttpStatus)(Jt((i=t.response)===null||i===void 0?void 0:i.status));o==="fault"?e.addFaultFlag():o==="error"&&e.addErrorFlag()}var sh=(t,e)=>(r,n)=>async s=>{let i=nn.isAutomaticMode()?nn.resolveSegment():e,{clientName:o,commandName:a}=n,u=a.slice(0,-7),c=o.slice(0,-6);if(!i){let p=c+"."+u.charAt(0).toLowerCase()+u.slice(1);return nn.isAutomaticMode()?Ca.getLogger().info("Call "+p+" is missing the sub/segment context for automatic mode. Ignoring."):Ca.getLogger().info("Call "+p+" requires a segment object passed to captureAWSv3Client for tracing in manual mode. Ignoring."),r(s)}let l;i.notTraced?l=i.addNewSubsegmentWithoutSampling(c):l=i.addNewSubsegment(c),l.addAttribute("namespace","aws");let f=i instanceof rh.default?i.segment:i;s.request.headers["X-Amzn-Trace-Id"]=(0,th.stringify)({Root:f.trace_id,Parent:l.id,Sampled:l.notTraced?"0":"1"},";");let m;try{if(m=await r(s),!m)throw new Error("Failed to get response from instrumented AWS Client.");let[p,M]=await wa(c,u,await t.region(),m,null);return l.addAttribute("aws",p),l.addAttribute("http",M),xa(M,l),l.close(),m}catch(p){if(p.$metadata){let[C,ct]=await wa(c,u,await t.region(),null,p);l.addAttribute("aws",C),l.addAttribute("http",ct),xa(ct,l,p)}let M={message:p.message,name:p.name,stack:p.stack||new Error().stack};throw l.close(M,!0),p}},ih={name:Oa,step:"build"},oh=(t,e)=>({applyToStack:r=>{r.add(sh(t,e),ih)}});function ah(t,e){return t.middlewareStack.remove(Oa),t.middlewareStack.use(oh(t.config,e)),t}we.captureAWSClient=ah});var on=d((Fm,sn)=>{"use strict";var Da=require("url"),xe=oe(),Zt=O(),$a=A(),uh=require("events"),ch=function(e,r,n){e.__request||Pa(e,r,n)},lh=function(e,r,n){if(e.__request)return e;var s={};return Object.keys(e).forEach(function(i){s[i]=e[i]}),Pa(s,r,n),s};function Pa(t,e,r){function n(o,...a){let u,c,l,f,m=a[0];if(typeof a[1]=="object"?(l=!0,f=typeof m=="string"?new Da.URL(m):m,u=a[1],c=a[2]):(l=!1,u=m,c=a[1]),!u||u.headers&&u.headers["X-Amzn-Trace-Id"])return o(...a);typeof u=="string"&&(u=new Da.URL(u)),l||(f=u);let p=xe.resolveSegment(xe.resolveManualSegmentParams(u)),M=u.hostname||u.host||f.hostname||f.host||"Unknown host";if(!p){let w="[ host: "+M;return w=u.method?w+", method: "+u.method:w,w+=", path: "+(f.pathname||Zt.stripQueryStringFromPath(u.path))+" ]",xe.isAutomaticMode()?$a.getLogger().info("Options for request "+w+" is missing the sub/segment context for automatic mode. Ignoring."):$a.getLogger().info("Options for request "+w+' requires a segment object on the options params as "XRaySegment" for tracing in manual mode. Ignoring.'),o(...a)}let C;p.notTraced?C=p.addNewSubsegmentWithoutSampling(M):C=p.addNewSubsegment(M);let ct=p.segment?p.segment:p;C.namespace="remote",u.headers||(u.headers={}),u.headers["X-Amzn-Trace-Id"]="Root="+ct.trace_id+";Parent="+C.id+";Sampled="+(C.notTraced?"0":"1");let pu=function(te){if(r&&r(C,this,null,te),C.http&&C.http.response)Zt.getCauseTypeFromHttpStatus(C.http.response.status)==="error"&&C.addErrorFlag(),C.close(te,!0);else{let gu=te.code!=="ECONNREFUSED";C.addRemoteRequestData(this,null,gu&&e),C.close(te)}},hu=Zt.objectWithoutProperties(u,["Segment"],!0),dn=o(...l?[m,hu]:[u],function(w){w.on("end",function(){r&&r(C,this.req,w),w.statusCode===429&&C.addThrottleFlag();let te=Zt.getCauseTypeFromHttpStatus(w.statusCode);te&&(C[te]=!0),C.addRemoteRequestData(w.req,w,!!e),C.close()}),typeof c=="function"?xe.isAutomaticMode()?xe.getNamespace().run(function(){xe.setSegment(C),c(w)}):c(w):w.req&&w.req.listenerCount("response")===0&&w.resume()});return dn.on(uh.errorMonitor||"error",pu),dn}t.__request=t.request;function s(...o){return n(t.__request,...o)}t.__get=t.get;function i(...o){return n(t.__get,...o)}Object.defineProperties(t,{request:{value:s,configurable:!0,enumerable:!0,writable:!0},get:{value:i,configurable:!0,enumerable:!0,writable:!0}})}sn.exports.captureHTTPsGlobal=ch;sn.exports.captureHTTPs=lh});var Ua=d((Um,an)=>{"use strict";var st=oe(),er=Symbol("original then"),tr=Symbol("original catch");function Ma(t){let e=t.prototype.then;e[er]||(t.prototype.then=function(n,s){if(st.isAutomaticMode()&&ka()){let i=st.getNamespace();n=n&&i.bind(n),s=s&&i.bind(s)}return e.call(this,n,s)},t.prototype.then[er]=e);let r=t.prototype.catch;r&&!r[tr]&&(t.prototype.catch=function(n){if(st.isAutomaticMode()&&ka()){let s=st.getNamespace();n=n&&s.bind(n)}return r.call(this,n)},t.prototype.catch[tr]=r)}function dh(t){let e=t.prototype.then;e[er]&&(t.prototype.then=e[er]);let r=t.prototype.catch;r&&r[tr]&&(t.prototype.catch=r[tr])}function ka(){try{return st.getSegment()}catch{return}}function Fa(){Ma(Promise)}function fh(){dh(Promise)}Fa.patchThirdPartyPromise=Ma;an.exports.capturePromise=Fa;an.exports.uncapturePromise=fh});var Ga=d((Bm,Wa)=>{"use strict";function Ba(t,e,r,n,s){this.init(t,e,r,n,s)}Ba.prototype.init=function(e,r,n,s,i){e&&(this.database_version=e),r&&(this.driver_version=r),i&&(this.preparation=i),this.url=s,this.user=n};Wa.exports=Ba});var Va=d((Wm,Ha)=>{"use strict";var ue=oe(),un=A(),Ne=re(),ph=O(),hh=Js(),ot={};try{ot=Zs()}catch(t){un.getLogger().debug("Failed to load SDK data:",t)}var it="unknown",Xa={plugins:{EC2Plugin:ai(),ECSPlugin:ci(),ElasticBeanstalkPlugin:di()},config:function(t){var e={};t.forEach(function(r){r.getData(function(n){if(n)for(var s in n)e[s]=n[s]}),Ne.setOrigin(r.originName),Ne.setPluginData(e)})},setAWSWhitelist:Ve().setAWSWhitelist,appendAWSWhitelist:Ve().appendAWSWhitelist,setStreamingThreshold:Ne.setStreamingThreshold,setLogger:un.setLogger,getLogger:un.getLogger,setDaemonAddress:bt().setDaemonAddress,captureFunc:Ut().captureFunc,captureAsyncFunc:Ut().captureAsyncFunc,captureCallbackFunc:Ut().captureCallbackFunc,captureAWS:rn().captureAWS,captureAWSClient:rn().captureAWSClient,captureAWSv3Client:La().captureAWSClient,captureHTTPs:on().captureHTTPs,captureHTTPsGlobal:on().captureHTTPsGlobal,capturePromise:Ua().capturePromise,utils:ph,database:{SqlData:Ga()},middleware:wr(),getNamespace:ue.getNamespace,resolveSegment:ue.resolveSegment,getSegment:ue.getSegment,setSegment:ue.setSegment,isAutomaticMode:ue.isAutomaticMode,enableAutomaticMode:ue.enableAutomaticMode,enableManualMode:ue.enableManualMode,setContextMissingStrategy:ue.setContextMissingStrategy,Segment:Ge(),Subsegment:We(),SegmentUtils:Ne};Xa.middleware.IncomingRequestData=_r(),function(){var t={runtime:process.release&&process.release.name?process.release.name:it,runtime_version:process.version,version:process.env.npm_package_version||it,name:process.env.npm_package_name||it},e={sdk:"X-Ray for Node.js",sdk_version:ot.version?ot.version:it,package:ot.name?ot.name:it};Ne.setSDKData(e),Ne.setServiceData(t),process.env.LAMBDA_TASK_ROOT&&hh.init()}();Ha.exports=Xa});var at=d((Gm,ja)=>{"use strict";ja.exports=Va()});var Ya=d((Xm,Qa)=>{var Oe=at(),Ka=Oe.middleware,gh={openSegment:t=>{if(!t||typeof t!="string")throw new Error("Default segment name was not supplied.  Please provide a string.");return Ka.setDefaultName(t),(e,r,n)=>{let s=Ka.traceRequestResponseCycle(e,r);if(Oe.isAutomaticMode()){let i=Oe.getNamespace();i.bindEmitter(e),i.bindEmitter(r),i.run(()=>{Oe.setSegment(s),n&&n()})}else e.segment=s,n&&n()}},closeSegment:()=>(t,e,r,n)=>{let s=Oe.resolveSegment(e.segment);s&&t&&(s.addError(t),Oe.getLogger().debug("Added Express server fault to segment")),n&&n(t)}};Qa.exports=gh});var Ja=d((Hm,za)=>{za.exports=Ya()});var tu=d((Vm,eu)=>{var Le=at(),mh=require("events"),vh=Le.database.SqlData,_h=process.env.MYSQL_DATABASE_VERSION,Eh=process.env.MYSQL_DRIVER_VERSION,Sh="statement";eu.exports=function(e){return e.__createConnection||(yh(e),Th(e),Rh(e)),e};function rr(t){return t!=null&&t.then instanceof Function?(t.constructor!=null?t.constructor.name:void 0)!=="Query":!1}function yh(t){var e="__createConnection";t[e]=t.createConnection,t.createConnection=function(){var n=t[e].apply(n,arguments);return rr(n)?n=n.then(s=>(ce(s.connection),s)):n.query instanceof Function&&ce(n),n}}function Th(t){var e="__createPool";t[e]=t.createPool,t.createPool=function(){var n=t[e].apply(n,arguments);return rr(n)?n=n.then(s=>(ce(s.pool),s)):n.query instanceof Function&&ce(n),n}}function Rh(t){var e="__createPoolCluster";t[e]=t.createPoolCluster,t.createPoolCluster=function(){var n=t[e].apply(n,arguments);return n.query instanceof Function&&ce(n),n}}function bh(t){var e="__of";t[e]=t.of,t.of=function(){var n=arguments,s=t[e].apply(t,n);return ce(s)}}function Ah(t){var e="__getConnection";t[e]=t.getConnection,t.getConnection=function(){var n=arguments,s=n[n.length-1];s instanceof Function&&(n[n.length-1]=(o,a)=>(a&&ce(a),s(o,a)));var i=t[e].apply(t,n);return rr(i)?i.then(ce):i}}function ce(t){return t.query instanceof Function&&!t.__query&&(t.__query=t.query,t.query=Za("query")),t.execute instanceof Function&&!t.__execute&&(t.__execute=t.execute,t.execute=Za("execute")),t.getConnection instanceof Function&&!t.__getConnection&&Ah(t),t.of instanceof Function&&!t.__of&&bh(t),t}function qh(t){var e={};return t&&t.length>0&&(t[0]instanceof Object?(e.sql=t[0],t[0].values?e.values=t[0].values:typeof t[2]=="function"&&(e.values=typeof t[1]!="function"?t[1]:null),e.callback=typeof t[1]=="function"?t[1]:typeof t[2]=="function"?t[2]:void 0,!t[1]&&t[0].on instanceof Function&&(e.sql=t[0])):(e.sql=t[0],e.values=typeof t[1]!="function"?t[1]:null,e.callback=typeof t[1]=="function"?t[1]:typeof t[2]=="function"?t[2]:void 0),e.segment=t[t.length-1]!=null&&t[t.length-1].constructor&&(t[t.length-1].constructor.name==="Segment"||t[t.length-1].constructor.name==="Subsegment")?t[t.length-1]:null),e}function Za(t){return function(){var e=qh(arguments),r=Le.resolveSegment(e.segment),n,s=this["__"+t];if(e.segment&&delete arguments[arguments.length-1],!r)return Le.getLogger().info("Failed to capture MySQL. Cannot resolve sub/segment."),s.apply(this,arguments);var i=this.config.connectionConfig||this.config,o=r.addNewSubsegment(i.database+"@"+i.host);if(e.callback){var a=e.callback;Le.isAutomaticMode()?e.callback=function(l,f){var m=Le.getNamespace();m.run(function(){Le.setSegment(o),a(l,f)}),o.close(l)}:e.callback=function(l,f){a(l,f),o.close(l)}}if(n=s.call(this,e.sql,e.values,e.callback),!e.callback){var u=function(c){o.close(c)};rr(n)?n.then(()=>{o.close()}).catch(u):(n.on("end",function(){o.close()}),n.on(mh.errorMonitor||"error",u))}return o.addSqlData(Ih(i,e.values,e.sql)),o.namespace="remote",n}}function Ih(t,e,r){var n=e?Sh:null,s=new vh(_h,Eh,t.user,t.host+":"+t.port+"/"+t.database,n);return process.env.AWS_XRAY_COLLECT_SQL_QUERIES&&r&&(s.sanitized_query=r),s}});var nu=d((jm,ru)=>{ru.exports=tu()});var iu=d((Km,su)=>{var De=at(),Ch=require("events"),wh=De.database.SqlData,xh=process.env.POSTGRES_DATABASE_VERSION,Nh=process.env.POSTGRES_DRIVER_VERSION,Oh="statement";su.exports=function(e){return e.Client.prototype.__query||(e.Client.prototype.__query=e.Client.prototype.query,e.Client.prototype.query=Dh),e};function Lh(t,e,r){var n=typeof t=="string"?{text:t}:t;return e&&(typeof e=="function"?n.callback=e:n.values=e),r&&(n.callback=r),n}function Dh(){var t=arguments[arguments.length-1],e=De.resolveSegment(t!=null&&t.constructor&&(t.constructor.name==="Segment"||t.constructor.name==="Subsegment")?t:null);if(!e)return De.getLogger().info("Failed to capture Postgres. Cannot resolve sub/segment."),this.__query.apply(this,arguments);var r=Lh.apply(this,arguments)||{},n=e.addNewSubsegment(this.database+"@"+this.host);if(n.namespace="remote",r.callback){var s=r.callback;De.isAutomaticMode()?r.callback=function(c,l){var f=De.getNamespace();f.run(function(){De.setSegment(n),s(c,l)}),n.close(c)}:r.callback=function(u,c){s(u,c,n),n.close(u)}}var i=this.__query.call(this,r);if(this._queryable&&!this._ending){var o;if(this.queryQueue.length===0?o=this.activeQuery:o=this.queryQueue[this.queryQueue.length-1],!r.callback&&o.on instanceof Function){o.on("end",function(){n.close()});var a=function(u){n.close(u)};o.on(Ch.errorMonitor||"error",a)}n.addSqlData($h(this.connectionParameters,o))}return i}function $h(t,e){var r=e.name?Oh:void 0,n=new wh(xh,Nh,t.user,t.host+":"+t.port+"/"+t.database,r);return process.env.AWS_XRAY_COLLECT_SQL_QUERIES&&(n.sanitized_query=e.text),n}});var au=d((Qm,ou)=>{ou.exports=iu()});var uu=d((Ym,Ph)=>{Ph.exports={name:"aws-xray-sdk",version:"3.5.0",description:"AWS X-Ray SDK for Javascript",author:"Amazon Web Services",contributors:["Sandra McMullen <mcmuls@amazon.com>","William Armiros <armiros@amazon.com>"],main:"lib/index.js",types:"lib/index.d.ts",engines:{node:">= 14.x"},dependencies:{"aws-xray-sdk-core":"3.5.0","aws-xray-sdk-express":"3.5.0","aws-xray-sdk-mysql":"3.5.0","aws-xray-sdk-postgres":"3.5.0"},scripts:{test:"tsd","test-d":"tsd",lint:"eslint .","lint:fix":"eslint . --fix"},keywords:["amazon","api","aws","xray","x-ray","x ray"],license:"Apache-2.0",repository:"https://github.com/aws/aws-xray-sdk-node/tree/master/packages/full_sdk",gitHead:"0579d9c75e08f8747f9eb87596bea58a7d7e9e25"}});var du=d((zm,lu)=>{var ve=at();ve.express=Ja();ve.captureMySQL=nu();ve.capturePostgres=au();var ut={};try{ut=uu()}catch(t){ve.getLogger().debug("Failed to load SDK data:",t)}var cu="unknown";(function(){var t=ve.SegmentUtils.sdkData||{sdk:"X-Ray for Node.js"};t.sdk_version=ut.version?ut.version:cu,t.package=ut.name?ut.name:cu,ve.SegmentUtils.setSDKData(t)})();lu.exports=ve});var Wh={};yu(Wh,{handler:()=>Bh});module.exports=Tu(Wh);var Pe=pn(Cn(),1),eg=Pe.default.v1,tg=Pe.default.v3,wn=Pe.default.v4,rg=Pe.default.v5;var St=class{constructor(e,r){this.ddbCliente=e,this.productsDdb=r}async getAllProducts(){return console.log("this.ddbCliente:",this.ddbCliente),console.log("this.productsDdb:",this.productsDdb),(await this.ddbCliente.scan({TableName:this.productsDdb}).promise()).Items}async getProductById(e){let r=await this.ddbCliente.get({TableName:this.productsDdb,Key:{id:e}}).promise();if(r.Item)return r.Item;throw new Error("Product not found")}async createProduct(e){return e.id=wn(),await this.ddbCliente.put({TableName:this.productsDdb,Item:e}).promise(),e}async deleteProduct(e){let r=await this.ddbCliente.delete({TableName:this.productsDdb,Key:{id:e},ReturnValues:"ALL_OLD"}).promise();if(r.Attributes)return r.Attributes;throw new Error("Product not found")}async updateProduct(e,r){let n=await this.ddbCliente.update({TableName:this.productsDdb,Key:{id:e},ConditionExpression:"attribute_exists(id)",ReturnValues:"UPDATED_NEW",UpdateExpression:"set productName = :n, code = :c, price = :p, model = :m, productUrl = :u",ExpressionAttributeValues:{":n":r.productName,":c":r.code,":p":r.price,":m":r.model,":u":r.productUrl}}).promise();return n.Attributes.id=e,console.log("updateProduct",n),n.Attributes}};var nr=require("aws-sdk"),fu=pn(du());fu.captureAWS(require("aws-sdk"));var kh=process.env.PRODUCTS_DDB,Mh=process.env.PRODUCT_EVENTS_FUNCTION_NAME,Fh=new nr.DynamoDB.DocumentClient,Uh=new nr.Lambda,cn=new St(Fh,kh);async function Bh(t,e){let r=t.httpMethod,n=e.awsRequestId,s=t.requestContext.requestId;if(console.log(`API Gateway RequestId: ${s} - lambda RequestId: ${n}`),t.resource==="/products"){if(r==="POST"){console.log("POST /products");let i=JSON.parse(t.body),o=await cn.createProduct(i),a=await ln(o,"PRODUCT_CREATED","biancasleonardo@gmail.com",n);return console.log("responseSendProductEvent - create",a),{statusCode:201,body:JSON.stringify(o)}}}else if(t.resource==="/products/{id}"){let i=t.pathParameters.id;if(r==="PUT"){console.log(`PUT /products/${i}`);let o=JSON.parse(t.body);try{let a=await cn.updateProduct(i,o),u=await ln(a,"PRODUCT_UPDATED","biancasleonardo@gmail.com",n);return console.log("responseSendProductEvent - update",u),{statusCode:200,body:JSON.stringify(a)}}catch{return{statusCode:404,body:"Product nout found"}}}else if(r==="DELETE"){console.log(`DELETE /products/${i}`);try{let o=await cn.deleteProduct(i),a=await ln(o,"PRODUCT_DELETED","biancasleonardo@gmail.com",n);return console.log("responseSendProductEvent - delete",a),{statusCode:200,body:JSON.stringify(o)}}catch(o){return console.log(o.message),{statusCode:404,body:o.message}}}}return{statusCode:400,body:JSON.stringify({message:"bad request"})}}function ln(t,e,r,n){let s={email:r,eventType:e,productCode:t.code,productId:t.id,productPrice:t.price,requestId:n};Uh.invoke({FunctionName:Mh,Payload:JSON.stringify(s),InvocationType:"RequestResponse"}).promise()}0&&(module.exports={handler});
